<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.66">
<title data-react-helmet="true">NetSage Flow Processing Pipeline Install Guide | Netsage Pipeline Documentation</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" name="docusaurus_language" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="1.2.5"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-1.2.5"><meta data-react-helmet="true" property="og:title" content="NetSage Flow Processing Pipeline Install Guide | Netsage Pipeline Documentation"><meta data-react-helmet="true" name="description" content="This document covers installing the NetSage Flow Processing Pipeline on a new machine. Steps should be followed below in order unless you know for sure what you are doing. This document assumes a RedHat Linux environment or one of its derivatives."><meta data-react-helmet="true" property="og:description" content="This document covers installing the NetSage Flow Processing Pipeline on a new machine. Steps should be followed below in order unless you know for sure what you are doing. This document assumes a RedHat Linux environment or one of its derivatives."><meta data-react-helmet="true" property="og:url" content="https://netsage-project.github.io/netsage-pipeline/docs/1.2.5/deploy/install"><link data-react-helmet="true" rel="shortcut icon" href="/netsage-pipeline/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://netsage-project.github.io/netsage-pipeline/docs/1.2.5/deploy/install"><link rel="stylesheet" href="/netsage-pipeline/styles.bf9b0f11.css">
<link rel="preload" href="/netsage-pipeline/styles.02565728.js" as="script">
<link rel="preload" href="/netsage-pipeline/runtime~main.6a686554.js" as="script">
<link rel="preload" href="/netsage-pipeline/main.3b47811b.js" as="script">
<link rel="preload" href="/netsage-pipeline/1.cabb9993.js" as="script">
<link rel="preload" href="/netsage-pipeline/2.3e58b6d8.js" as="script">
<link rel="preload" href="/netsage-pipeline/62.5b7ddfbf.js" as="script">
<link rel="preload" href="/netsage-pipeline/63.16f1043a.js" as="script">
<link rel="preload" href="/netsage-pipeline/6c279c12.be029e86.js" as="script">
<link rel="preload" href="/netsage-pipeline/17896441.5ebc3f9a.js" as="script">
<link rel="preload" href="/netsage-pipeline/9fe55709.9eabdee7.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/netsage-pipeline/"><img class="navbar__logo" src="/netsage-pipeline/img/logo.png" alt="NetSage Logo"><strong class="navbar__title">NetSage Documentation</strong></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/netsage-pipeline/docs/pipeline/intro">Pipeline Documentation</a><a href="https://netsage-project.github.io/netsage-grafana-configs/" target="_self" rel="noopener noreferrer" class="navbar__item navbar__link">Dashboard Documentation</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__item navbar__link" href="/netsage-pipeline/docs/1.2.5/pipeline">1.2.5</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/netsage-pipeline/docs/next/pipeline/intro">master (unreleased)</a></li><li><a class="dropdown__link" href="/netsage-pipeline/docs/pipeline/intro">1.2.7</a></li><li><a class="dropdown__link" href="/netsage-pipeline/docs/1.2.6/deploy/install">1.2.6</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/netsage-pipeline/docs/1.2.5/deploy/install">1.2.5</a></li></ul></div><a href="https://github.com/netsage-project/netsage-pipeline/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_2aTZ"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_BsTx">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_BsTx">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/netsage-pipeline/"><img class="navbar__logo" src="/netsage-pipeline/img/logo.png" alt="NetSage Logo"><strong class="navbar__title">NetSage Documentation</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/netsage-pipeline/docs/pipeline/intro">Pipeline Documentation</a></li><li class="menu__list-item"><a href="https://netsage-project.github.io/netsage-grafana-configs/" target="_self" rel="noopener noreferrer" class="menu__link">Dashboard Documentation</a></li><li class="menu__list-item"><a role="button" class="menu__link menu__link--sublist">Versions</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/netsage-pipeline/docs/next/pipeline/intro">master (unreleased)</a></li><li class="menu__list-item"><a class="menu__link" href="/netsage-pipeline/docs/pipeline/intro">1.2.7</a></li><li class="menu__list-item"><a class="menu__link" href="/netsage-pipeline/docs/1.2.6/deploy/install">1.2.6</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active" href="/netsage-pipeline/docs/1.2.5/deploy/install">1.2.5</a></li></ul></li><li class="menu__list-item"><a href="https://github.com/netsage-project/netsage-pipeline/" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_2gpo"><div class="docSidebarContainer_3_JD" role="complementary"><div class="sidebar_2urC"><div class="menu menu--responsive menu_5FrY"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_Dm3K" xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 32 32" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Pipeline</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/netsage-pipeline/docs/1.2.5/pipeline">Intro</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/netsage-pipeline/docs/1.2.5/pipeline_importer">Importer</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/netsage-pipeline/docs/1.2.5/pipeline_logstash">Logstash</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Developer Guides</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/netsage-pipeline/docs/1.2.5/devel/docker">Docker Guide</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Deployment Guides</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/netsage-pipeline/docs/1.2.5/deploy/choose_install">Choose Install</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/netsage-pipeline/docs/1.2.5/deploy/install">Installation Guide</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/netsage-pipeline/docs/1.2.5/deploy/docker_install">Docker Install</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Documentation</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/netsage-pipeline/docs/1.2.5/docusaurus">Documentation Guide</a></li></ul></li></ul></div></div></div><main class="docMainContainer_3EyW"><div class="container padding-vert--lg docItemWrapper_1EkI"><div class="row"><div class="col docItemCol_2ASc"><div class="alert alert--warning margin-bottom--md" role="alert"><div>This is documentation for Netsage Pipeline Documentation <strong>1.2.5</strong>, which is no longer actively maintained.</div><div class="margin-top--md">For up-to-date documentation, see the <strong><a href="/netsage-pipeline/docs/pipeline/intro">latest version</a></strong> (1.2.7).</div></div><div class="docItemContainer_3QWW"><article><div><span class="badge badge--secondary">Version: 1.2.5</span></div><header><h1 class="docTitle_1Lrw">NetSage Flow Processing Pipeline Install Guide</h1></header><div class="markdown"><p>This document covers installing the NetSage Flow Processing Pipeline on a new machine. Steps should be followed below in order unless you know for sure what you are doing. This document assumes a RedHat Linux environment or one of its derivatives.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="components"></a>Components<a aria-hidden="true" tabindex="-1" class="hash-link" href="#components" title="Direct link to heading">#</a></h2><p>Minimum components</p><ul><li>Data Injestion Source (nfdump, tstat or both)</li><li>RabbitMQ</li><li>LogStash</li><li>Importer (If you use nfdump)</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="prerequirements"></a>Prerequirements<a aria-hidden="true" tabindex="-1" class="hash-link" href="#prerequirements" title="Direct link to heading">#</a></h2><p>The Processing pipeline needs data to injest in order to do anything.  There are two types of data that are consumed.</p><ol><li>nfdump </li><li>tstat</li></ol><p>You&#x27;ll need to have at least one of them setup in order to be able to process the data</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="nfdump"></a>nfdump<a aria-hidden="true" tabindex="-1" class="hash-link" href="#nfdump" title="Direct link to heading">#</a></h3><p>The NetFlow Importer daemon requires nfdump. If you are only using tstat, you do not need nfdump. nfdump is <em>not</em> listed as a dependency of the Pipeline RPM package, as in a lot cases people are running special builds of nfdump -- but make sure you install it before you try running the Netflow Importer. If in doubt, <code>yum install nfdump</code> should work. Flow data exported by some routers require a newer version of nfdump than the one in the CentOS repos; in these cases, it may be necessary to manually compile and install the lastest nfdump.</p><p>Once nfdump is setup you&#x27;ll need to configures your routers to send nfdump to the running process that will save data to a particular location on disk. </p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="installing-the-prerequisites"></a>Installing the Prerequisites<a aria-hidden="true" tabindex="-1" class="hash-link" href="#installing-the-prerequisites" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="rabbitmq"></a>RabbitMQ<a aria-hidden="true" tabindex="-1" class="hash-link" href="#rabbitmq" title="Direct link to heading">#</a></h3><p>The pipeline requires a RabbitMQ server. Typically, this runs on the same server as the pipeline itself, but if need be, you can separate them (for this reason, the Rabbit server is not automatically installed with the pipeline package).</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-sh codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">[root@host ~]# yum install rabbitmq-server</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">`</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div></div></div></div></div><p>Typically, the default configuration will work. Perform any desired Rabbit configuration, if any. Then, start RabbitMQ:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-sh codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">[root@host ~]# /sbin/service rabbitmq-server start or # systemctl start rabbitmq-server.service</span></div></div></div></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="installing-the-epel-repo"></a>Installing the EPEL repo<a aria-hidden="true" tabindex="-1" class="hash-link" href="#installing-the-epel-repo" title="Direct link to heading">#</a></h3><p>Some of our dependencies come from the EPEL repo. To install this:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">[root@host ~]# yum install epel-release</span></div></div></div></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="installing-the-globalnoc-open-source-repo"></a>Installing the GlobalNOC Open Source repo<a aria-hidden="true" tabindex="-1" class="hash-link" href="#installing-the-globalnoc-open-source-repo" title="Direct link to heading">#</a></h3><p>The Pipeline package (and its dependencies that are not in EPEL) are in the GlobalNOC Open Source Repo.</p><p>For Red Hat/CentOS 6, create <code>/etc/yum.repos.d/grnoc6.repo</code> with the following content.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">[grnoc6]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">name=GlobalNOC Public el6 Packages - $basearch</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">baseurl=https://repo-public.grnoc.iu.edu/repo/6/$basearch</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">enabled=1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">gpgcheck=1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">gpgkey=https://repo-public.grnoc.iu.edu/repo/RPM-GPG-KEY-GRNOC6</span></div></div></div></div></div><p>For Red Hat/CentOS 7, create <code>/etc/yum.repos.d/grnoc7.repo</code> with the following content.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">[grnoc7]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">name=GlobalNOC Public el7 Packages - $basearch</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">baseurl=https://repo-public.grnoc.iu.edu/repo/7/$basearch</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">enabled=1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">gpgcheck=1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">gpgkey=https://repo-public.grnoc.iu.edu/repo/RPM-GPG-KEY-GRNOC7</span></div></div></div></div></div><p>The first time you install packages from the repo, you will have to accept the GlobalNOC repo key.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="installing-the-pipeline"></a>Installing the Pipeline<a aria-hidden="true" tabindex="-1" class="hash-link" href="#installing-the-pipeline" title="Direct link to heading">#</a></h2><p>Pipeline components:</p><ol><li>Flow Filter - GlobalNOC uses this for Cenic data as we do not want to process all of it. Not needed otherwise.</li><li>Netflow Importer - required to read nfcapd files from sflow and netflow importers. (If using tstat flow sensors, have them</li></ol><p>send directly to the appropriate rabbit queue. </p><ol start="3"><li>Logstash configs - These are executed in alphabetical order. They read events from a rabbit queue, aggregate (ie stitch flows </li></ol><p>that were split between different nfcapd files), add information from geoIP and Science Registry data, and write to a final rabbit queue.
The final rabbit queue is read by an independent logstash instance and events are put into elasticsearch. One could also modify the
last logstash conf here to write to elasticsearch.</p><p>Nothing will automatically start after installation as we need to move on to configuration. Install it like this:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">[root@host ~]# yum install grnoc-netsage-deidentifier</span></div></div></div></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="configuration"></a>Configuration<a aria-hidden="true" tabindex="-1" class="hash-link" href="#configuration" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="setting-up-the-shared-config-file"></a>Setting up the shared config file<a aria-hidden="true" tabindex="-1" class="hash-link" href="#setting-up-the-shared-config-file" title="Direct link to heading">#</a></h3><p>Theshared config file, used by all the non-logstash pipeline components, is read before reading the individual config files [THERE USED TO BE MANY DAEMONS INSTEAD OF LOGSTASH. We should redo this]. This allows you to easily configure values that apply to all stages, while allowing you to override them in the individual config files, if desired. A default shared config file is included: <code>/etc/grnoc/netsage/deidentifier/netsage_shared.xml</code> </p><p>The first, and most important, part of the configuration is the collection(s) this host will import. These are defined as follows:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">&lt;collection&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &lt;flow-path&gt;/path/to/flow-files&lt;/flow-path&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &lt;sensor&gt;hostname.tld&lt;/sensor&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">&lt;!--  &quot;instance&quot; goes along with sensor</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">       This is to identify various instances if a sensor has more than one &quot;stream&quot; / data collection</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">       Defaults to 0.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &lt;instance&gt;1&lt;/instance&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">--&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &lt;!--</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">       Defaults to sensor, but you can set it to something else here</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &lt;router-address&gt;&lt;/router-address&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  --&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> &lt;!--</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    Flow type: type of flow data (defaults to netflow)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> --&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> &lt;!--</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &lt;flow-type&gt;sflow&lt;/flow-type&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> --&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">&lt;/collection&gt;</span></div></div></div></div></div><p>Notice that <code>instance</code> , <code>router-address</code> , and <code>flow-type</code> are commented out. You only need these if you need an something other than the default values, as described in the comments in the default shared config file.</p><p>You can have multiple <code>collection</code> stanzas, to import multiple collections on one host.</p><p>The shared config looks like this. Note that RabbitMQ connection information is listed, but not the queue or channel, as these will vary per daemon. If you&#x27;re running a default RabbitMQ config, which is open only to &#x27;localhost&#x27; as guest/guest, you won&#x27;t need to change anything here. Note that you will need to change the rabbit_output for the Finished Flow Mover Daemon regardless (see below).</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">&lt;config&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &lt;collection&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &lt;flow-path&gt;/path/to/flow-files1&lt;/flow-path&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &lt;sensor&gt;hostname1.tld&lt;/sensor&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &lt;/collection&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &lt;collection&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &lt;flow-path&gt;/path/to/flow-files2&lt;/flow-path&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &lt;sensor&gt;hostname2.tld&lt;/sensor&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &lt;/collection&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &lt;!-- rabbitmq connection info --&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &lt;rabbit_input&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &lt;host&gt;127.0.0.1&lt;/host&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &lt;port&gt;5671&lt;/port&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &lt;username&gt;guest&lt;/username&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &lt;password&gt;guest&lt;/password&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &lt;batch_size&gt;100&lt;/batch_size&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &lt;vhost&gt;netsage&lt;/vhost&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &lt;ssl&gt;0&lt;/ssl&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &lt;cacert&gt;/path/to/cert.crt&lt;/cacert&gt; &lt;!-- required if ssl is 1 --&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &lt;/rabbit_input&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &lt;!-- The cache does not output to a rabbit queue (shared memory instead) but we still need something here --&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &lt;rabbit_output&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &lt;host&gt;127.0.0.1&lt;/host&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &lt;port&gt;5671&lt;/port&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &lt;username&gt;guest&lt;/username&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &lt;password&gt;guest&lt;/password&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &lt;batch_size&gt;100&lt;/batch_size&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &lt;vhost&gt;netsage&lt;/vhost&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &lt;ssl&gt;0&lt;/ssl&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &lt;cacert&gt;/path/to/cert.crt&lt;/cacert&gt; &lt;!-- required if ssl is 1 --&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &lt;/rabbit_output&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">&lt;/config&gt;</span></div></div></div></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="configuring-the-pipeline-stages"></a>Configuring the Pipeline Stages<a aria-hidden="true" tabindex="-1" class="hash-link" href="#configuring-the-pipeline-stages" title="Direct link to heading">#</a></h3><p>Each stage must be configured with Rabbit input and output queue information. The intention here is that flows should be deidentified before they leave the original node the flow data is collected on. If flows that have not be deidentified need to be pushed to another node for some reason, the Rabbit connection must be encrypted with SSL.</p><p>The username/password are both set to &quot;guest&quot; by default, as this is the default provided by RabbitMQ. This works fine if the localhost is processing all the data. The configs look something like this (some have additional sections).</p><p>Notice that the only Rabbit connection information that&#x27;s provided here is that which is not specific in the shared config file. This way if we need to change the credentials throughout the entire pipeline, it&#x27;s easy to do.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-xml codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">   </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">config</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">&lt;!-- rabbitmq connection info --&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">rabbit_input</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">       </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">queue</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain">netsage_deidentifier_raw</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">queue</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">       </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">channel</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain">2</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">channel</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">rabbit_input</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">&lt;!-- The cache does not output to a rabbit queue (shared memory instead) but we still need something here --&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">rabbit_output</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">       </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">queue</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain">netsage_deidentifier_cached</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">queue</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">       </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">channel</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain">3</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">channel</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">rabbit_output</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">worker</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">         </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">&lt;!-- How many concurrent workers should perform the necessary operations --&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">         </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">&lt;!-- for stitching, we can only use 1 --&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">       </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">num-processes</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain">1</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">num-processes</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">       </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">&lt;!-- where should we write the cache worker pid file to --&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">       </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">pid-file</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain">/var/run/netsage-cache-workers.pid</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">pid-file</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">worker</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">config</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span></div></div></div></div></div><p>The defaults should work unless the pipeline stages need to be reordered for some reason, or if SSL or different hosts/credentials are needed. However, the very endpoints should be checked. At the moment that means the flow cache (which is the first stage in the pipeline) and the flow mover (the last stage).</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="shared-config-file-listing"></a>Shared config file listing<a aria-hidden="true" tabindex="-1" class="hash-link" href="#shared-config-file-listing" title="Direct link to heading">#</a></h3><p>The shared configuration files and logging configuration files are listed below (all of the pipeline components use these):</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">/etc/grnoc/netsage/deidentifier/netsage_shared.xml - Shared config file allowing configuration of collections, and Rabbit connection information</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">/etc/grnoc/netsage/deidentifier/logging.conf - logging config</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">/etc/grnoc/netsage/deidentifier/logging-debug.conf - logging config with debug enabled</span></div></div></div></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="running-the-daemons"></a>Running the daemons<a aria-hidden="true" tabindex="-1" class="hash-link" href="#running-the-daemons" title="Direct link to heading">#</a></h2><p>Typically, the daemons are started and stopped via init script (CentOS 6) or systemd (CentOS 7). They can also be run manually. The daemons all support these flags:</p><p><code>--config [file]</code> - specify which config file to read</p><p><code>--sharedconfig [file]</code> - specify which shared config file to read</p><p><code>--logging [file]</code> - the logging config</p><p><code>--nofork</code> - run in foreground (do not daemonize)</p><p>For more details on each individual daemon, use the <code>--help</code> flag.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="daemon-listing"></a>Daemon Listing<a aria-hidden="true" tabindex="-1" class="hash-link" href="#daemon-listing" title="Direct link to heading">#</a></h3><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="netsage-netflow-importer-daemon"></a>netsage-netflow-importer-daemon<a aria-hidden="true" tabindex="-1" class="hash-link" href="#netsage-netflow-importer-daemon" title="Direct link to heading">#</a></h4><p>This is a daemon that reads raw netflow data, reads it, and pushes it to a Rabbit queue for processing.</p><p>Config file: <code>/etc/grnoc/netsage/deidentifier/netsage_netflow_importer.xml</code> </p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="setup-notes"></a>Setup Notes<a aria-hidden="true" tabindex="-1" class="hash-link" href="#setup-notes" title="Direct link to heading">#</a></h2><p>INPUT AND OUTPUT LOGSTASH FILTERS
Standard logstash filter config files are provided with this package. Most should be used as-is, but the input and output configs (01-inputs.conf and 99-outputs.conf) may be modified for your use.
To use the provided 01-inputs.conf and 99-outputs.conf versions, fill in the IP of the final rabbit host in 99-outputs.conf, and put the rabbitmq usernames and passwords into the logstash keystore.
Your 01 and 99 conf files should not be overwritten by upgrades.</p><p>To set up the keystore:  (note that logstash-keystore takes a minute to come back with a prompt)
Be sure /usr/share/logstash/config exists
(the full path, in case you need it: /usr/share/logstash/bin/logstash-keystore)
Create logstash.keystore in /etc/logstash/: (use the same directory as logstash.yml)</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-sh codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">  $ sudo -E logstash-keystore --path.settings /etc/logstash/ create</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    You can set a password for the keystore itself if you want to investigate that; otherwise skip it.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  $ sudo -E logstash-keystore --path.settings /etc/logstash/ add rabbitmq_input_username     (enter username when prompted)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  $ sudo -E logstash-keystore --path.settings /etc/logstash/ add rabbitmq_input_pw           (enter password when prompted)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  $ sudo -E logstash-keystore --path.settings /etc/logstash/ add rabbitmq_output_username    (enter username when prompted)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  $ sudo -E logstash-keystore --path.settings /etc/logstash/ add rabbitmq_output_pw          (enter password when prompted)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">```sh</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">To list the keys:</span></div></div></div></div></div><p>  $ sudo -E logstash-keystore list</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-sh codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">To remove a key-value pair:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">```sh</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  $ sudo -E logstash-keystore remove &lt;key name&gt;</span></div></div></div></div></div><p>FLOW STITCHING - IMPORTANT!
Flow stitching (ie, aggregation) will NOT work properly with more than ONE logstash pipeline worker!
Be sure to set &quot;pipeline.workers: 1&quot; in /etc/logstash/logstash.yml (default settingss) and/or /etc/logstash/pipelines.yml (settings take precedence). When running logstash on the command line, use &quot;-w 1&quot;.</p><p>See the comments in 04-stitching.conf to learn more about how complete flows are defined.</p></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/netsage-project/netsage-pipeline/edit/master/website/versioned_docs/version-1.2.5/deploy/install.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 40 40" style="margin-right:0.3em;vertical-align:sub"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/netsage-pipeline/docs/1.2.5/deploy/choose_install"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Choosing Install</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/netsage-pipeline/docs/1.2.5/deploy/docker_install"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Docker Installation Guide Â»</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_3SO_"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#components" class="table-of-contents__link">Components</a></li><li><a href="#prerequirements" class="table-of-contents__link">Prerequirements</a><ul><li><a href="#nfdump" class="table-of-contents__link">nfdump</a></li></ul></li><li><a href="#installing-the-prerequisites" class="table-of-contents__link">Installing the Prerequisites</a><ul><li><a href="#rabbitmq" class="table-of-contents__link">RabbitMQ</a></li><li><a href="#installing-the-epel-repo" class="table-of-contents__link">Installing the EPEL repo</a></li><li><a href="#installing-the-globalnoc-open-source-repo" class="table-of-contents__link">Installing the GlobalNOC Open Source repo</a></li></ul></li><li><a href="#installing-the-pipeline" class="table-of-contents__link">Installing the Pipeline</a></li><li><a href="#configuration" class="table-of-contents__link">Configuration</a><ul><li><a href="#setting-up-the-shared-config-file" class="table-of-contents__link">Setting up the shared config file</a></li><li><a href="#configuring-the-pipeline-stages" class="table-of-contents__link">Configuring the Pipeline Stages</a></li><li><a href="#shared-config-file-listing" class="table-of-contents__link">Shared config file listing</a></li></ul></li><li><a href="#running-the-daemons" class="table-of-contents__link">Running the daemons</a><ul><li><a href="#daemon-listing" class="table-of-contents__link">Daemon Listing</a></li></ul></li><li><a href="#setup-notes" class="table-of-contents__link">Setup Notes</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="text--center"><div>Copyright Â© 2020 NetSage Built with Docusaurus.</div></div></div></footer></div>
<script src="/netsage-pipeline/styles.02565728.js"></script>
<script src="/netsage-pipeline/runtime~main.6a686554.js"></script>
<script src="/netsage-pipeline/main.3b47811b.js"></script>
<script src="/netsage-pipeline/1.cabb9993.js"></script>
<script src="/netsage-pipeline/2.3e58b6d8.js"></script>
<script src="/netsage-pipeline/62.5b7ddfbf.js"></script>
<script src="/netsage-pipeline/63.16f1043a.js"></script>
<script src="/netsage-pipeline/6c279c12.be029e86.js"></script>
<script src="/netsage-pipeline/17896441.5ebc3f9a.js"></script>
<script src="/netsage-pipeline/9fe55709.9eabdee7.js"></script>
</body>
</html>