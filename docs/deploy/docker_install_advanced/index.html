<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.66">
<title data-react-helmet="true">Docker Advanced Installation Guide | Netsage Pipeline Documentation</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" name="docusaurus_language" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="1.2.7"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-1.2.7"><meta data-react-helmet="true" property="og:title" content="Docker Advanced Installation Guide | Netsage Pipeline Documentation"><meta data-react-helmet="true" name="description" content="If the Docker Simple installation does not meet your needs, the following customizations will allow for more complex situations."><meta data-react-helmet="true" property="og:description" content="If the Docker Simple installation does not meet your needs, the following customizations will allow for more complex situations."><meta data-react-helmet="true" property="og:url" content="https://netsage-project.github.io/netsage-pipeline/docs/deploy/docker_install_advanced"><link data-react-helmet="true" rel="shortcut icon" href="/netsage-pipeline/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://netsage-project.github.io/netsage-pipeline/docs/deploy/docker_install_advanced"><link rel="stylesheet" href="/netsage-pipeline/styles.bf9b0f11.css">
<link rel="preload" href="/netsage-pipeline/styles.02565728.js" as="script">
<link rel="preload" href="/netsage-pipeline/runtime~main.6a686554.js" as="script">
<link rel="preload" href="/netsage-pipeline/main.134d6688.js" as="script">
<link rel="preload" href="/netsage-pipeline/1.cabb9993.js" as="script">
<link rel="preload" href="/netsage-pipeline/2.3e58b6d8.js" as="script">
<link rel="preload" href="/netsage-pipeline/62.5b7ddfbf.js" as="script">
<link rel="preload" href="/netsage-pipeline/63.16f1043a.js" as="script">
<link rel="preload" href="/netsage-pipeline/906738b8.4cfd69be.js" as="script">
<link rel="preload" href="/netsage-pipeline/17896441.5ebc3f9a.js" as="script">
<link rel="preload" href="/netsage-pipeline/ac3b7d69.315ce32c.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/netsage-pipeline/"><img class="navbar__logo" src="/netsage-pipeline/img/logo.png" alt="NetSage Logo"><strong class="navbar__title">NetSage Documentation</strong></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/netsage-pipeline/docs/pipeline/intro">Pipeline Documentation</a><a href="https://netsage-project.github.io/netsage-grafana-configs/" target="_self" rel="noopener noreferrer" class="navbar__item navbar__link">Dashboard Documentation</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__item navbar__link" href="/netsage-pipeline/docs/pipeline/intro">1.2.7</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/netsage-pipeline/docs/next/deploy/docker_install_advanced">master (unreleased)</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/netsage-pipeline/docs/deploy/docker_install_advanced">1.2.7</a></li><li><a class="dropdown__link" href="/netsage-pipeline/docs/1.2.6/pipeline">1.2.6</a></li><li><a class="dropdown__link" href="/netsage-pipeline/docs/1.2.5/pipeline">1.2.5</a></li></ul></div><a href="https://github.com/netsage-project/netsage-pipeline/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_2aTZ"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_BsTx">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_BsTx">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/netsage-pipeline/"><img class="navbar__logo" src="/netsage-pipeline/img/logo.png" alt="NetSage Logo"><strong class="navbar__title">NetSage Documentation</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/netsage-pipeline/docs/pipeline/intro">Pipeline Documentation</a></li><li class="menu__list-item"><a href="https://netsage-project.github.io/netsage-grafana-configs/" target="_self" rel="noopener noreferrer" class="menu__link">Dashboard Documentation</a></li><li class="menu__list-item"><a role="button" class="menu__link menu__link--sublist">Versions</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/netsage-pipeline/docs/next/deploy/docker_install_advanced">master (unreleased)</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active" href="/netsage-pipeline/docs/deploy/docker_install_advanced">1.2.7</a></li><li class="menu__list-item"><a class="menu__link" href="/netsage-pipeline/docs/1.2.6/pipeline">1.2.6</a></li><li class="menu__list-item"><a class="menu__link" href="/netsage-pipeline/docs/1.2.5/pipeline">1.2.5</a></li></ul></li><li class="menu__list-item"><a href="https://github.com/netsage-project/netsage-pipeline/" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_2gpo"><div class="docSidebarContainer_3_JD" role="complementary"><div class="sidebar_2urC"><div class="menu menu--responsive menu_5FrY"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_Dm3K" xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 32 32" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Pipeline</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/netsage-pipeline/docs/pipeline/intro">Intro</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/netsage-pipeline/docs/pipeline/tstat">Tstat</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/netsage-pipeline/docs/pipeline/nfdump">Nfdump</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/netsage-pipeline/docs/pipeline/importer">Importer</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/netsage-pipeline/docs/pipeline/logstash">Logstash</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/netsage-pipeline/docs/pipeline/elastic">Elasticsearch</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Deployment</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/netsage-pipeline/docs/deploy/choose_install">Choose Install</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/netsage-pipeline/docs/deploy/bare_metal_install">Server Installation Guide</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/netsage-pipeline/docs/deploy/docker_install_simple">Docker Simple</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/netsage-pipeline/docs/deploy/docker_install_advanced">Docker Advanced</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/netsage-pipeline/docs/deploy/docker_troubleshoot">Troubleshooting</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Deployment Guides</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/netsage-pipeline/docs/devel/dev_dataset">Replay Dataset</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/netsage-pipeline/docs/devel/docker_dev_guide">Docker Dev Guide</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Documentation</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/netsage-pipeline/docs/docusaurus">Documentation Guide</a></li></ul></li></ul></div></div></div><main class="docMainContainer_3EyW"><div class="container padding-vert--lg docItemWrapper_1EkI"><div class="row"><div class="col docItemCol_2ASc"><div class="docItemContainer_3QWW"><article><div><span class="badge badge--secondary">Version: 1.2.7</span></div><header><h1 class="docTitle_1Lrw">Docker Advanced Installation Guide</h1></header><div class="markdown"><p>If the Docker Simple installation does not meet your needs, the following customizations will allow for more complex situations.</p><p>Please first read the Docker Simple installation guide in detail. This guide will build on top of that.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="to-add-an-additional-sflow-or-netflow-collector"></a>To Add an Additional Sflow or Netflow Collector<a aria-hidden="true" tabindex="-1" class="hash-link" href="#to-add-an-additional-sflow-or-netflow-collector" title="Direct link to heading">#</a></h2><p>If you have more than 1 sflow and/or 1 netflow sensor, you will need to create more collectors and modify the importer config file. The following instructions describe the steps needed to add one additional sensor.</p><p>Any number of sensors can be accomodated, although if there are more than a few being processed by the same Importer, you may run into issues where long-lasting flows from sensosr A time out while waiting for flows from sensors B-D to be processed. (Another option might be be to run more than one Docker deployment.) </p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="1-docker-composeoverrideyml"></a>1. docker-compose.override.yml<a aria-hidden="true" tabindex="-1" class="hash-link" href="#1-docker-composeoverrideyml" title="Direct link to heading">#</a></h3><p>The pattern to add a flow collector is always the same. To add an sflow collector called example-collector, edit the docker-compose.override.yml file and add</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-yaml codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">example-collector</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">image</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> netsage/nfdump</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">collector</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">1.6.18</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">restart</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> always</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">command</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> sfcapd </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">T all </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">l /data </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">S 1 </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">w </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">z </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">p 9997</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">volumes</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> ./data/input_data/example</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">/data</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">ports</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;9997:9997/udp&quot;</span></div></div></div></div></div><ul><li>collector-name: should be updated to something that has some meaning, in our example &quot;example-collector&quot;.</li><li>command: choose between sfcapd for sflow and nfcapd for netflow, and at the end of the command, specify the port to watch for incoming flow data.  (Unless your flow exporter is already set up to use a different port, you can use the default ports and configure the exporters on the routers to match.)</li><li>ports: make sure the port here matches the port you&#x27;ve set in the command. Naturally all ports have to be unique for this host and the
router should be configured to export data to the same port. (If the port on your docker container is different than the port on your host/local machine, use container_port:host_port.) </li><li>volumes: specify where to write the nfcapd files. Make sure the path is unique and in ./data/. In this case, we&#x27;re writing to ./data/input_data/example. Change the last part of the path to something meaningful.</li></ul><p>You will also need to uncomment these lines: </p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-yaml codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">volumes</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> ./userConfig/netsage_override.xml</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">/etc/grnoc/netsage/deidentifier/netsage_shared.xml</span></div></div></div></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="2--netsage_overridexml"></a>2.  netsage_override.xml<a aria-hidden="true" tabindex="-1" class="hash-link" href="#2--netsage_overridexml" title="Direct link to heading">#</a></h3><p>To make the Pipeline Importer aware of the new data to process, you will need to create a custom Importer configuration: netsage_override.xml.  This will replace the usual config file netsage_shared.xml. </p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-sh codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">cp compose/importer/netsage_shared.xml userConfig/netsage_override.xml</span></div></div></div></div></div><p>Edit netsage_override.xml and add a &quot;collection&quot; section for the new sensor as in the following example. The flow-path should match the path set above in docker-compose.override.yml. $exampleSensorName is a new &quot;variable&quot;; it will be replaced with a value set in the .env file. For the flow-type, enter &quot;sflow&quot; or &quot;netflow&quot; as appropriate.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-xml codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">collection</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">flow-path</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain">/data/input_data/example/</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">flow-path</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">sensor</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain">$exampleSensorName</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">sensor</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">flow-type</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain">sflow</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">flow-type</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">collection</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span></div></div></div></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="3-environment-file"></a>3. Environment file<a aria-hidden="true" tabindex="-1" class="hash-link" href="#3-environment-file" title="Direct link to heading">#</a></h3><p>Then, in the .env file, add a line that sets a value for the &quot;variable&quot; you referenced above, $exampleSensorName. The value is the name of the sensor which will be saved to elasticsearch and which appears in Netsage Dashboards. Set it to something meaningful and unique.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-ini codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">exampleSensorName=&quot;Example New York sFlow&quot;</span></div></div></div></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="select-which-version-to-run"></a>Select which version to run<a aria-hidden="true" tabindex="-1" class="hash-link" href="#select-which-version-to-run" title="Direct link to heading">#</a></h3><p>Before continuing you need to choose if you are going to be use the &#x27;Develop&#x27; version which has the latest changes but might be a bit less stable (or have code not ready for use) or a &#x27;Released&#x27; version. If you&#x27;re opting to use the Develop version, then simply skip the version selection step.</p><div class="admonition admonition-caution alert alert--warning"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>caution</h5></div><div class="admonition-content"><p>Warning! it is HIGHLY recommended to not use the :latest as that is intended to be a developer release. You may still use it but be aware that you may have some instability each time you update.</p></div></div><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-sh codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">  git fetch </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  git checkout &quot;tag name&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ./scripts/docker_select_version.sh</span></div></div></div></div></div><p>Replace &quot;tag name&quot; with the version you intend to use, eg, &quot;v1.2.5&quot;.  When prompted by the script, select the same version.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="running-the-new-collector"></a>Running the new collector<a aria-hidden="true" tabindex="-1" class="hash-link" href="#running-the-new-collector" title="Direct link to heading">#</a></h3><p>After selecting the docker version to run, you can start the new collector by running the following line, using the collector name:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-sh codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">docker-compose up -d example-collector</span></div></div></div></div></div><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>The default version of the collector is 1.6.18. There are other versions released and :latest should be point to the latest one, but there is no particular effort made to make sure we released the latest version. You can get a listing of all the current tags listed <a href="https://hub.docker.com/r/netsage/nfdump-collector/tags" target="_blank" rel="noopener noreferrer">here</a> and the source to generate the docker image can be found <a href="https://github.com/netsage-project/docker-nfdump-collector" target="_blank" rel="noopener noreferrer">here</a> the code for the You may use a different version though there is no particular effort to have an image for every nfdump release.</p></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="for-tstat-data"></a>For Tstat Data<a aria-hidden="true" tabindex="-1" class="hash-link" href="#for-tstat-data" title="Direct link to heading">#</a></h2><p>Tstat data is not collected by nfdump/sfcapd/nfcapd or read by an Importer. Instead, the flow data is sent directly from the router or switch to the logstash pipeline&#x27;s ingest rabbit queue (named &quot;netsage_deidentifier_raw&quot;).  So, when following the Docker Simple guide, the sections related to configuring and starting up the collectors and Importer will not pertain to the tstat sensors. The .env file still needs to be set up though.</p><p>Setting up Tstat is outside the scope of this document, but see the Netsage project Tstat-Transport which contains client programs that can send tstat data to a rabbit queue. See <a href="https://github.com/netsage-project/tstat-transport.git" target="_blank" rel="noopener noreferrer">https://github.com/netsage-project/tstat-transport.git</a>.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="to-customize-logstash-java-settings"></a>To Customize Logstash Java Settings<a aria-hidden="true" tabindex="-1" class="hash-link" href="#to-customize-logstash-java-settings" title="Direct link to heading">#</a></h2><p>If you need to modify the amount of memory logstash can use or any other java settings,
rename the provided example for JVM Options and tweak the settings as desired.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-sh codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">cp userConfig/jvm.options_example userConfig/jvm.options</span></div></div></div></div></div><p>Also update the docker-compose.override.xml file to uncomment lines in the logstash section. It should look something like this:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-yaml codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token key atrule">logstash</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">image</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> netsage/pipeline_logstash</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">latest</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">volumes</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> ./userConfig/jvm.options</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">/usr/share/logstash/config/jvm.options</span></div></div></div></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="to-bring-up-kibana-and-elasticsearch-containers"></a>To Bring up Kibana and Elasticsearch Containers<a aria-hidden="true" tabindex="-1" class="hash-link" href="#to-bring-up-kibana-and-elasticsearch-containers" title="Direct link to heading">#</a></h2><p>The file docker-compose.develop.yaml can be used in conjunction with docker-compose.yaml to bring up the optional Kibana and Elastic Search components.</p><p>This isn&#x27;t a production pattern but the tools can be useful at times. Please refer to the <a href="/netsage-pipeline/docs/devel/docker_dev_guide#optional-elasticsearch-and-kibana">Docker Dev Guide</a></p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="to-export-data-to-an-nfs-volume"></a>To Export Data to an NFS Volume<a aria-hidden="true" tabindex="-1" class="hash-link" href="#to-export-data-to-an-nfs-volume" title="Direct link to heading">#</a></h2><p>By default, data is saved to subdirectories in the ./data directory.  If you would like to use an NFS mount instead you will need to either</p><ol><li>export the NFS volume as ${PROJECT_DIR}/data (which is the idea scenario and least intrusive)</li><li>update the path to the NFS export path in all locations in docker-compose.yml and docker-compose.override.yml</li></ol><div class="admonition admonition-warning alert alert--danger"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"></path></svg></span>warning</h5></div><div class="admonition-content"><p>If you choose to update the docker-compose file, keep in mind that those changes will cause a merge conflict on upgrade.
You&#x27;ll have to manage the volumes exported and ensure to update all the paths correctly for the next release manually.</p></div></div></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/netsage-project/netsage-pipeline/edit/master/website/versioned_docs/version-1.2.7/deploy/docker_install_advanced.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 40 40" style="margin-right:0.3em;vertical-align:sub"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/netsage-pipeline/docs/deploy/docker_install_simple"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Docker Default Installation Guide</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/netsage-pipeline/docs/deploy/docker_troubleshoot"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Docker Troubleshooting Â»</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_3SO_"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#to-add-an-additional-sflow-or-netflow-collector" class="table-of-contents__link">To Add an Additional Sflow or Netflow Collector</a><ul><li><a href="#1-docker-composeoverrideyml" class="table-of-contents__link">1. docker-compose.override.yml</a></li><li><a href="#2--netsage_overridexml" class="table-of-contents__link">2.  netsage_override.xml</a></li><li><a href="#3-environment-file" class="table-of-contents__link">3. Environment file</a></li><li><a href="#select-which-version-to-run" class="table-of-contents__link">Select which version to run</a></li><li><a href="#running-the-new-collector" class="table-of-contents__link">Running the new collector</a></li></ul></li><li><a href="#for-tstat-data" class="table-of-contents__link">For Tstat Data</a></li><li><a href="#to-customize-logstash-java-settings" class="table-of-contents__link">To Customize Logstash Java Settings</a></li><li><a href="#to-bring-up-kibana-and-elasticsearch-containers" class="table-of-contents__link">To Bring up Kibana and Elasticsearch Containers</a></li><li><a href="#to-export-data-to-an-nfs-volume" class="table-of-contents__link">To Export Data to an NFS Volume</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="text--center"><div>Copyright Â© 2021 NetSage Built with Docusaurus.</div></div></div></footer></div>
<script src="/netsage-pipeline/styles.02565728.js"></script>
<script src="/netsage-pipeline/runtime~main.6a686554.js"></script>
<script src="/netsage-pipeline/main.134d6688.js"></script>
<script src="/netsage-pipeline/1.cabb9993.js"></script>
<script src="/netsage-pipeline/2.3e58b6d8.js"></script>
<script src="/netsage-pipeline/62.5b7ddfbf.js"></script>
<script src="/netsage-pipeline/63.16f1043a.js"></script>
<script src="/netsage-pipeline/906738b8.4cfd69be.js"></script>
<script src="/netsage-pipeline/17896441.5ebc3f9a.js"></script>
<script src="/netsage-pipeline/ac3b7d69.315ce32c.js"></script>
</body>
</html>