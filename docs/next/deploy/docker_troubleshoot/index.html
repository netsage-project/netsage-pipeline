<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.72">
<link rel="alternate" type="application/rss+xml" href="/netsage-pipeline/blog/rss.xml" title="Netsage Pipeline Documentation Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/netsage-pipeline/blog/atom.xml" title="Netsage Pipeline Documentation Blog Atom Feed"><title data-react-helmet="true">Docker Troubleshooting | Netsage Pipeline Documentation</title><meta data-react-helmet="true" property="og:url" content="https://netsage-project.github.io/netsage-pipeline/docs/next/deploy/docker_troubleshoot"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Docker Troubleshooting | Netsage Pipeline Documentation"><meta data-react-helmet="true" name="description" content="If you are not seeing flows"><meta data-react-helmet="true" property="og:description" content="If you are not seeing flows"><link data-react-helmet="true" rel="shortcut icon" href="/netsage-pipeline/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://netsage-project.github.io/netsage-pipeline/docs/next/deploy/docker_troubleshoot"><link data-react-helmet="true" rel="alternate" href="https://netsage-project.github.io/netsage-pipeline/docs/next/deploy/docker_troubleshoot" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://netsage-project.github.io/netsage-pipeline/docs/next/deploy/docker_troubleshoot" hreflang="x-default"><link rel="stylesheet" href="/netsage-pipeline/assets/css/styles.c0b86565.css">
<link rel="preload" href="/netsage-pipeline/assets/js/styles.78bdf56e.js" as="script">
<link rel="preload" href="/netsage-pipeline/assets/js/runtime~main.d5096879.js" as="script">
<link rel="preload" href="/netsage-pipeline/assets/js/main.9c7f8262.js" as="script">
<link rel="preload" href="/netsage-pipeline/assets/js/1.ef5a2b29.js" as="script">
<link rel="preload" href="/netsage-pipeline/assets/js/2.c9acf5b9.js" as="script">
<link rel="preload" href="/netsage-pipeline/assets/js/138.84a1b274.js" as="script">
<link rel="preload" href="/netsage-pipeline/assets/js/139.a374ee3d.js" as="script">
<link rel="preload" href="/netsage-pipeline/assets/js/935f2afb.9eafbdec.js" as="script">
<link rel="preload" href="/netsage-pipeline/assets/js/17896441.7700409b.js" as="script">
<link rel="preload" href="/netsage-pipeline/assets/js/653602f1.9722cef0.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#main" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle" type="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/netsage-pipeline/"><img src="/netsage-pipeline/img/logo.png" alt="NetSage Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/netsage-pipeline/img/logo.png" alt="NetSage Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">NetSage Documentation</strong></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/netsage-pipeline/docs/pipeline/intro">Pipeline Documentation</a><a href="https://netsage-project.github.io/netsage-grafana-configs/" target="_self" rel="noopener noreferrer" class="navbar__item navbar__link">Dashboard Documentation</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__item navbar__link" href="/netsage-pipeline/docs/next/pipeline/intro">master (unreleased)</a><ul class="dropdown__menu"><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/netsage-pipeline/docs/next/deploy/docker_troubleshoot">master (unreleased)</a></li><li><a class="dropdown__link" href="/netsage-pipeline/docs/deploy/docker_troubleshoot">1.2.11</a></li><li><a class="dropdown__link" href="/netsage-pipeline/docs/1.2.10/deploy/docker_troubleshoot">1.2.10</a></li><li><a class="dropdown__link" href="/netsage-pipeline/docs/1.2.9/deploy/docker_troubleshoot">1.2.9</a></li><li><a class="dropdown__link" href="/netsage-pipeline/docs/1.2.8/deploy/docker_troubleshoot">1.2.8</a></li><li><a class="dropdown__link" href="/netsage-pipeline/docs/1.2.7/deploy/docker_troubleshoot">1.2.7</a></li><li><a class="dropdown__link" href="/netsage-pipeline/docs/1.2.6/pipeline">1.2.6</a></li><li><a class="dropdown__link" href="/netsage-pipeline/docs/1.2.5/pipeline">1.2.5</a></li></ul></div><a href="https://github.com/netsage-project/netsage-pipeline/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_GrZ2"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_71bT">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/netsage-pipeline/"><img src="/netsage-pipeline/img/logo.png" alt="NetSage Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/netsage-pipeline/img/logo.png" alt="NetSage Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">NetSage Documentation</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/netsage-pipeline/docs/pipeline/intro">Pipeline Documentation</a></li><li class="menu__list-item"><a href="https://netsage-project.github.io/netsage-grafana-configs/" target="_self" rel="noopener noreferrer" class="menu__link">Dashboard Documentation</a></li><li class="menu__list-item"><a role="button" class="menu__link menu__link--sublist">Versions</a><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active" href="/netsage-pipeline/docs/next/deploy/docker_troubleshoot">master (unreleased)</a></li><li class="menu__list-item"><a class="menu__link" href="/netsage-pipeline/docs/deploy/docker_troubleshoot">1.2.11</a></li><li class="menu__list-item"><a class="menu__link" href="/netsage-pipeline/docs/1.2.10/deploy/docker_troubleshoot">1.2.10</a></li><li class="menu__list-item"><a class="menu__link" href="/netsage-pipeline/docs/1.2.9/deploy/docker_troubleshoot">1.2.9</a></li><li class="menu__list-item"><a class="menu__link" href="/netsage-pipeline/docs/1.2.8/deploy/docker_troubleshoot">1.2.8</a></li><li class="menu__list-item"><a class="menu__link" href="/netsage-pipeline/docs/1.2.7/deploy/docker_troubleshoot">1.2.7</a></li><li class="menu__list-item"><a class="menu__link" href="/netsage-pipeline/docs/1.2.6/pipeline">1.2.6</a></li><li class="menu__list-item"><a class="menu__link" href="/netsage-pipeline/docs/1.2.5/pipeline">1.2.5</a></li></ul></li><li class="menu__list-item"><a href="https://github.com/netsage-project/netsage-pipeline/" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper main-docs-wrapper"><div class="docPage_31aa"><div class="docSidebarContainer_3Kbt" role="complementary"><div class="sidebar_15mo"><div class="menu menu--responsive thin-scrollbar menu_Bmed"><button aria-label="Open menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_fgN0" width="24" height="24" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Pipeline</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/netsage-pipeline/docs/next/pipeline/intro">Intro</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/netsage-pipeline/docs/next/pipeline/tstat">Tstat Data</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/netsage-pipeline/docs/next/pipeline/sensors">Sflow/Netflow Data</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/netsage-pipeline/docs/next/pipeline/pmacct">Pmacct</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/netsage-pipeline/docs/next/pipeline/logstash">Logstash</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/netsage-pipeline/docs/next/pipeline/elastic">Elasticsearch</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Deployment</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/netsage-pipeline/docs/next/deploy/choose_install">Choose Install</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/netsage-pipeline/docs/next/deploy/bare_metal_install">Manual Installation</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/netsage-pipeline/docs/next/deploy/docker_install_simple">Docker Installation</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/netsage-pipeline/docs/next/deploy/docker_install_advanced">Docker Advanced Options</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/netsage-pipeline/docs/next/deploy/docker_upgrade">Docker - Upgrading</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/netsage-pipeline/docs/next/deploy/docker_troubleshoot">Troubleshooting</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Development</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/netsage-pipeline/docs/next/devel/dev_dataset">Replay Dataset</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/netsage-pipeline/docs/next/devel/docker_dev_guide">Docker Dev Guide</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/netsage-pipeline/docs/next/devel/docusaurus">Docusaurus</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/netsage-pipeline/docs/next/devel/docker_dev_tag">Making Releases</a></li></ul></li></ul></div></div></div><main class="docMainContainer_3ufF"><div class="container padding-vert--lg docItemWrapper_3FMP"><div class="row"><div class="col docItemCol_3FnS"><div class="alert alert--warning margin-bottom--md" role="alert"><div>This is unreleased documentation for Netsage Pipeline Documentation <strong>master (unreleased)</strong> version.</div><div class="margin-top--md">For up-to-date documentation, see the <strong><a href="/netsage-pipeline/docs/deploy/docker_troubleshoot">latest version</a></strong> (1.2.11).</div></div><div class="docItemContainer_33ec"><article><div><span class="badge badge--secondary">Version: master (unreleased)</span></div><header><h1 class="docTitle_3a4h">Docker Troubleshooting</h1></header><div class="markdown"><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="if-you-are-not-seeing-flows"></a>If you are not seeing flows<a class="hash-link" href="#if-you-are-not-seeing-flows" title="Direct link to heading">#</a></h3><ul><li>Be sure allow time for the first flows to timeout in the logstash aggregation - wait at least 10-15 minutes after starting up containers.</li><li>Use <code>docker-compose ps</code> to see if all the containers are (still) running.</li><li>Check the logs of the various containers to see if anything jumps out as being a problem.</li><li>If logstash logs say things like <em>OutOfMemoryError: Java heap space</em>Â or <em>An unexpected connection driver error occured (Exception message: Connection reset)</em>  and the rabbit container is also down...  We&#x27;ve seen this before, but are not sure why it occurs. Try stopping everything, restarting docker for good measure, and starting all the containers up again. (If problems are continuing, it might be a memory issue.)<div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">docker-compose down</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">sudo systemctl restart docker</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">docker-compose up -d</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div></li><li>If there is only an <em>OutOfMemoryError</em> for java, perhaps you need to increase the java heap size.</li><li>Check flow export on the network device to be sure it is (still) configured and running correctly.</li><li>Make sure there really is traffic to be detected (with flows over 10 MB). A circuit outage or simple lack of large flows might be occurring.</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="problems-most-likely-to-occur-at-installation"></a>Problems most likely to occur at installation:<a class="hash-link" href="#problems-most-likely-to-occur-at-installation" title="Direct link to heading">#</a></h2><ul><li><p>Be sure conf-logstash/ files and dirs are readable by the logstash user (uid 1000, regardless of whether there is different username associated with uid 1000 on the host).  A logstash error about not being able to find *.conf files could be caused by a permissions problem.</p></li><li><p>Files in logstash-downloads/ and conf-pmacct/ also need to be readable by the logstash user.</p></li><li><p>Logstash-temp/ needs to be readable and also writable by the logstash user.</p></li><li><p>Ensure routers are configured to send to the correct host and port and flow export is functioning.</p></li><li><p>Check iptables on the pipeline host to be sure incoming traffic from the routers is allowed.</p></li><li><p>Use tcpdump to be sure there are flows coming into the expected port.</p></li><li><p>If the final rabbit queue is on a remote host, eg, at IU, check the credentials you are using and iptables on the remote host.</p></li><li><p>Did you create and edit .env? </p><ul><li>Are the numbers of sensors, sensor names, and port numbers correct? </li><li>Make sure you don&#x27;t have sflows going to a nfacctd process or vise versa.</li><li>Are there names and port numbers for each sensor? </li><li>Are the environment variable names for sensors like <em>_1, </em>_2, *_3, etc. with one sequence for sflow and one for netflow?</li></ul></li><li><p>Did you run setup-pmacct.sh?</p></li><li><p>In docker-compose.override.yml, make sure the ports are set correctly. You will see <em>port on host : port in container</em>. (Docker uses its own port numbers internally.) <em>Port on host</em> should match what is in .env (the port the router is sending to on the pipeline host). <em>Port in container</em> should match what is in the corresponding pmacct config.  </p></li><li><p>In pmacct config files, make sure amqp_host is set to rabbit (for docker installs) or localhost (for bare metal)</p></li><li><p>In &#x27;docker-compose ps&#x27; output, be sure the command for the sfacctd_1 container is /usr/local/sbin/sfacctd, similarly for nfacctd.
(If there are 0 Xflow sensors, the command should be <em>echo No Xflow sensor</em> and the container state should be Exit 0.)</p></li><li><p>In docker-compose.yml and docker-compose.override.yml, make sure <em>command:</em>s specify config files with the right _n&#x27;s (these are actually just the parameters for the commands).</p></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="memory"></a>Memory:<a class="hash-link" href="#memory" title="Direct link to heading">#</a></h2><ul><li>If you are processing a lot of flows and encountering Out of Memory erros, docker may need to be allocated more memory. The most likely culprit is logstash (java) which is only allocated 4GB of RAM by default (in previous versions, only 2GB). Please see the Docker Advanced Options guide for how to change.</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="if-there-are-too-few-flows-and-flow-sizes-and-rates-are-smaller-than-expected"></a>If there are too few flows and flow sizes and rates are smaller than expected:<a class="hash-link" href="#if-there-are-too-few-flows-and-flow-sizes-and-rates-are-smaller-than-expected" title="Direct link to heading">#</a></h3><p>The router may not be sending the sampling rate with the flow data.
You may need to apply sampling corrections - see the Docker Advanced Options guide.</p></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/netsage-project/netsage-pipeline/edit/master/website/docs/deploy/docker_troubleshooting.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" role="img" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-label="Edit page"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/netsage-pipeline/docs/next/deploy/docker_upgrade"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Upgrading</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/netsage-pipeline/docs/next/devel/dev_dataset"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Pipeline Replay Dataset Â»</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#if-you-are-not-seeing-flows" class="table-of-contents__link">If you are not seeing flows</a></li><li><a href="#problems-most-likely-to-occur-at-installation" class="table-of-contents__link">Problems most likely to occur at installation:</a></li><li><a href="#memory" class="table-of-contents__link">Memory:</a><ul><li><a href="#if-there-are-too-few-flows-and-flow-sizes-and-rates-are-smaller-than-expected" class="table-of-contents__link">If there are too few flows and flow sizes and rates are smaller than expected:</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2022 NetSage Built with Docusaurus.</div></div></div></footer></div>
<script src="/netsage-pipeline/assets/js/styles.78bdf56e.js"></script>
<script src="/netsage-pipeline/assets/js/runtime~main.d5096879.js"></script>
<script src="/netsage-pipeline/assets/js/main.9c7f8262.js"></script>
<script src="/netsage-pipeline/assets/js/1.ef5a2b29.js"></script>
<script src="/netsage-pipeline/assets/js/2.c9acf5b9.js"></script>
<script src="/netsage-pipeline/assets/js/138.84a1b274.js"></script>
<script src="/netsage-pipeline/assets/js/139.a374ee3d.js"></script>
<script src="/netsage-pipeline/assets/js/935f2afb.9eafbdec.js"></script>
<script src="/netsage-pipeline/assets/js/17896441.7700409b.js"></script>
<script src="/netsage-pipeline/assets/js/653602f1.9722cef0.js"></script>
</body>
</html>