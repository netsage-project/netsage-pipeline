<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.72">
<link rel="alternate" type="application/rss+xml" href="/netsage-pipeline/blog/rss.xml" title="Netsage Pipeline Documentation Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/netsage-pipeline/blog/atom.xml" title="Netsage Pipeline Documentation Blog Atom Feed"><title data-react-helmet="true">Manual Installation Guide | Netsage Pipeline Documentation</title><meta data-react-helmet="true" property="og:url" content="https://netsage-project.github.io/netsage-pipeline/docs/next/deploy/bare_metal_install"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Manual Installation Guide | Netsage Pipeline Documentation"><meta data-react-helmet="true" name="description" content="This document covers installing the NetSage Flow Processing Pipeline manually on a new machine (without using Docker). Steps should be followed below in order unless you know for sure what you are doing. This document assumes a RedHat Linux environment or one of its derivatives."><meta data-react-helmet="true" property="og:description" content="This document covers installing the NetSage Flow Processing Pipeline manually on a new machine (without using Docker). Steps should be followed below in order unless you know for sure what you are doing. This document assumes a RedHat Linux environment or one of its derivatives."><link data-react-helmet="true" rel="shortcut icon" href="/netsage-pipeline/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://netsage-project.github.io/netsage-pipeline/docs/next/deploy/bare_metal_install"><link data-react-helmet="true" rel="alternate" href="https://netsage-project.github.io/netsage-pipeline/docs/next/deploy/bare_metal_install" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://netsage-project.github.io/netsage-pipeline/docs/next/deploy/bare_metal_install" hreflang="x-default"><link rel="stylesheet" href="/netsage-pipeline/assets/css/styles.414b8674.css">
<link rel="preload" href="/netsage-pipeline/assets/js/styles.957cc5e6.js" as="script">
<link rel="preload" href="/netsage-pipeline/assets/js/runtime~main.b2bd9aaa.js" as="script">
<link rel="preload" href="/netsage-pipeline/assets/js/main.e18dab9f.js" as="script">
<link rel="preload" href="/netsage-pipeline/assets/js/1.d7dedcfb.js" as="script">
<link rel="preload" href="/netsage-pipeline/assets/js/2.1fde247e.js" as="script">
<link rel="preload" href="/netsage-pipeline/assets/js/141.1782d6b8.js" as="script">
<link rel="preload" href="/netsage-pipeline/assets/js/142.d881c78f.js" as="script">
<link rel="preload" href="/netsage-pipeline/assets/js/935f2afb.adbd265e.js" as="script">
<link rel="preload" href="/netsage-pipeline/assets/js/17896441.f3a73913.js" as="script">
<link rel="preload" href="/netsage-pipeline/assets/js/e5ce8f83.c66f39d7.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#main" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle" type="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/netsage-pipeline/"><img src="/netsage-pipeline/img/logo.png" alt="NetSage Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/netsage-pipeline/img/logo.png" alt="NetSage Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">NetSage Documentation</strong></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/netsage-pipeline/docs/pipeline/intro">Pipeline Documentation</a><a href="https://netsage-project.github.io/netsage-grafana-configs/" target="_self" rel="noopener noreferrer" class="navbar__item navbar__link">Dashboard Documentation</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__item navbar__link" href="/netsage-pipeline/docs/next/pipeline/intro">master (unreleased)</a><ul class="dropdown__menu"><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/netsage-pipeline/docs/next/deploy/bare_metal_install">master (unreleased)</a></li><li><a class="dropdown__link" href="/netsage-pipeline/docs/deploy/bare_metal_install">1.2.11</a></li><li><a class="dropdown__link" href="/netsage-pipeline/docs/1.2.10/deploy/bare_metal_install">1.2.10</a></li><li><a class="dropdown__link" href="/netsage-pipeline/docs/1.2.9/deploy/bare_metal_install">1.2.9</a></li><li><a class="dropdown__link" href="/netsage-pipeline/docs/1.2.8/deploy/bare_metal_install">1.2.8</a></li><li><a class="dropdown__link" href="/netsage-pipeline/docs/1.2.7/deploy/bare_metal_install">1.2.7</a></li><li><a class="dropdown__link" href="/netsage-pipeline/docs/1.2.6/pipeline">1.2.6</a></li><li><a class="dropdown__link" href="/netsage-pipeline/docs/1.2.5/pipeline">1.2.5</a></li></ul></div><a href="https://github.com/netsage-project/netsage-pipeline/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_GrZ2"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_71bT">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/netsage-pipeline/"><img src="/netsage-pipeline/img/logo.png" alt="NetSage Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/netsage-pipeline/img/logo.png" alt="NetSage Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">NetSage Documentation</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/netsage-pipeline/docs/pipeline/intro">Pipeline Documentation</a></li><li class="menu__list-item"><a href="https://netsage-project.github.io/netsage-grafana-configs/" target="_self" rel="noopener noreferrer" class="menu__link">Dashboard Documentation</a></li><li class="menu__list-item"><a role="button" class="menu__link menu__link--sublist">Versions</a><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active" href="/netsage-pipeline/docs/next/deploy/bare_metal_install">master (unreleased)</a></li><li class="menu__list-item"><a class="menu__link" href="/netsage-pipeline/docs/deploy/bare_metal_install">1.2.11</a></li><li class="menu__list-item"><a class="menu__link" href="/netsage-pipeline/docs/1.2.10/deploy/bare_metal_install">1.2.10</a></li><li class="menu__list-item"><a class="menu__link" href="/netsage-pipeline/docs/1.2.9/deploy/bare_metal_install">1.2.9</a></li><li class="menu__list-item"><a class="menu__link" href="/netsage-pipeline/docs/1.2.8/deploy/bare_metal_install">1.2.8</a></li><li class="menu__list-item"><a class="menu__link" href="/netsage-pipeline/docs/1.2.7/deploy/bare_metal_install">1.2.7</a></li><li class="menu__list-item"><a class="menu__link" href="/netsage-pipeline/docs/1.2.6/pipeline">1.2.6</a></li><li class="menu__list-item"><a class="menu__link" href="/netsage-pipeline/docs/1.2.5/pipeline">1.2.5</a></li></ul></li><li class="menu__list-item"><a href="https://github.com/netsage-project/netsage-pipeline/" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper main-docs-wrapper"><div class="docPage_31aa"><div class="docSidebarContainer_3Kbt" role="complementary"><div class="sidebar_15mo"><div class="menu menu--responsive thin-scrollbar menu_Bmed"><button aria-label="Open menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_fgN0" width="24" height="24" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Pipeline</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/netsage-pipeline/docs/next/pipeline/intro">Intro</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/netsage-pipeline/docs/next/pipeline/tstat">Tstat Data</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/netsage-pipeline/docs/next/pipeline/nfdump">Sflow/Netflow Data</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/netsage-pipeline/docs/next/pipeline/importer">Importer</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/netsage-pipeline/docs/next/pipeline/logstash">Logstash</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/netsage-pipeline/docs/next/pipeline/elastic">Elasticsearch</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Deployment</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/netsage-pipeline/docs/next/deploy/choose_install">Choose Install</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/netsage-pipeline/docs/next/deploy/bare_metal_install">Manual Installation</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/netsage-pipeline/docs/next/deploy/docker_install_simple">Docker Installation</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/netsage-pipeline/docs/next/deploy/docker_install_advanced">Docker Advanced Options</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/netsage-pipeline/docs/next/deploy/docker_upgrade">Docker - Upgrading</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/netsage-pipeline/docs/next/deploy/docker_troubleshoot">Troubleshooting</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Development</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/netsage-pipeline/docs/next/devel/dev_dataset">Replay Dataset</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/netsage-pipeline/docs/next/devel/docker_dev_guide">Docker Dev Guide</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/netsage-pipeline/docs/next/devel/docusaurus">Docusaurus</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/netsage-pipeline/docs/next/devel/docker_dev_tag">Making Releases</a></li></ul></li></ul></div></div></div><main class="docMainContainer_3ufF"><div class="container padding-vert--lg docItemWrapper_3FMP"><div class="row"><div class="col docItemCol_3FnS"><div class="alert alert--warning margin-bottom--md" role="alert"><div>This is unreleased documentation for Netsage Pipeline Documentation <strong>master (unreleased)</strong> version.</div><div class="margin-top--md">For up-to-date documentation, see the <strong><a href="/netsage-pipeline/docs/deploy/bare_metal_install">latest version</a></strong> (1.2.11).</div></div><div class="docItemContainer_33ec"><article><div><span class="badge badge--secondary">Version: master (unreleased)</span></div><header><h1 class="docTitle_3a4h">Manual Installation Guide</h1></header><div class="markdown"><p>This document covers installing the NetSage Flow Processing Pipeline manually on a new machine (without using Docker). Steps should be followed below in order unless you know for sure what you are doing. This document assumes a RedHat Linux environment or one of its derivatives.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="data-sources"></a>Data sources<a class="hash-link" href="#data-sources" title="Direct link to heading">#</a></h2><p>The Processing pipeline needs data to ingest in order to do anything. There are two types of data that can be consumed.</p><ol><li>sflow or netflow</li><li>tstat</li></ol><p>At least one of these must be set up on a sensor to provide the incoming flow data.</p><p>Sflow and netflow data should be sent to ports on the pipeline host where nfcapd and/or sfcapd are ready to receive it.</p><p>Tstat data should be sent directly to the logstash input RabbitMQ queue (the same one that the Importer writes to, if it is used). From there, the data will be processed the same as sflow/netflow data.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="installing-the-prerequisites"></a>Installing the Prerequisites<a class="hash-link" href="#installing-the-prerequisites" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="installing-nfdump"></a>Installing nfdump<a class="hash-link" href="#installing-nfdump" title="Direct link to heading">#</a></h3><p>The nfdump package provides nfcapd and sfcapd processes which recieve flow data and write nfcapd files.
The Importer also uses nfdump. If you are only collecting tstat data, you do not need nfdump. </p><p>Nfdump is <em>not</em> listed as a dependency of the Pipeline RPM package, as in a lot cases people are running special builds of nfdump -- but make sure you install it before you try running the Netflow Importer. If in doubt, <code>yum install nfdump</code> should work.
Flow data exported by some routers require a newer version of nfdump than the one in the CentOS repos; in these cases, it may be necessary to manually compile and install the lastest nfdump. </p><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>It is recommended to check the version of nfdump used in the Docker installation and use the same or newer in order to be sure that any fixes for impactful issues are included.</p></div></div><p>If desired, you can also install nfsen, which has a UI for viewing flow data and can manage starting and stopping all the nfcapd/sfcapd processes for you.The nfsen.conf file has a section in which to configure all the sources. </p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="installing-rabbitmq"></a>Installing RabbitMQ<a class="hash-link" href="#installing-rabbitmq" title="Direct link to heading">#</a></h3><p>The pipeline requires a RabbitMQ server. Typically, this runs on the same server as the pipeline itself, but if need be, you can separate them (for this reason, the Rabbit server is not automatically installed with the pipeline package).</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly sh"><div tabindex="0" class="prism-code language-sh codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">[root@host ~]# yum install rabbitmq-server</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Typically, the default configuration will work. Perform any desired Rabbit configuration, then, start RabbitMQ:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly sh"><div tabindex="0" class="prism-code language-sh codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">[root@host ~]# /sbin/service rabbitmq-server start </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          or # systemctl start rabbitmq-server.service</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="installing-logstash"></a>Installing Logstash<a class="hash-link" href="#installing-logstash" title="Direct link to heading">#</a></h3><p>See the logstash documentation. We are currently using Version 7.10.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="installing-the-epel-repo"></a>Installing the EPEL repo<a class="hash-link" href="#installing-the-epel-repo" title="Direct link to heading">#</a></h3><p>Some of our dependencies come from the EPEL repo. To install this:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">[root@host ~]# yum install epel-release</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="installing-the-globalnoc-open-source-repo"></a>Installing the GlobalNOC Open Source repo<a class="hash-link" href="#installing-the-globalnoc-open-source-repo" title="Direct link to heading">#</a></h3><p>The Pipeline package (and its dependencies that are not in EPEL) are in the GlobalNOC Open Source Repo.</p><p>For Red Hat/CentOS 6, create <code>/etc/yum.repos.d/grnoc6.repo</code> with the following content.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">[grnoc6]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">name=GlobalNOC Public el6 Packages - $basearch</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">baseurl=https://repo-public.grnoc.iu.edu/repo/6/$basearch</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">enabled=1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">gpgcheck=1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">gpgkey=https://repo-public.grnoc.iu.edu/repo/RPM-GPG-KEY-GRNOC6</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>For Red Hat/CentOS 7, create <code>/etc/yum.repos.d/grnoc7.repo</code> with the following content.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">[grnoc7]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">name=GlobalNOC Public el7 Packages - $basearch</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">baseurl=https://repo-public.grnoc.iu.edu/repo/7/$basearch</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">enabled=1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">gpgcheck=1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">gpgkey=https://repo-public.grnoc.iu.edu/repo/RPM-GPG-KEY-GRNOC7</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>The first time you install packages from the repo, you will have to accept the GlobalNOC repo key.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="installing-the-pipeline-importer-and-logstash-configs"></a>Installing the Pipeline (Importer and Logstash configs)<a class="hash-link" href="#installing-the-pipeline-importer-and-logstash-configs" title="Direct link to heading">#</a></h2><p>Install it like this:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">[root@host ~]# yum install grnoc-netsage-deidentifier</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Pipeline components:</p><ol><li>Flow Filter - GlobalNOC uses this for Cenic data to filter out some flows. Not needed otherwise.</li><li>Netsage Netflow Importer - required to read nfcapd files from sflow and netflow importers. (If using tstat flow sensors only, this is not needed.)</li><li>Logstash - be sure the number of logstash pipeline workers in /etc/logstash/logstash.yml is set to 1 or flow stitching/aggregation will not work right!  </li><li>Logstash configs - these are executed in alphabetical order.  See the Logstash doc. At a minimum, the input, output, and aggregation configs have parameters that you will need to update or confirm.</li></ol><p>Nothing will automatically start after installation as we need to move on to configuration. </p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="importer-configuration"></a>Importer Configuration<a class="hash-link" href="#importer-configuration" title="Direct link to heading">#</a></h2><p>Configuration files of interest are</p><ul><li>/etc/grnoc/netsage/deidentifier/netsage_shared.xml - Shared config file allowing configuration of collections, and Rabbit connection information</li><li>/etc/grnoc/netsage/deidentifier/netsage_netflow_importer.xml - other settings</li><li>/etc/grnoc/netsage/deidentifier/logging.conf - logging config</li><li>/etc/grnoc/netsage/deidentifier/logging-debug.conf - logging config with debug enabled</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="setting-up-the-shared-config-file"></a>Setting up the shared config file<a class="hash-link" href="#setting-up-the-shared-config-file" title="Direct link to heading">#</a></h3><p><code>/etc/grnoc/netsage/deidentifier/netsage_shared.xml</code></p><p>There used to be many perl-based pipeline components and daemons. At this point, only the importer is left, the rest having been replaced by logstash.  The shared config file, which was formerly used by all the perl components, is read before reading the individual importer config file.</p><p>The most important part of the shared configuration file is the definition of collections. Each sflow or netflow sensor will have its own collection stanza. Here is one such stanza, a netflow example. Instance and router-address can be left commented out.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">&lt;collection&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     &lt;!-- Top level directory of the nfcapd files for this sensor (within this dir are normally year directories, etc.) --&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">         &lt;flow-path&gt;/path/to/netflow-files/&lt;/flow-path&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     &lt;!-- Sensor name - can be the hostname or any string you like. Shows up in grafana dashboards.  --&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">         &lt;sensor&gt;Netflow Sensor 1&lt;/sensor&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     &lt;!-- Flow type - sflow or netflow (defaults to netflow) --&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">         &lt;flow-type&gt;sflow&lt;/flow-type&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     &lt;!-- &quot;instance&quot; goes along with sensor.  This is to identify various instances if a sensor has --&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     &lt;!-- more than one &quot;stream&quot; / data collection.  Defaults to 0. --&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     &lt;!-- &lt;instance&gt;1&lt;/instance&gt; --&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     &lt;!-- Used in Flow-Filter. Defaults to sensor, but you can set it to something else here --&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     &lt;!-- &lt;router-address&gt;&lt;/router-address&gt; --&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">&lt;/collection&gt;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Having multiple collections in one importer can sometimes cause issues for aggregation, as looping through the collections one at a time adds to the time between the flows, affecting timeouts. You can also set up multiple Importers with differently named shared and importer config files and separate init.d files. </p><p>There is also RabbitMQ connection information in the shared config, though queue names are set in the Importer config. (The Importer does not read from a rabbit queue, but other old components did, so both input and output are set.) </p><p>Ideally, flows should be deidentified before they leave the host on which the data is stored. If flows that have not be deidentified need to be pushed to another node for some reason, the Rabbit connection must be encrypted with SSL.</p><p>If you&#x27;re running a default RabbitMQ config, which is open only to &#x27;localhost&#x27; as guest/guest, you won&#x27;t need to change anything here.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &lt;!-- rabbitmq connection info --&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &lt;rabbit_input&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &lt;host&gt;127.0.0.1&lt;/host&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &lt;port&gt;5672&lt;/port&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &lt;username&gt;guest&lt;/username&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &lt;password&gt;guest&lt;/password&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &lt;ssl&gt;0&lt;/ssl&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &lt;batch_size&gt;100&lt;/batch_size&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &lt;vhost&gt;/&lt;/vhost&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &lt;durable&gt;1&lt;/durable&gt; &lt;!-- Whether the rabbit queue is &#x27;durable&#x27; (don&#x27;t change this unless you have a reason) --&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &lt;/rabbit_input&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &lt;rabbit_output&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &lt;host&gt;127.0.0.1&lt;/host&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &lt;port&gt;5672&lt;/port&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &lt;username&gt;guest&lt;/username&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &lt;password&gt;guest&lt;/password&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &lt;ssl&gt;0&lt;/ssl&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &lt;batch_size&gt;100&lt;/batch_size&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &lt;vhost&gt;/&lt;/vhost&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &lt;durable&gt;1&lt;/durable&gt; &lt;!-- Whether the rabbit queue is &#x27;durable&#x27; (don&#x27;t change this unless you have a reason) --&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &lt;/rabbit_output&gt;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="setting-up-the-importer-config-file"></a>Setting up the Importer config file<a class="hash-link" href="#setting-up-the-importer-config-file" title="Direct link to heading">#</a></h3><p><code>/etc/grnoc/netsage/deidentifier/netsage_netflow_importer.xml</code></p><p>This file has a few more setting specific to the Importer component which you may like to adjust.  </p><ul><li>Rabbit_output has the name of the output queue. This should be the same as that of the logstash input queue.  </li><li>(The Importer does not actually use an input rabbit queue, so we add a &quot;fake&quot; one here.)</li><li>Min-bytes is a threshold applied to flows aggregated within one nfcapd file. Flows smaller than this will be discarded.</li><li>Min-file-age is used to be sure files are complete before being read. </li><li>Cull-enable and cull-ttl can be used to have nfcapd files older than some number of days automatically deleted. </li><li>Pid-file is where the pid file should be written. Be sure this matches what is used in the init.d file.</li><li>Keep num-processes set to 1.</li></ul><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly xml"><div tabindex="0" class="prism-code language-xml codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">config</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">&lt;!--  NOTE: Values here override those in the shared config --&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">&lt;!-- rabbitmq queues --&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">rabbit_input</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">queue</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain">netsage_deidentifier_netflow_fake</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">queue</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">channel</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain">2</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">channel</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">rabbit_input</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">rabbit_output</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">channel</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain">3</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">channel</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">queue</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain">netsage_deidentifier_raw</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">queue</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">rabbit_output</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">worker</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">&lt;!-- How many flows to process at once --&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">flow-batch-size</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain">100</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">flow-batch-size</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">&lt;!-- How many concurrent workers should perform the necessary operations --&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">num-processes</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain">1</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">num-processes</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">&lt;!-- path to nfdump executable (defaults to /usr/bin/nfdump) --&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">&lt;!--   &lt;nfdump-path&gt;/path/to/nfdump&lt;/nfdump-path&gt;  --&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">&lt;!-- Where to store the cache, where it tracks what files it has/hasn&#x27;t read --&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">cache-file</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain">/var/cache/netsage/netflow_importer.cache</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">cache-file</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">&lt;!-- The minium flow size threshold - will not  import any flows smaller than this --&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">&lt;!-- Defaults to 500M  --&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">min-bytes</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain">100000000</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">min-bytes</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"> </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">&lt;!-- Do not import nfcapd files younger than min-file-age</span></div><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">        The value must match /^(\d+)([DWMYhms])$/ where D, W, M, Y, h, m and s are</span></div><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">        &quot;day(s)&quot;, &quot;week(s)&quot;, &quot;month(s)&quot;, &quot;year(s)&quot;, &quot;hour(s)&quot;, &quot;minute(s)&quot; and &quot;second(s)&quot;, respectively&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">        See http://search.cpan.org/~pfig/File-Find-Rule-Age-0.2/lib/File/Find/Rule/Age.pm</span></div><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">        Default: 0 (no minimum age) </span></div><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">    --&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">min-file-age</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain">10m</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">min-file-age</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"> </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">&lt;!-- cull-enable: whether to cull processed flow data files --&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">&lt;!-- default: no culling; set to 1 to turn culling on --&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">&lt;!--    &lt;cull-enable&gt;1&lt;/cull-enable&gt;  --&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">&lt;!-- cull-tty: cull time to live, in days --&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">&lt;!-- number of days to retain imported data files before deleting them; default: 3 --&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">&lt;!--    &lt;cull-ttl&gt;5&lt;/cull-ttl&gt;  --&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">worker</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">master</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">&lt;!-- where should we write the daemon pid file to --&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">pid-file</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain">/var/run/netsage-netflow-importer-daemon.pid</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">pid-file</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">master</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">config</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="logstash-setup-notes"></a>Logstash Setup Notes<a class="hash-link" href="#logstash-setup-notes" title="Direct link to heading">#</a></h2><p>Standard logstash filter config files are provided with this package. Most should be used as-is, but the input and output configs may be modified for your use.</p><p>The aggregation filter also has settings that may be changed as well - check the two timeouts and the aggregation maps path. </p><p>When upgrading, these logstash configs will not be overwritten. Be sure any changes get copied into the production configs.</p><p>FOR FLOW STITCHING/AGGREGATION - IMPORTANT!
Flow stitching (ie, aggregation) will NOT work properly with more than ONE logstash pipeline worker!
Be sure to set &quot;pipeline.workers: 1&quot; in /etc/logstash/logstash.yml and/or /etc/logstash/pipelines.yml. When running logstash on the command line, use &quot;-w 1&quot;.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="start-logstash"></a>Start Logstash<a class="hash-link" href="#start-logstash" title="Direct link to heading">#</a></h2><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly sh"><div tabindex="0" class="prism-code language-sh codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">[root@host ~]# /sbin/service logstash start </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          or # systemctl start logstash.service</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>It will take couple minutes to start. Log files are normally /var/log/messages and /var/log/logstash/logstash-plain.log.</p><p>When logstash is stopped, any flows currently &quot;in the aggregator&quot; will be written out to /tmp/logstash-aggregation-maps (or the path/file set in 40-aggregation.conf). These will be read in and deleted when logstash is started again. </p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="start-the-importer"></a>Start the Importer<a class="hash-link" href="#start-the-importer" title="Direct link to heading">#</a></h2><p>Typically, the daemons are started and stopped via init script (CentOS 6) or systemd (CentOS 7). They can also be run manually. The daemons all support these flags:</p><p><code>--config [file]</code> - specify which config file to read</p><p><code>--sharedconfig [file]</code> - specify which shared config file to read</p><p><code>--logging [file]</code> - the logging config</p><p><code>--nofork</code> - run in foreground (do not daemonize)</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly sh"><div tabindex="0" class="prism-code language-sh codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">[root@host ~]# /sbin/service netsage-netflow-importer start </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          or # systemctl start netsage-netflow-importer.service</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>The Importer will create a deamon process and a worker process. When stopping the service, the worker process might take a few minutes to quit. If it does not quit, kill it by hand. </p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="cron-jobs"></a>Cron jobs<a class="hash-link" href="#cron-jobs" title="Direct link to heading">#</a></h2><p>Sample cron files are provided. Please review and uncomment their contents. These periodically download MaxMind, CAIDA, and Science Registry files, and also restart logstash. Logstash needs to be restarted in order for any updated files to be read in. </p></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/netsage-project/netsage-pipeline/edit/master/website/docs/deploy/bare_metal_install.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" role="img" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-label="Edit page"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/netsage-pipeline/docs/next/deploy/choose_install"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Choosing an Installation Procedure</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/netsage-pipeline/docs/next/deploy/docker_install_simple"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Docker Installation Guide Â»</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#data-sources" class="table-of-contents__link">Data sources</a></li><li><a href="#installing-the-prerequisites" class="table-of-contents__link">Installing the Prerequisites</a><ul><li><a href="#installing-nfdump" class="table-of-contents__link">Installing nfdump</a></li><li><a href="#installing-rabbitmq" class="table-of-contents__link">Installing RabbitMQ</a></li><li><a href="#installing-logstash" class="table-of-contents__link">Installing Logstash</a></li><li><a href="#installing-the-epel-repo" class="table-of-contents__link">Installing the EPEL repo</a></li><li><a href="#installing-the-globalnoc-open-source-repo" class="table-of-contents__link">Installing the GlobalNOC Open Source repo</a></li></ul></li><li><a href="#installing-the-pipeline-importer-and-logstash-configs" class="table-of-contents__link">Installing the Pipeline (Importer and Logstash configs)</a></li><li><a href="#importer-configuration" class="table-of-contents__link">Importer Configuration</a><ul><li><a href="#setting-up-the-shared-config-file" class="table-of-contents__link">Setting up the shared config file</a></li><li><a href="#setting-up-the-importer-config-file" class="table-of-contents__link">Setting up the Importer config file</a></li></ul></li><li><a href="#logstash-setup-notes" class="table-of-contents__link">Logstash Setup Notes</a></li><li><a href="#start-logstash" class="table-of-contents__link">Start Logstash</a></li><li><a href="#start-the-importer" class="table-of-contents__link">Start the Importer</a></li><li><a href="#cron-jobs" class="table-of-contents__link">Cron jobs</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2021 NetSage Built with Docusaurus.</div></div></div></footer></div>
<script src="/netsage-pipeline/assets/js/styles.957cc5e6.js"></script>
<script src="/netsage-pipeline/assets/js/runtime~main.b2bd9aaa.js"></script>
<script src="/netsage-pipeline/assets/js/main.e18dab9f.js"></script>
<script src="/netsage-pipeline/assets/js/1.d7dedcfb.js"></script>
<script src="/netsage-pipeline/assets/js/2.1fde247e.js"></script>
<script src="/netsage-pipeline/assets/js/141.1782d6b8.js"></script>
<script src="/netsage-pipeline/assets/js/142.d881c78f.js"></script>
<script src="/netsage-pipeline/assets/js/935f2afb.adbd265e.js"></script>
<script src="/netsage-pipeline/assets/js/17896441.f3a73913.js"></script>
<script src="/netsage-pipeline/assets/js/e5ce8f83.c66f39d7.js"></script>
</body>
</html>