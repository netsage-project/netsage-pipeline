<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.72">
<link rel="alternate" type="application/rss+xml" href="/netsage-pipeline/blog/rss.xml" title="Netsage Pipeline Documentation Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/netsage-pipeline/blog/atom.xml" title="Netsage Pipeline Documentation Blog Atom Feed"><title data-react-helmet="true">Manual Installation Guide | Netsage Pipeline Documentation</title><meta data-react-helmet="true" property="og:url" content="https://netsage-project.github.io/netsage-pipeline/docs/next/deploy/bare_metal_install"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Manual Installation Guide | Netsage Pipeline Documentation"><meta data-react-helmet="true" name="description" content="This document covers installing and running the NetSage Flow Processing Pipeline manually (without using Docker). It assumes a RedHat Linux environment or one of its derivatives."><meta data-react-helmet="true" property="og:description" content="This document covers installing and running the NetSage Flow Processing Pipeline manually (without using Docker). It assumes a RedHat Linux environment or one of its derivatives."><link data-react-helmet="true" rel="shortcut icon" href="/netsage-pipeline/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://netsage-project.github.io/netsage-pipeline/docs/next/deploy/bare_metal_install"><link data-react-helmet="true" rel="alternate" href="https://netsage-project.github.io/netsage-pipeline/docs/next/deploy/bare_metal_install" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://netsage-project.github.io/netsage-pipeline/docs/next/deploy/bare_metal_install" hreflang="x-default"><link rel="stylesheet" href="/netsage-pipeline/assets/css/styles.c0b86565.css">
<link rel="preload" href="/netsage-pipeline/assets/js/styles.518860af.js" as="script">
<link rel="preload" href="/netsage-pipeline/assets/js/runtime~main.b2eafed5.js" as="script">
<link rel="preload" href="/netsage-pipeline/assets/js/main.e8d621c4.js" as="script">
<link rel="preload" href="/netsage-pipeline/assets/js/1.7a8b56c2.js" as="script">
<link rel="preload" href="/netsage-pipeline/assets/js/2.97237792.js" as="script">
<link rel="preload" href="/netsage-pipeline/assets/js/137.9a86e881.js" as="script">
<link rel="preload" href="/netsage-pipeline/assets/js/138.d526b503.js" as="script">
<link rel="preload" href="/netsage-pipeline/assets/js/935f2afb.aca71300.js" as="script">
<link rel="preload" href="/netsage-pipeline/assets/js/17896441.5adc4e07.js" as="script">
<link rel="preload" href="/netsage-pipeline/assets/js/e5ce8f83.0611d3ea.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#main" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle" type="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/netsage-pipeline/"><img src="/netsage-pipeline/img/logo.png" alt="NetSage Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/netsage-pipeline/img/logo.png" alt="NetSage Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">NetSage Documentation</strong></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/netsage-pipeline/docs/pipeline/intro">Pipeline Documentation</a><a href="https://netsage-project.github.io/netsage-grafana-configs/" target="_self" rel="noopener noreferrer" class="navbar__item navbar__link">Dashboard Documentation</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__item navbar__link" href="/netsage-pipeline/docs/next/pipeline/intro">master (unreleased)</a><ul class="dropdown__menu"><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/netsage-pipeline/docs/next/deploy/bare_metal_install">master (unreleased)</a></li><li><a class="dropdown__link" href="/netsage-pipeline/docs/deploy/bare_metal_install">1.2.11</a></li><li><a class="dropdown__link" href="/netsage-pipeline/docs/1.2.10/deploy/bare_metal_install">1.2.10</a></li><li><a class="dropdown__link" href="/netsage-pipeline/docs/1.2.9/deploy/bare_metal_install">1.2.9</a></li><li><a class="dropdown__link" href="/netsage-pipeline/docs/1.2.8/deploy/bare_metal_install">1.2.8</a></li><li><a class="dropdown__link" href="/netsage-pipeline/docs/1.2.7/deploy/bare_metal_install">1.2.7</a></li><li><a class="dropdown__link" href="/netsage-pipeline/docs/1.2.6/pipeline">1.2.6</a></li><li><a class="dropdown__link" href="/netsage-pipeline/docs/1.2.5/pipeline">1.2.5</a></li></ul></div><a href="https://github.com/netsage-project/netsage-pipeline/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_GrZ2"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_71bT">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/netsage-pipeline/"><img src="/netsage-pipeline/img/logo.png" alt="NetSage Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/netsage-pipeline/img/logo.png" alt="NetSage Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">NetSage Documentation</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/netsage-pipeline/docs/pipeline/intro">Pipeline Documentation</a></li><li class="menu__list-item"><a href="https://netsage-project.github.io/netsage-grafana-configs/" target="_self" rel="noopener noreferrer" class="menu__link">Dashboard Documentation</a></li><li class="menu__list-item"><a role="button" class="menu__link menu__link--sublist">Versions</a><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active" href="/netsage-pipeline/docs/next/deploy/bare_metal_install">master (unreleased)</a></li><li class="menu__list-item"><a class="menu__link" href="/netsage-pipeline/docs/deploy/bare_metal_install">1.2.11</a></li><li class="menu__list-item"><a class="menu__link" href="/netsage-pipeline/docs/1.2.10/deploy/bare_metal_install">1.2.10</a></li><li class="menu__list-item"><a class="menu__link" href="/netsage-pipeline/docs/1.2.9/deploy/bare_metal_install">1.2.9</a></li><li class="menu__list-item"><a class="menu__link" href="/netsage-pipeline/docs/1.2.8/deploy/bare_metal_install">1.2.8</a></li><li class="menu__list-item"><a class="menu__link" href="/netsage-pipeline/docs/1.2.7/deploy/bare_metal_install">1.2.7</a></li><li class="menu__list-item"><a class="menu__link" href="/netsage-pipeline/docs/1.2.6/pipeline">1.2.6</a></li><li class="menu__list-item"><a class="menu__link" href="/netsage-pipeline/docs/1.2.5/pipeline">1.2.5</a></li></ul></li><li class="menu__list-item"><a href="https://github.com/netsage-project/netsage-pipeline/" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper main-docs-wrapper"><div class="docPage_31aa"><div class="docSidebarContainer_3Kbt" role="complementary"><div class="sidebar_15mo"><div class="menu menu--responsive thin-scrollbar menu_Bmed"><button aria-label="Open menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_fgN0" width="24" height="24" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Pipeline</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/netsage-pipeline/docs/next/pipeline/intro">Intro</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/netsage-pipeline/docs/next/pipeline/tstat">Tstat Data</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/netsage-pipeline/docs/next/pipeline/sensors">Sflow/Netflow Data</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/netsage-pipeline/docs/next/pipeline/pmacct">Pmacct</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/netsage-pipeline/docs/next/pipeline/logstash">Logstash</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/netsage-pipeline/docs/next/pipeline/elastic">Elasticsearch</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Deployment</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/netsage-pipeline/docs/next/deploy/choose_install">Choose Install</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/netsage-pipeline/docs/next/deploy/bare_metal_install">Manual Installation</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/netsage-pipeline/docs/next/deploy/docker_install_simple">Docker Installation</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/netsage-pipeline/docs/next/deploy/docker_install_advanced">Docker Advanced Options</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/netsage-pipeline/docs/next/deploy/docker_upgrade">Docker - Upgrading</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/netsage-pipeline/docs/next/deploy/docker_troubleshoot">Troubleshooting</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Development</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/netsage-pipeline/docs/next/devel/dev_dataset">Replay Dataset</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/netsage-pipeline/docs/next/devel/docker_dev_guide">Docker Dev Guide</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/netsage-pipeline/docs/next/devel/docusaurus">Docusaurus</a></li></ul></li></ul></div></div></div><main class="docMainContainer_3ufF"><div class="container padding-vert--lg docItemWrapper_3FMP"><div class="row"><div class="col docItemCol_3FnS"><div class="alert alert--warning margin-bottom--md" role="alert"><div>This is unreleased documentation for Netsage Pipeline Documentation <strong>master (unreleased)</strong> version.</div><div class="margin-top--md">For up-to-date documentation, see the <strong><a href="/netsage-pipeline/docs/deploy/bare_metal_install">latest version</a></strong> (1.2.11).</div></div><div class="docItemContainer_33ec"><article><div><span class="badge badge--secondary">Version: master (unreleased)</span></div><header><h1 class="docTitle_3a4h">Manual Installation Guide</h1></header><div class="markdown"><p>This document covers installing and running the NetSage Flow Processing Pipeline manually (without using Docker). It assumes a RedHat Linux environment or one of its derivatives.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="data-sources"></a>Data sources<a class="hash-link" href="#data-sources" title="Direct link to heading">#</a></h2><p>The Processing pipeline needs data to ingest in order to do anything. There are two types of data that can be consumed.</p><ol><li>sflow or netflow</li><li>tstat</li></ol><p>At least one of these must be set up on a sensor to provide the incoming flow data.</p><p>See the Docker Installation instuctions for more info.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="installing-the-prerequisites"></a>Installing the Prerequisites<a class="hash-link" href="#installing-the-prerequisites" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="installing-pmacct"></a>Installing Pmacct<a class="hash-link" href="#installing-pmacct" title="Direct link to heading">#</a></h3><p>The pmacct package provides nfacctd and sfacctd processes which receive flow data and write it to a rabbitmq queue.</p><p>Since the pmacct devs have not released a tagged version (or docker containers) since 1.7.7, and we require some commits that fixed an issue for us on Oct 11, 2021, we need to build pmacct from master (or master from some time after Oct 11, 2021).  </p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">    1. Go to the host where you want to install or upgrade nfacctd and sfacctd</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    2. Get dependencies if they were not previously installed on the host (Netsage needs librabbitmq-devel and jansson-devel)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">         $ sudo yum install libpcap-devel  pkgconfig  libtool  autoconf  automake  make</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">         $ sudo yum install libstdc++-devel  gcc-c++  librabbitmq-devel  jansson-devel.x86_64</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    3. Clone the repo</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">         $ git clone https://github.com/pmacct/pmacct.git</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    4. Rename the dir to, eg, pmacct-02Jun2022/, using today&#x27;s date or the date of the code you are going to check out. eg.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">         $ cd pmacct-02June2022</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    5. You should be in master at this point.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">       To build and install a specific release/tag/branch, just check out that tag/branch and proceed.   </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">       We have done testing (and made docker images) with this version:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">         $ git checkout 865a81e1f6c444aab32110a87d72005145fd6f74</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    6. Get ready to build sfacctd and nfacctd   (the following options are needed for Netsage)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">         $ ./autogen.sh</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">         $ ./configure --enable-rabbitmq --enable-jansson             </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    7. Build and install</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">         $ make</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">         $ sudo make install </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">         $ make clean</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">         $ make distclean</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    8. Check the versions</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">         $ sfacctd -V</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">         $ nfacctd -V</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">       These should give something like this where 20220602 is the date:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            nfacctd 1.7.8-git [20220602-0 (5e4b0612)]</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="installing-rabbitmq"></a>Installing RabbitMQ<a class="hash-link" href="#installing-rabbitmq" title="Direct link to heading">#</a></h3><p>A local rabbitmq instance is used to hold flow data until logstash can retreive and process it. </p><p>Typically, the rabbitmq server runs on the same server as the pipeline itself, but if need be, you can separate them (for this reason, the Rabbit server is not automatically installed with the pipeline package).</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly sh"><div tabindex="0" class="prism-code language-sh codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">[root@host ~]# yum install rabbitmq-server</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Typically, the default configuration will work. Perform any desired Rabbit configuration, then, start RabbitMQ:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly sh"><div tabindex="0" class="prism-code language-sh codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">[root@host ~]# /sbin/service rabbitmq-server start </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          or # systemctl start rabbitmq-server.service</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Being able to view the user interface in a browser window is very useful. Look up how to enable it.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="installing-logstash"></a>Installing Logstash<a class="hash-link" href="#installing-logstash" title="Direct link to heading">#</a></h3><p>See the logstash documentation. We are currently using Version 7.16.2.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">Download and install the public signing key</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        sudo rpm --import https://artifacts.elastic.co/GPG-KEY-elasticsearch</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Create or edit /etc/yum.repos.d/ELK.repo</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        [logstash-7.x]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        name=Elastic repository for 7.x packages</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        baseurl=https://artifacts.elastic.co/packages/7.x/yum</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        gpgcheck=1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        gpgkey=https://artifacts.elastic.co/GPG-KEY-elasticsearch</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        enabled=1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        autorefresh=1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        type=rpm-md</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Install</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        sudo yum install logstash</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="installing-the-pipeline"></a>Installing the Pipeline<a class="hash-link" href="#installing-the-pipeline" title="Direct link to heading">#</a></h3><p>Installing the Pipeline just copies config, cron, and systemd files to the correct locations. There are no longer any perl scripts to install.</p><p>The last Pipeline package released by GlobalNOC (<strong>a non-pmacct version</strong>) is in the GlobalNOC Open Source Repo. You can use that, if the version you want is there, or you can just build the rpm from scratch, or manually copy files to the correct locations (the .spec file indicates where).</p><p>(At least formerly, some of our dependencies come from the EPEL repo. We probably don&#x27;t need this repo anymore though.)</p><p>a. To use the GlobalNOC Public repo, for Red Hat/CentOS 7, create <code>/etc/yum.repos.d/grnoc7.repo</code> with the following content.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">[grnoc7]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">name=GlobalNOC Public el7 Packages - $basearch</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">baseurl=https://repo-public.grnoc.iu.edu/repo/7/$basearch</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">enabled=1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">gpgcheck=1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">gpgkey=https://repo-public.grnoc.iu.edu/repo/RPM-GPG-KEY-GRNOC7</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>The first time you install packages from the repo, you will have to accept the GlobalNOC repo key.</p><p>Install the package using yum:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">[root@host ~]# yum install grnoc-netsage-pipeline</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>b. To build the rpm from a git checkout, </p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">git clone https://github.com/netsage-project/netsage-pipeline.git</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">git checkout master  (or a branch)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">cd netsage-pipeline</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">perl Makefile.PL</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">make rpm</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">sudo yum install /&lt;path&gt;/rpmbuild/RPMS/noarch/grnoc-netsage-pipeline-2.0.0-1.el7.noarch.rpm</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     (use &quot;reinstall&quot; if the version number has not changed)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>c. You could also just move files manually to where they need to go. It should be fairly obvious.</p><ul><li>/etc/logstash/conf.d/</li><li>/etc/pmacct/</li><li>/etc/cron.d/</li><li>/usr/bin/</li><li>/etc/systemd/system/</li><li>/var/lib/grnoc/netsage/ and /etc/logstash/conf.d/support/  (cron downloads)</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="logstash-configuration-files"></a>Logstash Configuration Files<a class="hash-link" href="#logstash-configuration-files" title="Direct link to heading">#</a></h2><p>We normally use defaults in Logstash settings files, but for Netsage, which uses the Logstash Aggregation filter, it is <strong>required to use only ONE logstash pipeline worker</strong>.</p><p>IMPORTANT:  Be sure to set <code>pipeline.workers: 1</code> in /etc/logstash/logstash.yml and/or /etc/logstash/pipelines.yml. When running logstash on the command line, use <code>-w 1</code>.</p><p>The Logstash config files containing the &quot;filters&quot; that comprise the Pipeline are installed in /etc/logstash/conf.d/. Most should be used as-is, but the input (01-) and output (99-) configs may be modified for your use.  The aggregation filter (40-) also has settings that may be changed - check the two timeouts and the aggregation maps path. </p><blockquote><p><strong>When processing flows from multiple customers</strong></p><ul><li>We use one logstash instance with multiple &quot;logstash-pipelines&quot;. The logstash-pipelines are defined in /etc/logstash/pipelines.yml. </li><li>Each logstash-pipeline uses config files in a different directory under /etc/logstash/pipelines/. </li><li>Since most of the config files are the same for all logstash-pipelines, we use symlinks back to files in /etc/logstash/conf.d/.</li><li>The exceptions are the input, output, and aggregation files (01-, 99-, and 40-). These are customized so that each logstash-pipeline reads from a different rabbit queue, saves in-progress aggregations to a different file when logstash stops, and writes to a different rabbit queue after processing.</li><li>We normally use one input rabbit queue and logstash-pipeline per customer (where one customer may have multiple sensors), but if there are too many sensors, with too much data, we may split them up into 2 or 3 different input queues and pipelines.</li><li>The output rabbit queues for processed flows may be on a different host (for us, they are). There, additional independent logstash pipelines can grab the flows and stick them into elasticsearch. Various queues may connect to various ES indices. It&#x27;s most convenient to put all flows from sensors that will show up in the same granfana portal together in one index (or set of dated indices). </li></ul></blockquote><p>Check the 15-sensor-specific-changes.conf file. When running without Docker, especially with multiple customers, it&#x27;s much easier to replace the contents of that file, which reference environment file values, with hard-coded &quot;if&quot; stagements and clauses that do just what you need.</p><p>ENV FILE: Our standard processing for Netsage uses the default values for environment variables. These are set directly in the logstash configs. If any of these need to be changed, you can use an environment file: <code>/etc/logstash/logstash-env-vars</code>. The systemd unit file for logstash is set to read this file if it exists.  You could copy into any or all the logstash-related settings from the env.example file. </p><p>Note that this file will be read and used by all logstash-pipelines.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="pmacct-configuration-and-unit-files"></a>Pmacct Configuration and Unit Files<a class="hash-link" href="#pmacct-configuration-and-unit-files" title="Direct link to heading">#</a></h2><p>Each sensor is assumed to send to a different port on the pipeline host, and each port must have a different collector listening for incoming flow data. With pmacct, these collectors are nfacctd and sfacctd processes. Each requires its own config files and systemd unit file. </p><p>The easiest way to make the config files is to use the .env file and the setup-pmacct-compose.sh script that were primarily written for use with docker installations.  See the Docker Installation documentation for details.<br>
Doing just a few sensors at a time, edit the .env file and run the script. After running the script, you will find files like nfacctd_1.conf and nfacctd_1-pretag.map in conf-pmacct/ (in the git checkout). </p><p>You will have to then make the following changes:</p><ul><li>Rename the newly created .conf and .map files, replacing _1 with _sensorName (some string that makes sense to humans).  Similarly of _2, etc.</li><li>Edit each .conf file and change the name of the .map file within to match (the pre_tag_map value) </li><li>Also, in each .conf file<ul><li>change the port number (nfacctd_port or sfacctd_port) to be the port to which the sensor is sending</li><li>change the rabbit host (amqp_host) from &quot;rabbit&quot; to &quot;localhost&quot;</li><li>change the name of the output rabbit queue (amqp_routing_key) to something unique (eg, netsage_deidentifier_raw_sensorName)</li></ul></li><li>Finally, copy the files to /etc/pmacct/
(You can have the script make some of these changes for you if you temporarily edit the conf-pmacct/*.ORIG files.) </li></ul><p>You will also need to create systemd unit files to start and stop each process. Use systemd/sfacctd.service and nfacctd.service as examples. Each should be given a name like nfacctd-sensorName.service. Within the files, edit the config filename in two places. </p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="start-logstash"></a>Start Logstash<a class="hash-link" href="#start-logstash" title="Direct link to heading">#</a></h2><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly sh"><div tabindex="0" class="prism-code language-sh codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain"># systemctl start logstash.service</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>It will take a minute or two to start. Log files are normally /var/log/messages and /var/log/logstash/logstash-plain.log. <code>sudo systemctl status logstash</code> is also handy.  </p><p>Be sure to check to see if it starts ok. If not, look for an error message. If all is ok, the last couple lines should be how many pipelines are running and something about connecting to rabbit.</p><p>NOTE: When logstash is stopped, any flows currently &quot;in the aggregator&quot; will be written out to /tmp/logstash-aggregation-maps (or the path/file set in 40-aggregation.conf). These will be read in and deleted when logstash is started again.  (In some situations, it is desirable to just delete those files before restarting.)</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="start-pmacct-processes"></a>Start Pmacct Processes<a class="hash-link" href="#start-pmacct-processes" title="Direct link to heading">#</a></h2><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly sh"><div tabindex="0" class="prism-code language-sh codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain"># systemctl start nfacctd-sensor1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># systemctl start sfacctd-sensor2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">etc.</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>After starting these processes, it&#x27;s good to check the rabbit UI to watch for incoming flow data. Netflow data usually comes in every minute, depending on router settings, and sflow data should come in every 5 minutes since we have set sfacctd to do some pre-aggregation and send results every 5 minutes. You should also see that the messages are consumed by logstash and there is no long-term accumulation of messages in the queue.</p><p>We have noted that in some cases, pmacct is providing so many flows that logstash cannot keep up and the number of messages in the queue just keeps increaseing! This is an issue that has yet to be resolved.</p><p>Flows should exit the pipeline (and appear in Elasticsearch) after about 15 minutes. The delay is due to aggregation. Long-lasting flows will take longer to exit.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="cron-jobs"></a>Cron jobs<a class="hash-link" href="#cron-jobs" title="Direct link to heading">#</a></h2><p>Inactive cron files are installed (and provided in the cron.d/ directory of the git checkout). Baremetal-netsage-downloads.cron and restart-logstash-service.cron should be in /etc/cron.d/. Please review and uncomment their contents. </p><p>These periodically download MaxMind, CAIDA, and Science Registry files, and also restart logstash. Logstash needs to be restarted in order for any updated files to be used.</p></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/netsage-project/netsage-pipeline/edit/master/website/docs/deploy/bare_metal_install.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" role="img" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-label="Edit page"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/netsage-pipeline/docs/next/deploy/choose_install"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Choosing an Installation Procedure</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/netsage-pipeline/docs/next/deploy/docker_install_simple"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Docker Installation Guide Â»</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#data-sources" class="table-of-contents__link">Data sources</a></li><li><a href="#installing-the-prerequisites" class="table-of-contents__link">Installing the Prerequisites</a><ul><li><a href="#installing-pmacct" class="table-of-contents__link">Installing Pmacct</a></li><li><a href="#installing-rabbitmq" class="table-of-contents__link">Installing RabbitMQ</a></li><li><a href="#installing-logstash" class="table-of-contents__link">Installing Logstash</a></li><li><a href="#installing-the-pipeline" class="table-of-contents__link">Installing the Pipeline</a></li></ul></li><li><a href="#logstash-configuration-files" class="table-of-contents__link">Logstash Configuration Files</a></li><li><a href="#pmacct-configuration-and-unit-files" class="table-of-contents__link">Pmacct Configuration and Unit Files</a></li><li><a href="#start-logstash" class="table-of-contents__link">Start Logstash</a></li><li><a href="#start-pmacct-processes" class="table-of-contents__link">Start Pmacct Processes</a></li><li><a href="#cron-jobs" class="table-of-contents__link">Cron jobs</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2022 NetSage Built with Docusaurus.</div></div></div></footer></div>
<script src="/netsage-pipeline/assets/js/styles.518860af.js"></script>
<script src="/netsage-pipeline/assets/js/runtime~main.b2eafed5.js"></script>
<script src="/netsage-pipeline/assets/js/main.e8d621c4.js"></script>
<script src="/netsage-pipeline/assets/js/1.7a8b56c2.js"></script>
<script src="/netsage-pipeline/assets/js/2.97237792.js"></script>
<script src="/netsage-pipeline/assets/js/137.9a86e881.js"></script>
<script src="/netsage-pipeline/assets/js/138.d526b503.js"></script>
<script src="/netsage-pipeline/assets/js/935f2afb.aca71300.js"></script>
<script src="/netsage-pipeline/assets/js/17896441.5adc4e07.js"></script>
<script src="/netsage-pipeline/assets/js/e5ce8f83.0611d3ea.js"></script>
</body>
</html>