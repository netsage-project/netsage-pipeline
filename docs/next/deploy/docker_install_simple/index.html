<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.72">
<link rel="alternate" type="application/rss+xml" href="/netsage-pipeline/blog/rss.xml" title="Netsage Pipeline Documentation Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/netsage-pipeline/blog/atom.xml" title="Netsage Pipeline Documentation Blog Atom Feed"><title data-react-helmet="true">Docker Installation Guide | Netsage Pipeline Documentation</title><meta data-react-helmet="true" property="og:url" content="https://netsage-project.github.io/netsage-pipeline/docs/next/deploy/docker_install_simple"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Docker Installation Guide | Netsage Pipeline Documentation"><meta data-react-helmet="true" name="description" content="This deployment guide describes how to deploy a basic Netsage setup that includes one sflow and/or one netflow collector.  If you have more than one collector of either type, or other special situations, see the Docker Advanced guide."><meta data-react-helmet="true" property="og:description" content="This deployment guide describes how to deploy a basic Netsage setup that includes one sflow and/or one netflow collector.  If you have more than one collector of either type, or other special situations, see the Docker Advanced guide."><link data-react-helmet="true" rel="shortcut icon" href="/netsage-pipeline/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://netsage-project.github.io/netsage-pipeline/docs/next/deploy/docker_install_simple"><link data-react-helmet="true" rel="alternate" href="https://netsage-project.github.io/netsage-pipeline/docs/next/deploy/docker_install_simple" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://netsage-project.github.io/netsage-pipeline/docs/next/deploy/docker_install_simple" hreflang="x-default"><link rel="stylesheet" href="/netsage-pipeline/assets/css/styles.c0b86565.css">
<link rel="preload" href="/netsage-pipeline/assets/js/styles.518860af.js" as="script">
<link rel="preload" href="/netsage-pipeline/assets/js/runtime~main.b2eafed5.js" as="script">
<link rel="preload" href="/netsage-pipeline/assets/js/main.e8d621c4.js" as="script">
<link rel="preload" href="/netsage-pipeline/assets/js/1.7a8b56c2.js" as="script">
<link rel="preload" href="/netsage-pipeline/assets/js/2.97237792.js" as="script">
<link rel="preload" href="/netsage-pipeline/assets/js/137.9a86e881.js" as="script">
<link rel="preload" href="/netsage-pipeline/assets/js/138.d526b503.js" as="script">
<link rel="preload" href="/netsage-pipeline/assets/js/935f2afb.aca71300.js" as="script">
<link rel="preload" href="/netsage-pipeline/assets/js/17896441.5adc4e07.js" as="script">
<link rel="preload" href="/netsage-pipeline/assets/js/734dc415.36efaa1e.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#main" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle" type="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/netsage-pipeline/"><img src="/netsage-pipeline/img/logo.png" alt="NetSage Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/netsage-pipeline/img/logo.png" alt="NetSage Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">NetSage Documentation</strong></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/netsage-pipeline/docs/pipeline/intro">Pipeline Documentation</a><a href="https://netsage-project.github.io/netsage-grafana-configs/" target="_self" rel="noopener noreferrer" class="navbar__item navbar__link">Dashboard Documentation</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__item navbar__link" href="/netsage-pipeline/docs/next/pipeline/intro">master (unreleased)</a><ul class="dropdown__menu"><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/netsage-pipeline/docs/next/deploy/docker_install_simple">master (unreleased)</a></li><li><a class="dropdown__link" href="/netsage-pipeline/docs/deploy/docker_install_simple">1.2.11</a></li><li><a class="dropdown__link" href="/netsage-pipeline/docs/1.2.10/deploy/docker_install_simple">1.2.10</a></li><li><a class="dropdown__link" href="/netsage-pipeline/docs/1.2.9/deploy/docker_install_simple">1.2.9</a></li><li><a class="dropdown__link" href="/netsage-pipeline/docs/1.2.8/deploy/docker_install_simple">1.2.8</a></li><li><a class="dropdown__link" href="/netsage-pipeline/docs/1.2.7/deploy/docker_install_simple">1.2.7</a></li><li><a class="dropdown__link" href="/netsage-pipeline/docs/1.2.6/pipeline">1.2.6</a></li><li><a class="dropdown__link" href="/netsage-pipeline/docs/1.2.5/pipeline">1.2.5</a></li></ul></div><a href="https://github.com/netsage-project/netsage-pipeline/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_GrZ2"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_71bT">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/netsage-pipeline/"><img src="/netsage-pipeline/img/logo.png" alt="NetSage Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/netsage-pipeline/img/logo.png" alt="NetSage Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">NetSage Documentation</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/netsage-pipeline/docs/pipeline/intro">Pipeline Documentation</a></li><li class="menu__list-item"><a href="https://netsage-project.github.io/netsage-grafana-configs/" target="_self" rel="noopener noreferrer" class="menu__link">Dashboard Documentation</a></li><li class="menu__list-item"><a role="button" class="menu__link menu__link--sublist">Versions</a><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active" href="/netsage-pipeline/docs/next/deploy/docker_install_simple">master (unreleased)</a></li><li class="menu__list-item"><a class="menu__link" href="/netsage-pipeline/docs/deploy/docker_install_simple">1.2.11</a></li><li class="menu__list-item"><a class="menu__link" href="/netsage-pipeline/docs/1.2.10/deploy/docker_install_simple">1.2.10</a></li><li class="menu__list-item"><a class="menu__link" href="/netsage-pipeline/docs/1.2.9/deploy/docker_install_simple">1.2.9</a></li><li class="menu__list-item"><a class="menu__link" href="/netsage-pipeline/docs/1.2.8/deploy/docker_install_simple">1.2.8</a></li><li class="menu__list-item"><a class="menu__link" href="/netsage-pipeline/docs/1.2.7/deploy/docker_install_simple">1.2.7</a></li><li class="menu__list-item"><a class="menu__link" href="/netsage-pipeline/docs/1.2.6/pipeline">1.2.6</a></li><li class="menu__list-item"><a class="menu__link" href="/netsage-pipeline/docs/1.2.5/pipeline">1.2.5</a></li></ul></li><li class="menu__list-item"><a href="https://github.com/netsage-project/netsage-pipeline/" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper main-docs-wrapper"><div class="docPage_31aa"><div class="docSidebarContainer_3Kbt" role="complementary"><div class="sidebar_15mo"><div class="menu menu--responsive thin-scrollbar menu_Bmed"><button aria-label="Open menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_fgN0" width="24" height="24" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Pipeline</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/netsage-pipeline/docs/next/pipeline/intro">Intro</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/netsage-pipeline/docs/next/pipeline/tstat">Tstat Data</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/netsage-pipeline/docs/next/pipeline/sensors">Sflow/Netflow Data</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/netsage-pipeline/docs/next/pipeline/pmacct">Pmacct</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/netsage-pipeline/docs/next/pipeline/logstash">Logstash</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/netsage-pipeline/docs/next/pipeline/elastic">Elasticsearch</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Deployment</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/netsage-pipeline/docs/next/deploy/choose_install">Choose Install</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/netsage-pipeline/docs/next/deploy/bare_metal_install">Manual Installation</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/netsage-pipeline/docs/next/deploy/docker_install_simple">Docker Installation</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/netsage-pipeline/docs/next/deploy/docker_install_advanced">Docker Advanced Options</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/netsage-pipeline/docs/next/deploy/docker_upgrade">Docker - Upgrading</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/netsage-pipeline/docs/next/deploy/docker_troubleshoot">Troubleshooting</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Development</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/netsage-pipeline/docs/next/devel/dev_dataset">Replay Dataset</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/netsage-pipeline/docs/next/devel/docker_dev_guide">Docker Dev Guide</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/netsage-pipeline/docs/next/devel/docusaurus">Docusaurus</a></li></ul></li></ul></div></div></div><main class="docMainContainer_3ufF"><div class="container padding-vert--lg docItemWrapper_3FMP"><div class="row"><div class="col docItemCol_3FnS"><div class="alert alert--warning margin-bottom--md" role="alert"><div>This is unreleased documentation for Netsage Pipeline Documentation <strong>master (unreleased)</strong> version.</div><div class="margin-top--md">For up-to-date documentation, see the <strong><a href="/netsage-pipeline/docs/deploy/docker_install_simple">latest version</a></strong> (1.2.11).</div></div><div class="docItemContainer_33ec"><article><div><span class="badge badge--secondary">Version: master (unreleased)</span></div><header><h1 class="docTitle_3a4h">Docker Installation Guide</h1></header><div class="markdown"><p>This deployment guide describes how to deploy a basic Netsage setup that includes one sflow and/or one netflow collector.  If you have more than one collector of either type, or other special situations, see the Docker Advanced guide.</p><p>The Docker containers included in the installation are</p><ul><li>sfacctd_1 to _n - sflow collectors (one per sflow sensor) - each receives sflow data and writes it to a rabbit queue)</li><li>nfacctd_1 to _n - netflow collector (one per netflow sensor) - each receives netflow data and writes it to a rabbit queue)</li><li>rabbit    - the local RabbitMQ server</li><li>logstash  - logstash pipeline that pulls from the rabbit queue, processes flows, and sends to the final destination</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="1-prepare-a-pipeline-host"></a>1. Prepare a Pipeline Host<a class="hash-link" href="#1-prepare-a-pipeline-host" title="Direct link to heading">#</a></h3><p>Decide where to run the Docker Pipeline, eg, create a VM. The default java heap size for logstash is 4GB so have at least 8GB of memory. Little disk space should be needed.</p><p>Install Docker Engine (docker-ce, docker-ce-cli, containerd.io) - see instructions at <a href="https://docs.docker.com/engine/install/" target="_blank" rel="noopener noreferrer">https://docs.docker.com/engine/install/</a>.</p><p>This page has a good list of post-installation steps you may want or need to do: <a href="https://docker-docs.netlify.app/install/linux/linux-postinstall/" target="_blank" rel="noopener noreferrer">https://docker-docs.netlify.app/install/linux/linux-postinstall/</a>.</p><p>Start docker:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">sudo systemctl docker start</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Docker Compose is not part of Docker Engine, so must be installed separately from Docker&#x27;s GitHub repository - see <a href="https://docs.docker.com/compose/install/" target="_blank" rel="noopener noreferrer">https://docs.docker.com/compose/install/</a>.  You need to <strong>specify version 1.29.2</strong> (or newer) in the curl command. </p><p>Check which file permissions new files are created with on the host. If the <em>logstash</em> user is not able to access the logstash config files in the git checkout, you&#x27;ll get an error from logstash saying there are no .conf files found even though they are there. Defaults of 775 (u=rwx, g=rwx, o=rx) should work.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="2-set-up-data-sources"></a>2. Set up Data Sources<a class="hash-link" href="#2-set-up-data-sources" title="Direct link to heading">#</a></h3><p>The data processing pipeline needs data to ingest in order to do anything, of course. There are three types of data that can be consumed.</p><ul><li>sflow </li><li>netflow</li><li>tstat</li></ul><p>At least one of these must be set up on a <strong>sensor</strong> (i.e., flow <strong>exporter</strong> / router), to provide the incoming flow data.
You can do this step later, but it will helpful to have it working first. </p><p>Configure sflow and netflow to send flow data to the pipeline host. Each sensor/router should send to a different port.
You will list the port numbers in the .env file (see below).
Usually default settings are ok. (Please share your settings with us.)</p><p>On the pipeline host, configure the firewall to allow incoming traffic from the flow exporters, of course.</p><p>Tstat data should be sent directly to the logstash input rabbit queue &quot;netsage_deidentifier_raw&quot; on the pipeline host. No collector is needed for tstat data. See the netsage-project/tstat-transport repo.  (From there, logstash will grab the data and process it the same way as it processes sflow/netflow data.</p><p>Check to see if data is arriving with tcpdump.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="3-clone-the-netsage-pipeline-project"></a>3. Clone the Netsage Pipeline Project<a class="hash-link" href="#3-clone-the-netsage-pipeline-project" title="Direct link to heading">#</a></h3><p>Clone the netsage-pipeline project from github.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly sh"><div tabindex="0" class="prism-code language-sh codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">git clone https://github.com/netsage-project/netsage-pipeline.git</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>When the pipeline runs, it uses some of the files that are in the git checkout, so it is important to checkout the correct version.<br>
Move into the netsage-pipeline/ directory (<strong>all git, docker, and other commands below must be run from inside this directory!</strong>), then checkout the most recent version of the pipeline (normally the most recent tag). It will say you are in &#x27;detached HEAD&#x27; state.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly sh"><div tabindex="0" class="prism-code language-sh codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">cd netsage-pipeline</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">git checkout {tag}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Replace &quot;{tag}&quot; with the release version you intend to use, e.g., &quot;v2.0.0&quot;.  (&quot;Master&quot; is the development version and is not intended for general use!)
<code>git status</code> will confirm which branch you are on, e.g., master or v2.0.0.</p><blockquote><p>Files located in the git checkout that are used by the docker containers and cron:</p><ul><li>the .env file (created by setup script from example file)</li><li>docker-compose.yml (created by setup script from example file) and docker-compose.override.yml (optional)</li><li>logstash config files in conf-logstash/</li><li>non-ORIG nfacctd and sfacctd config files in conf-pmacct/ (created by setup script)</li><li>cron jobs use non-ORIG files in bin/ (created by setup script) and save files to logstash-downloads/ </li><li>logstash may write to or read from logstash-temp/ when it stops or starts
On upgrade, example and ORIG files and files in conf-logstash/ will be overwritten.</li></ul></blockquote><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="4-create-the-environment-file"></a>4. Create the Environment File<a class="hash-link" href="#4-create-the-environment-file" title="Direct link to heading">#</a></h3><p>Next, copy <code>env.example</code> to <code>.env</code>  then edit the .env file to set the number of sensors of each type, the sensor names and ports, and where to send processed flows.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly sh"><div tabindex="0" class="prism-code language-sh codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">cp env.example  .env</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>The .env file is used in multiple ways - by setup scripts as well as by docker-compose and hence logstash and rabbitmq. Everything you need to set is in this one location.</p><p>By default, the number of sflowSensors and netflowSensors is set to 1 at the top.  If you know from the start that you will have only 1 sensor, set either sflowSensors or netflowSensors to 0 and comment out the sensor name and port below. If you know that you will have more than 1 sensor of the same type, specify the number and add variables for the extra sensor names and ports. Note that the variable names need to have _1 replaced by _2, etc. For example,</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">sflowSensors=1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">netflowSensors=2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># sflow sensors:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">sflowSensorName_1=MyNetwork New York Sflow</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">sflowPort_1=8010</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># netflow sensors:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">netflowSensorName_1=MyNetwork LA Netflow</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">netflowPort_1=9000</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">netflowSensorName_2=MyNetwork Seattle Netflow</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">netflowPort_2=9010</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>Sensor names uniquely identify the source of the data and will be shown in the Grafana dashboards so they should be understandable by a general audience.  For example, your sensor names might be &quot;MyNet New York Sflow&quot; or &quot;MyNet New York to London&quot;. (Running your proposed names by a Netsage admin would be helpful.)</p><p>Also, pmacct does not properly handle sensor names containing commas!</p></div></div><p>You will also want to edit the <strong>rabbit_output</strong> variables. This section defines where the final data will land after going through the pipeline.  By default, it will be written to a rabbitmq queue on <code>rabbit</code>, ie, the local rabbitMQ server running in the docker container, but there is nothing provided to do anything further with it.</p><p>To send processed flow data to us, you will need to obtain settings for this section from your contact. A new queue may need to be set up on our end, as well as allowing traffic from your pipeline host. (On our end, data from the this final rabbit queue will be moved into an Elasticsearch instance for storage and viewing in Netsage Portals.)</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="5--run-the-pmacctcompose-setup-script"></a>5.  Run the Pmacct/Compose Setup Script<a class="hash-link" href="#5--run-the-pmacctcompose-setup-script" title="Direct link to heading">#</a></h3><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly sh"><div tabindex="0" class="prism-code language-sh codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">./setup-pmacct-compose.sh</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>This script will use settings in the .env file to create pmacct (ie, nfacctd and sfacctd) config files in <strong>conf-pmacct/</strong> from the .ORIG files in the same directory. </p><p>It will also create <strong>docker-compose.yml</strong> from docker-compose.example.yml, filling in the correct number of nfacctd and sfacctd services and substituting ${var} values from the .env file. (This is needed since pmacct can&#x27;t use environment variables directly, like logstash can.)</p><p>Information in the docker-compose.yml file tells docker which containers to run (or stop).
if needed, you can create a docker-compose.override.yml file; settings in this file will overrule and add to those in docker-compose.yml. All customizations should go in the override file, which will not be overwritten.</p><p>Check the docker-compose file to be sure it looks ok and is consistent with the new config files in conf-pmacct/. All environment variables (${x}) should be filled in. Under ports, there should be two numbers separated by a colon, eg,  &quot;18001:8000/udp&quot;</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="6-run-the-cron-setup-script"></a>6. Run the Cron Setup Script<a class="hash-link" href="#6-run-the-cron-setup-script" title="Direct link to heading">#</a></h3><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly sh"><div tabindex="0" class="prism-code language-sh codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">./setup-cron.sh</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>This script will create docker-netsage-downloads.cron and restart-logstash-container.cron in the checkout&#x27;s <strong>cron.d/</strong> directory, along with matching .sh files in <strong>bin/</strong>. These are based on .ORIG files in the same directories but have required information filled in.</p><p>The docker-netsage-downloads cron job runs the downloads shell script, which will get various files required by the pipeline from scienceregistry.grnoc.iu.edu on a weekly basis.<br>
The restart cron job runs the restart shell script, which restarts the logstash container once a day. Logstash must be restarted to pick up any changes in the downloaded files.</p><p><strong>Note that you need to manually check and then copy the .cron files to /etc/cron.d/.</strong> </p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly sh"><div tabindex="0" class="prism-code language-sh codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">sudo cp cron.d/docker-netsage-downloads.cron  /etc/cron.d/</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">sudo cp cron.d/restart-logstash-container.cron  /etc/cron.d/</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Also, manually run the downloads script to immediately download the required external files.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly sh"><div tabindex="0" class="prism-code language-sh codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">bin/docker-netsage-downloads.sh</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Check to be sure files are in logstash-downloads/.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="8-start-up-the-docker-containers"></a>8. Start up the Docker Containers<a class="hash-link" href="#8-start-up-the-docker-containers" title="Direct link to heading">#</a></h3><p>Start up the pipeline (all containers) using</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly sh"><div tabindex="0" class="prism-code language-sh codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">docker-compose up -d</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>This command will pull down all required docker images and start all the services/containers as listed in the docker-compose.yml and docker-compose.override.yml files.
&quot;-d&quot; runs the containers in the background.</p><p>You can see the status of the containers and whether any have died (exited) using these commands</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly sh"><div tabindex="0" class="prism-code language-sh codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">docker-compose ps</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">docker container ls</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>To check the logs for each of the containers, run</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly sh"><div tabindex="0" class="prism-code language-sh codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">docker-compose logs logstash</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">docker-compose logs rabbit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">docker-compose logs sfacctd_1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">docker-compose logs nfacctd_1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">etc.</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p><code>--timestamps</code>, <code>--tail</code>,  and <code>--since</code> are also useful -- look up details in Docker documentation.</p><p>When running properly, logstash logs should end with a line saying how many pipelines are running and another about connecting to rabbitmq. </p><p>To shut down the pipeline (all containers) use</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly sh"><div tabindex="0" class="prism-code language-sh codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain"># docker-compose down</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p><strong>Run all commands from the netsage-pipeline/ directory.</strong> </p><blockquote><p>Note that if the pipeline host is rebooted, the containers will not restart automatically.</p><p>If this will be a regular occurance on your host, you can add <code>restart:always</code> to each service in the docker-compose.override file (you may need to add any missing services to that file).</p></blockquote><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="9-check-the-rabbitmq-user-interface"></a>9. Check the RabbitMQ User Interface<a class="hash-link" href="#9-check-the-rabbitmq-user-interface" title="Direct link to heading">#</a></h3><p>The rabbitMQ user interface can be used to see if there are incoming flows from pmacct processes and if those flows are being comsumed by logstash.</p><p>In your browser, go to <code>https://&lt;pipeline host&gt;/rabbit</code>  Login with username <em>guest</em>, password <em>guest</em>.  Look at the small graph showing rates for incoming messages, acks, etc. You should see bursts of incoming messages (usually once a minute for netflow and once every 5 min for sflow) and no long-term buildup of messages in the other graph.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="10-check-for-processed-flows"></a>10. Check for processed flows<a class="hash-link" href="#10-check-for-processed-flows" title="Direct link to heading">#</a></h3><ul><li>Ask your contact to check for flows and/or look at dashboards in your grafana portal if it&#x27;s already been set up. Flows should appear after 10-15 minutes.</li><li>Check to be sure the sensor name(s) are correct in the portal. </li><li>Check flow sizes and rates to be sure they are reasonable. (If sampling rate corrections are not being done properly, you may have too few flows and flows which are too small.) You contact can check to see whether flows have @sampling_corrected=yes (a handful from the startup of netflow collection may not) and to check for unusal tags on the flows.</li></ul><p>If you are not seeing flows, see the Troubleshooting section of the documentation.</p></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/netsage-project/netsage-pipeline/edit/master/website/docs/deploy/docker_install_simple.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" role="img" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-label="Edit page"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/netsage-pipeline/docs/next/deploy/bare_metal_install"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Manual Installation Guide</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/netsage-pipeline/docs/next/deploy/docker_install_advanced"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Docker Advanced Options Guide Â»</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#1-prepare-a-pipeline-host" class="table-of-contents__link">1. Prepare a Pipeline Host</a></li><li><a href="#2-set-up-data-sources" class="table-of-contents__link">2. Set up Data Sources</a></li><li><a href="#3-clone-the-netsage-pipeline-project" class="table-of-contents__link">3. Clone the Netsage Pipeline Project</a></li><li><a href="#4-create-the-environment-file" class="table-of-contents__link">4. Create the Environment File</a></li><li><a href="#5--run-the-pmacctcompose-setup-script" class="table-of-contents__link">5.  Run the Pmacct/Compose Setup Script</a></li><li><a href="#6-run-the-cron-setup-script" class="table-of-contents__link">6. Run the Cron Setup Script</a></li><li><a href="#8-start-up-the-docker-containers" class="table-of-contents__link">8. Start up the Docker Containers</a></li><li><a href="#9-check-the-rabbitmq-user-interface" class="table-of-contents__link">9. Check the RabbitMQ User Interface</a></li><li><a href="#10-check-for-processed-flows" class="table-of-contents__link">10. Check for processed flows</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2022 NetSage Built with Docusaurus.</div></div></div></footer></div>
<script src="/netsage-pipeline/assets/js/styles.518860af.js"></script>
<script src="/netsage-pipeline/assets/js/runtime~main.b2eafed5.js"></script>
<script src="/netsage-pipeline/assets/js/main.e8d621c4.js"></script>
<script src="/netsage-pipeline/assets/js/1.7a8b56c2.js"></script>
<script src="/netsage-pipeline/assets/js/2.97237792.js"></script>
<script src="/netsage-pipeline/assets/js/137.9a86e881.js"></script>
<script src="/netsage-pipeline/assets/js/138.d526b503.js"></script>
<script src="/netsage-pipeline/assets/js/935f2afb.aca71300.js"></script>
<script src="/netsage-pipeline/assets/js/17896441.5adc4e07.js"></script>
<script src="/netsage-pipeline/assets/js/734dc415.36efaa1e.js"></script>
</body>
</html>