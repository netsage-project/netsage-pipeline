<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.72">
<link rel="alternate" type="application/rss+xml" href="/netsage-pipeline/blog/rss.xml" title="Netsage Pipeline Documentation Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/netsage-pipeline/blog/atom.xml" title="Netsage Pipeline Documentation Blog Atom Feed"><title data-react-helmet="true">Docker Installation Guide | Netsage Pipeline Documentation</title><meta data-react-helmet="true" property="og:url" content="https://netsage-project.github.io/netsage-pipeline/docs/next/deploy/docker_install_simple"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Docker Installation Guide | Netsage Pipeline Documentation"><meta data-react-helmet="true" name="description" content="In this deployment guide, you will learn how to deploy a basic Netsage setup that includes one sflow and/or one netflow collector.  If you have more than one collector of either type, or other special situations, see the Docker Advanced guide."><meta data-react-helmet="true" property="og:description" content="In this deployment guide, you will learn how to deploy a basic Netsage setup that includes one sflow and/or one netflow collector.  If you have more than one collector of either type, or other special situations, see the Docker Advanced guide."><link data-react-helmet="true" rel="shortcut icon" href="/netsage-pipeline/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://netsage-project.github.io/netsage-pipeline/docs/next/deploy/docker_install_simple"><link data-react-helmet="true" rel="alternate" href="https://netsage-project.github.io/netsage-pipeline/docs/next/deploy/docker_install_simple" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://netsage-project.github.io/netsage-pipeline/docs/next/deploy/docker_install_simple" hreflang="x-default"><link rel="stylesheet" href="/netsage-pipeline/assets/css/styles.414b8674.css">
<link rel="preload" href="/netsage-pipeline/assets/js/styles.957cc5e6.js" as="script">
<link rel="preload" href="/netsage-pipeline/assets/js/runtime~main.b2bd9aaa.js" as="script">
<link rel="preload" href="/netsage-pipeline/assets/js/main.e18dab9f.js" as="script">
<link rel="preload" href="/netsage-pipeline/assets/js/1.d7dedcfb.js" as="script">
<link rel="preload" href="/netsage-pipeline/assets/js/2.1fde247e.js" as="script">
<link rel="preload" href="/netsage-pipeline/assets/js/141.1782d6b8.js" as="script">
<link rel="preload" href="/netsage-pipeline/assets/js/142.d881c78f.js" as="script">
<link rel="preload" href="/netsage-pipeline/assets/js/935f2afb.adbd265e.js" as="script">
<link rel="preload" href="/netsage-pipeline/assets/js/17896441.f3a73913.js" as="script">
<link rel="preload" href="/netsage-pipeline/assets/js/734dc415.632d3b3c.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#main" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle" type="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/netsage-pipeline/"><img src="/netsage-pipeline/img/logo.png" alt="NetSage Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/netsage-pipeline/img/logo.png" alt="NetSage Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">NetSage Documentation</strong></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/netsage-pipeline/docs/pipeline/intro">Pipeline Documentation</a><a href="https://netsage-project.github.io/netsage-grafana-configs/" target="_self" rel="noopener noreferrer" class="navbar__item navbar__link">Dashboard Documentation</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__item navbar__link" href="/netsage-pipeline/docs/next/pipeline/intro">master (unreleased)</a><ul class="dropdown__menu"><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/netsage-pipeline/docs/next/deploy/docker_install_simple">master (unreleased)</a></li><li><a class="dropdown__link" href="/netsage-pipeline/docs/deploy/docker_install_simple">1.2.11</a></li><li><a class="dropdown__link" href="/netsage-pipeline/docs/1.2.10/deploy/docker_install_simple">1.2.10</a></li><li><a class="dropdown__link" href="/netsage-pipeline/docs/1.2.9/deploy/docker_install_simple">1.2.9</a></li><li><a class="dropdown__link" href="/netsage-pipeline/docs/1.2.8/deploy/docker_install_simple">1.2.8</a></li><li><a class="dropdown__link" href="/netsage-pipeline/docs/1.2.7/deploy/docker_install_simple">1.2.7</a></li><li><a class="dropdown__link" href="/netsage-pipeline/docs/1.2.6/pipeline">1.2.6</a></li><li><a class="dropdown__link" href="/netsage-pipeline/docs/1.2.5/pipeline">1.2.5</a></li></ul></div><a href="https://github.com/netsage-project/netsage-pipeline/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_GrZ2"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_71bT">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/netsage-pipeline/"><img src="/netsage-pipeline/img/logo.png" alt="NetSage Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/netsage-pipeline/img/logo.png" alt="NetSage Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">NetSage Documentation</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/netsage-pipeline/docs/pipeline/intro">Pipeline Documentation</a></li><li class="menu__list-item"><a href="https://netsage-project.github.io/netsage-grafana-configs/" target="_self" rel="noopener noreferrer" class="menu__link">Dashboard Documentation</a></li><li class="menu__list-item"><a role="button" class="menu__link menu__link--sublist">Versions</a><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active" href="/netsage-pipeline/docs/next/deploy/docker_install_simple">master (unreleased)</a></li><li class="menu__list-item"><a class="menu__link" href="/netsage-pipeline/docs/deploy/docker_install_simple">1.2.11</a></li><li class="menu__list-item"><a class="menu__link" href="/netsage-pipeline/docs/1.2.10/deploy/docker_install_simple">1.2.10</a></li><li class="menu__list-item"><a class="menu__link" href="/netsage-pipeline/docs/1.2.9/deploy/docker_install_simple">1.2.9</a></li><li class="menu__list-item"><a class="menu__link" href="/netsage-pipeline/docs/1.2.8/deploy/docker_install_simple">1.2.8</a></li><li class="menu__list-item"><a class="menu__link" href="/netsage-pipeline/docs/1.2.7/deploy/docker_install_simple">1.2.7</a></li><li class="menu__list-item"><a class="menu__link" href="/netsage-pipeline/docs/1.2.6/pipeline">1.2.6</a></li><li class="menu__list-item"><a class="menu__link" href="/netsage-pipeline/docs/1.2.5/pipeline">1.2.5</a></li></ul></li><li class="menu__list-item"><a href="https://github.com/netsage-project/netsage-pipeline/" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper main-docs-wrapper"><div class="docPage_31aa"><div class="docSidebarContainer_3Kbt" role="complementary"><div class="sidebar_15mo"><div class="menu menu--responsive thin-scrollbar menu_Bmed"><button aria-label="Open menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_fgN0" width="24" height="24" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Pipeline</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/netsage-pipeline/docs/next/pipeline/intro">Intro</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/netsage-pipeline/docs/next/pipeline/tstat">Tstat Data</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/netsage-pipeline/docs/next/pipeline/nfdump">Sflow/Netflow Data</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/netsage-pipeline/docs/next/pipeline/importer">Importer</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/netsage-pipeline/docs/next/pipeline/logstash">Logstash</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/netsage-pipeline/docs/next/pipeline/elastic">Elasticsearch</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Deployment</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/netsage-pipeline/docs/next/deploy/choose_install">Choose Install</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/netsage-pipeline/docs/next/deploy/bare_metal_install">Manual Installation</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/netsage-pipeline/docs/next/deploy/docker_install_simple">Docker Installation</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/netsage-pipeline/docs/next/deploy/docker_install_advanced">Docker Advanced Options</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/netsage-pipeline/docs/next/deploy/docker_upgrade">Docker - Upgrading</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/netsage-pipeline/docs/next/deploy/docker_troubleshoot">Troubleshooting</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Development</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/netsage-pipeline/docs/next/devel/dev_dataset">Replay Dataset</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/netsage-pipeline/docs/next/devel/docker_dev_guide">Docker Dev Guide</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/netsage-pipeline/docs/next/devel/docusaurus">Docusaurus</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/netsage-pipeline/docs/next/devel/docker_dev_tag">Making Releases</a></li></ul></li></ul></div></div></div><main class="docMainContainer_3ufF"><div class="container padding-vert--lg docItemWrapper_3FMP"><div class="row"><div class="col docItemCol_3FnS"><div class="alert alert--warning margin-bottom--md" role="alert"><div>This is unreleased documentation for Netsage Pipeline Documentation <strong>master (unreleased)</strong> version.</div><div class="margin-top--md">For up-to-date documentation, see the <strong><a href="/netsage-pipeline/docs/deploy/docker_install_simple">latest version</a></strong> (1.2.11).</div></div><div class="docItemContainer_33ec"><article><div><span class="badge badge--secondary">Version: master (unreleased)</span></div><header><h1 class="docTitle_3a4h">Docker Installation Guide</h1></header><div class="markdown"><p>In this deployment guide, you will learn how to deploy a basic Netsage setup that includes one sflow and/or one netflow collector.  If you have more than one collector of either type, or other special situations, see the Docker Advanced guide.</p><p>The Docker containers included in the installation are</p><ul><li>rabbit    (the local RabbitMQ server)</li><li>sflow-collector   (receives sflow data and writes nfcapd files)</li><li>netflow-collector   (receives netflow data and writes nfcapd files)</li><li>importer   (reads nfcapd files and puts flows into a local rabbit queue)</li><li>logstash   (logstash pipeline that processes flows and sends them to their final destination, by default a local rabbit queue)</li><li>ofelia   (cron-like downloading of files used by the logstash pipeline)</li></ul><p>The code and configs for the importer and logstash pipeline can be viewed in the netsage-project/netsage-pipeline github repo. See netsage-project/docker-nfdump-collector for code related to the collectors.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="1-set-up-data-sources"></a>1. Set up Data Sources<a class="hash-link" href="#1-set-up-data-sources" title="Direct link to heading">#</a></h3><p>The data processing pipeline needs data to ingest in order to do anything, of course. There are three types of data that can be consumed.</p><ul><li>sflow </li><li>netflow</li><li>tstat</li></ul><p>At least one of these must be set up on a <em>sensor</em> (i.e., flow <em>exporter</em> / router), to provide the incoming flow data.
You can do this step later, but it will helpful to have it working first. </p><p>Sflow and netflow data should be exported to the pipeline host where there will be <em>collectors</em> (nfcapd and/or sfcapd processes) ready to receive it (see below). To use the default settings, send sflow to port 9998 and netflow/IPFIX to port 9999. On the pipeline host, allow incoming traffic from the flow exporters, of course.</p><p>Tstat data should be sent directly to the logstash input rabbit queue &quot;netsage_deidentifier_raw&quot; on the pipeline host. No collector is needed for tstat data. See the netsage-project/tstat-transport repo.  (From there, logstash will grab the data and process it the same way as it processes sflow/netflow data. (See the Docker Advanced guide.)</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="2-set-up-a-pipeline-host"></a>2. Set up a Pipeline Host<a class="hash-link" href="#2-set-up-a-pipeline-host" title="Direct link to heading">#</a></h3><p>Decide where to run the Docker Pipeline and get it set up. Adjust iptables to allow the flow exporters (routers) to send flow data to the host. </p><p>Install Docker Engine (docker-ce, docker-ce-cli, containerd.io) - see instructions at <a href="https://docs.docker.com/engine/install/" target="_blank" rel="noopener noreferrer">https://docs.docker.com/engine/install/</a>.</p><p>Install Docker Compose from Docker&#x27;s GitHub repository - see <a href="https://docs.docker.com/compose/install/" target="_blank" rel="noopener noreferrer">https://docs.docker.com/compose/install/</a>.  You need to <strong>specify version 1.29.2</strong> (or newer) in the curl command. </p><p>Check default file permissions. If the <em>logstash</em> user is not able to access the logstash config files in the git checkout, you&#x27;ll get an error from logstash saying there are no .conf files found even though they are there. Various components also need to be able to read and write to the data/ directory in the checkout. Defaults of 775 (u=rwx, g=rwx, o=rx) should work.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="3-clone-the-netsage-pipeline-project"></a>3. Clone the Netsage Pipeline Project<a class="hash-link" href="#3-clone-the-netsage-pipeline-project" title="Direct link to heading">#</a></h3><p>Clone the netsage-pipeline project from github.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly sh"><div tabindex="0" class="prism-code language-sh codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">git clone https://github.com/netsage-project/netsage-pipeline.git</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>When the pipeline runs, it uses the logstash conf files that are in the git checkout (in conf-logstash/), as well as a couple other files like docker-compose.yml, so it is important to checkout the correct version.</p><p>Move into the netsage-pipeline/ directory (<strong>all git and docker commands must be run from inside this directory!</strong>), then checkout the most recent version of the code. It will say you are in &#x27;detached HEAD&#x27; state if you don&#x27;t include -b.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly sh"><div tabindex="0" class="prism-code language-sh codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">git checkout {tag}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Replace &quot;{tag}&quot; with the release version you intend to use, e.g., &quot;v1.2.11&quot;.  (&quot;Master&quot; is the development version and is not intended for general use!)
<code>git status</code> will confirm which branch you are on, e.g., master or v1.2.11.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="4-create-docker-composeoverrideyml"></a>4. Create Docker-compose.override.yml<a class="hash-link" href="#4-create-docker-composeoverrideyml" title="Direct link to heading">#</a></h3><p>Information in the <code>docker-compose.yml</code> file tells docker which containers (processes) to run and sets various parameters for them.
Settings in the <code>docker-compose.override.yml</code> file will overrule and add to those. Note that docker-compose.yml should not be edited since upgrades will replace it. Put all customizations in the override file, since override files will not be overwritten.</p><p>Collector settings may need to be edited by the user, so the information that docker uses to run the collectors is specified (only) in the override file. Therefore, docker-compose_override.example.yml must always be copied to docker-compose_override.yml. </p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly sh"><div tabindex="0" class="prism-code language-sh codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">cp docker-compose.override_example.yml docker-compose.override.yml</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>By default docker will bring up a single sflow collector and a single netflow collector that listen to udp traffic on ports localhost:9998 and 9999. If this matches your case, you don&#x27;t need to make any changes to the docker-compose.override_example.yml. </p><ul><li>If you have only one collector, remove or comment out the section for the one not needed so the collector doesn&#x27;t run and simply create empty nfcapd files.</li><li>If the collectors need to listen to different ports, make the appropriate changes here in both the &quot;command:&quot; and &quot;ports:&quot; lines. </li><li>By default, the collectors will save flows to nfcapd files in sflow/ and netflow/ subdirectories in <code>./data/input_data/</code> (i.e., the data/ directory in the git checkout).  If you need to save the data files to a different location, see the Docker Advanced section.</li></ul><p>Other lines in this file you can ignore for now. </p><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>If you run into issues, try removing all the comments in the override file as they may conflict with the parsing done by docker-compose, though we have not found this to be a problem.</p></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="5-choose-pipeline-version"></a>5. Choose Pipeline Version<a class="hash-link" href="#5-choose-pipeline-version" title="Direct link to heading">#</a></h3><p>Once you&#x27;ve created the docker-compose.override.xml file and finished adjusting it for any customizations, you&#x27;re ready to select which image versions Docker should run.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly sh"><div tabindex="0" class="prism-code language-sh codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">./scripts/docker_select_version.sh</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>When prompted, select the <strong>same version</strong> you checked out earlier. </p><p>This script will replace the version numbers of docker images in docker-compose.override.yml and docker-compose.yml with the correct values.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="6-create-environment-file"></a>6. Create Environment File<a class="hash-link" href="#6-create-environment-file" title="Direct link to heading">#</a></h3><p></p><p>Next, copy <code>env.example</code> to <code>.env</code>  </p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly sh"><div tabindex="0" class="prism-code language-sh codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">cp env.example .env </span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>then edit the .env file to set the sensor names to unique identifiers (with spaces or not, no quotes)</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly sh"><div tabindex="0" class="prism-code language-sh codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain"># Importer settings</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">sflowSensorName=My sflow sensor name</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">netflowSensorName=My netflow sensor name</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><ul><li>If you have only one collector, remove or comment out the line for the one you are not using.</li><li>If you have more than one of the same type of collector, see the &quot;Docker Advanced&quot; documentation.</li></ul><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>These names uniquely identify the source of the data and will be shown in the Grafana dashboards. In elasticsearch, they are saved in the <code>meta.sensor_id</code> field. Choose names that are meaningful and unique.
For example, your sensor names might be &quot;MyNet New York Sflow&quot; and &quot;MyNet Boston Netflow&quot; or &quot;MyNet New York - London&quot; and &quot;MyNet New York - Paris&quot;. Whatever makes sense in your situation.</p></div></div><p>You will also want to edit the <strong>Logstash output rabbit queue</strong> section. This section defines where the final data will land after going through the pipeline.  By default, it will be written to a rabbitmq queue on <code>rabbit</code>, ie, the local rabbitMQ server running in the docker container. Enter a hostname to send to a remote rabbitMQ server (also the correct username, password, and queue key/name). </p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly sh"><div tabindex="0" class="prism-code language-sh codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">rabbitmq_output_host=rabbit@mynet.edu</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">rabbitmq_output_username=guest</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">rabbitmq_output_pw=guest</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">rabbitmq_output_key=netsage_archive_input</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>To send processed flow data to GlobalNOC at Indiana University, you will need to obtain settings for this section from your contact. A new queue may need to be set up at IU, as well as allowing traffic from your pipeline host. (At IU, data from the this final rabbit queue will be moved into an Elasticsearch instance for storage and viewing.)</p></div></div><p>The following options are described in the Docker Advanced section:</p><p><strong>To drop all flows except those using the specfied interfaces</strong>: Use if only some flows from a router are of interest and those can be identified by interface.</p><p><strong>To change the sensor name for flows using a certain interface</strong>: Use if you want to break out some flows coming into a port and give them a different sensor name.</p><p><strong>To &quot;manually&quot; correct flow sizes and rates for sampling for specified sensors</strong>: Use if sampling corrections are not being done automatically. Normally you do not need to use this, but check flows to be sure results are reasonable.</p><p></p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="testing-the-collectors"></a>Testing the Collectors<a class="hash-link" href="#testing-the-collectors" title="Direct link to heading">#</a></h2><p>At this point, you can start the two flow collectors by themselves by running the following line. If you only need one of the collectors, remove the other from this command.  </p><p>(See the next section for how to start all the containers, including the collectors.)</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly sh"><div tabindex="0" class="prism-code language-sh codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">docker-compose up -d sflow-collector netflow-collector</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Subdirectories for sflow/netflow, year, month, and day are created automatically under <code>data/input_data/</code>. File names contain dates and times.
These are not text files; to view the contents, use an <a href="http://www.linuxcertif.com/man/1/nfdump/" target="_blank" rel="noopener noreferrer">nfdump command</a> (you will need to install nfdump).
Files will be deleted automatically by the importer as they age out (the default is to keep 3 days).  </p><p>If the collector(s) are running properly, you should see nfcapd files being written every 5 minutes and they should have sizes of more than a few hundred bytes. (Empty files still have header and footer lines.)<br>
See Troubleshooting if you have problems.</p><p>To stop the collectors</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly sh"><div tabindex="0" class="prism-code language-sh codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">docker-compose down </span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="running-the-collectors-and-pipeline"></a>Running the Collectors and Pipeline<a class="hash-link" href="#running-the-collectors-and-pipeline" title="Direct link to heading">#</a></h2><p></p><p>Start up the pipeline (all containers) using:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly sh"><div tabindex="0" class="prism-code language-sh codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain"># docker-compose up -d</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>This will also restart any containers/processes that have died. &quot;-d&quot; runs containers in the background.</p><p>You can see the status of the containers and whether any have died (exited) using</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly sh"><div tabindex="0" class="prism-code language-sh codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain"># docker-compose ps</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>To check the logs for each of the containers, run</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly sh"><div tabindex="0" class="prism-code language-sh codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain"># docker-compose logs</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># docker-compose logs logstash</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># docker-compose logs importer</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">etc.</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Add <code>-f</code> or, e.g., <code>-f logstash</code> to see new log messages as they arrive.  <code>--timestamps</code>, <code>--tail</code>,  and <code>--since</code> are also useful -- look up details in Docker documentation.</p><p>To shut down the pipeline (all containers) use</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly sh"><div tabindex="0" class="prism-code language-sh codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain"># docker-compose down</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Run all commands from the netsage-pipeline/ directory.</p><p></p></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/netsage-project/netsage-pipeline/edit/master/website/docs/deploy/docker_install_simple.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" role="img" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-label="Edit page"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/netsage-pipeline/docs/next/deploy/bare_metal_install"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Manual Installation Guide</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/netsage-pipeline/docs/next/deploy/docker_install_advanced"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Docker Advanced Options Guide Â»</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#1-set-up-data-sources" class="table-of-contents__link">1. Set up Data Sources</a></li><li><a href="#2-set-up-a-pipeline-host" class="table-of-contents__link">2. Set up a Pipeline Host</a></li><li><a href="#3-clone-the-netsage-pipeline-project" class="table-of-contents__link">3. Clone the Netsage Pipeline Project</a></li><li><a href="#4-create-docker-composeoverrideyml" class="table-of-contents__link">4. Create Docker-compose.override.yml</a></li><li><a href="#5-choose-pipeline-version" class="table-of-contents__link">5. Choose Pipeline Version</a></li><li><a href="#6-create-environment-file" class="table-of-contents__link">6. Create Environment File</a></li><li><a href="#testing-the-collectors" class="table-of-contents__link">Testing the Collectors</a></li><li><a href="#running-the-collectors-and-pipeline" class="table-of-contents__link">Running the Collectors and Pipeline</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2021 NetSage Built with Docusaurus.</div></div></div></footer></div>
<script src="/netsage-pipeline/assets/js/styles.957cc5e6.js"></script>
<script src="/netsage-pipeline/assets/js/runtime~main.b2bd9aaa.js"></script>
<script src="/netsage-pipeline/assets/js/main.e18dab9f.js"></script>
<script src="/netsage-pipeline/assets/js/1.d7dedcfb.js"></script>
<script src="/netsage-pipeline/assets/js/2.1fde247e.js"></script>
<script src="/netsage-pipeline/assets/js/141.1782d6b8.js"></script>
<script src="/netsage-pipeline/assets/js/142.d881c78f.js"></script>
<script src="/netsage-pipeline/assets/js/935f2afb.adbd265e.js"></script>
<script src="/netsage-pipeline/assets/js/17896441.f3a73913.js"></script>
<script src="/netsage-pipeline/assets/js/734dc415.632d3b3c.js"></script>
</body>
</html>