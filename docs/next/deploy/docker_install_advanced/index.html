<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.72">
<link rel="alternate" type="application/rss+xml" href="/netsage-pipeline/blog/rss.xml" title="Netsage Pipeline Documentation Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/netsage-pipeline/blog/atom.xml" title="Netsage Pipeline Documentation Blog Atom Feed"><title data-react-helmet="true">Docker Advanced Options Guide | Netsage Pipeline Documentation</title><meta data-react-helmet="true" property="og:url" content="https://netsage-project.github.io/netsage-pipeline/docs/next/deploy/docker_install_advanced"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Docker Advanced Options Guide | Netsage Pipeline Documentation"><meta data-react-helmet="true" name="description" content="The following customizations will allow for more complex situations than described in the Docker Installation guide. Find the section(s) which apply to you."><meta data-react-helmet="true" property="og:description" content="The following customizations will allow for more complex situations than described in the Docker Installation guide. Find the section(s) which apply to you."><link data-react-helmet="true" rel="shortcut icon" href="/netsage-pipeline/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://netsage-project.github.io/netsage-pipeline/docs/next/deploy/docker_install_advanced"><link data-react-helmet="true" rel="alternate" href="https://netsage-project.github.io/netsage-pipeline/docs/next/deploy/docker_install_advanced" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://netsage-project.github.io/netsage-pipeline/docs/next/deploy/docker_install_advanced" hreflang="x-default"><link rel="stylesheet" href="/netsage-pipeline/assets/css/styles.c0b86565.css">
<link rel="preload" href="/netsage-pipeline/assets/js/styles.518860af.js" as="script">
<link rel="preload" href="/netsage-pipeline/assets/js/runtime~main.b2eafed5.js" as="script">
<link rel="preload" href="/netsage-pipeline/assets/js/main.e8d621c4.js" as="script">
<link rel="preload" href="/netsage-pipeline/assets/js/1.7a8b56c2.js" as="script">
<link rel="preload" href="/netsage-pipeline/assets/js/2.97237792.js" as="script">
<link rel="preload" href="/netsage-pipeline/assets/js/137.9a86e881.js" as="script">
<link rel="preload" href="/netsage-pipeline/assets/js/138.d526b503.js" as="script">
<link rel="preload" href="/netsage-pipeline/assets/js/935f2afb.aca71300.js" as="script">
<link rel="preload" href="/netsage-pipeline/assets/js/17896441.5adc4e07.js" as="script">
<link rel="preload" href="/netsage-pipeline/assets/js/cbd1c0d0.0373c1b1.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#main" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle" type="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/netsage-pipeline/"><img src="/netsage-pipeline/img/logo.png" alt="NetSage Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/netsage-pipeline/img/logo.png" alt="NetSage Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">NetSage Documentation</strong></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/netsage-pipeline/docs/pipeline/intro">Pipeline Documentation</a><a href="https://netsage-project.github.io/netsage-grafana-configs/" target="_self" rel="noopener noreferrer" class="navbar__item navbar__link">Dashboard Documentation</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__item navbar__link" href="/netsage-pipeline/docs/next/pipeline/intro">master (unreleased)</a><ul class="dropdown__menu"><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/netsage-pipeline/docs/next/deploy/docker_install_advanced">master (unreleased)</a></li><li><a class="dropdown__link" href="/netsage-pipeline/docs/deploy/docker_install_advanced">1.2.11</a></li><li><a class="dropdown__link" href="/netsage-pipeline/docs/1.2.10/deploy/docker_install_advanced">1.2.10</a></li><li><a class="dropdown__link" href="/netsage-pipeline/docs/1.2.9/deploy/docker_install_advanced">1.2.9</a></li><li><a class="dropdown__link" href="/netsage-pipeline/docs/1.2.8/deploy/docker_install_advanced">1.2.8</a></li><li><a class="dropdown__link" href="/netsage-pipeline/docs/1.2.7/deploy/docker_install_advanced">1.2.7</a></li><li><a class="dropdown__link" href="/netsage-pipeline/docs/1.2.6/pipeline">1.2.6</a></li><li><a class="dropdown__link" href="/netsage-pipeline/docs/1.2.5/pipeline">1.2.5</a></li></ul></div><a href="https://github.com/netsage-project/netsage-pipeline/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_GrZ2"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_71bT">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/netsage-pipeline/"><img src="/netsage-pipeline/img/logo.png" alt="NetSage Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/netsage-pipeline/img/logo.png" alt="NetSage Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">NetSage Documentation</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/netsage-pipeline/docs/pipeline/intro">Pipeline Documentation</a></li><li class="menu__list-item"><a href="https://netsage-project.github.io/netsage-grafana-configs/" target="_self" rel="noopener noreferrer" class="menu__link">Dashboard Documentation</a></li><li class="menu__list-item"><a role="button" class="menu__link menu__link--sublist">Versions</a><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active" href="/netsage-pipeline/docs/next/deploy/docker_install_advanced">master (unreleased)</a></li><li class="menu__list-item"><a class="menu__link" href="/netsage-pipeline/docs/deploy/docker_install_advanced">1.2.11</a></li><li class="menu__list-item"><a class="menu__link" href="/netsage-pipeline/docs/1.2.10/deploy/docker_install_advanced">1.2.10</a></li><li class="menu__list-item"><a class="menu__link" href="/netsage-pipeline/docs/1.2.9/deploy/docker_install_advanced">1.2.9</a></li><li class="menu__list-item"><a class="menu__link" href="/netsage-pipeline/docs/1.2.8/deploy/docker_install_advanced">1.2.8</a></li><li class="menu__list-item"><a class="menu__link" href="/netsage-pipeline/docs/1.2.7/deploy/docker_install_advanced">1.2.7</a></li><li class="menu__list-item"><a class="menu__link" href="/netsage-pipeline/docs/1.2.6/pipeline">1.2.6</a></li><li class="menu__list-item"><a class="menu__link" href="/netsage-pipeline/docs/1.2.5/pipeline">1.2.5</a></li></ul></li><li class="menu__list-item"><a href="https://github.com/netsage-project/netsage-pipeline/" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper main-docs-wrapper"><div class="docPage_31aa"><div class="docSidebarContainer_3Kbt" role="complementary"><div class="sidebar_15mo"><div class="menu menu--responsive thin-scrollbar menu_Bmed"><button aria-label="Open menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_fgN0" width="24" height="24" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Pipeline</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/netsage-pipeline/docs/next/pipeline/intro">Intro</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/netsage-pipeline/docs/next/pipeline/tstat">Tstat Data</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/netsage-pipeline/docs/next/pipeline/sensors">Sflow/Netflow Data</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/netsage-pipeline/docs/next/pipeline/pmacct">Pmacct</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/netsage-pipeline/docs/next/pipeline/logstash">Logstash</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/netsage-pipeline/docs/next/pipeline/elastic">Elasticsearch</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Deployment</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/netsage-pipeline/docs/next/deploy/choose_install">Choose Install</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/netsage-pipeline/docs/next/deploy/bare_metal_install">Manual Installation</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/netsage-pipeline/docs/next/deploy/docker_install_simple">Docker Installation</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/netsage-pipeline/docs/next/deploy/docker_install_advanced">Docker Advanced Options</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/netsage-pipeline/docs/next/deploy/docker_upgrade">Docker - Upgrading</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/netsage-pipeline/docs/next/deploy/docker_troubleshoot">Troubleshooting</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Development</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/netsage-pipeline/docs/next/devel/dev_dataset">Replay Dataset</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/netsage-pipeline/docs/next/devel/docker_dev_guide">Docker Dev Guide</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/netsage-pipeline/docs/next/devel/docusaurus">Docusaurus</a></li></ul></li></ul></div></div></div><main class="docMainContainer_3ufF"><div class="container padding-vert--lg docItemWrapper_3FMP"><div class="row"><div class="col docItemCol_3FnS"><div class="alert alert--warning margin-bottom--md" role="alert"><div>This is unreleased documentation for Netsage Pipeline Documentation <strong>master (unreleased)</strong> version.</div><div class="margin-top--md">For up-to-date documentation, see the <strong><a href="/netsage-pipeline/docs/deploy/docker_install_advanced">latest version</a></strong> (1.2.11).</div></div><div class="docItemContainer_33ec"><article><div><span class="badge badge--secondary">Version: master (unreleased)</span></div><header><h1 class="docTitle_3a4h">Docker Advanced Options Guide</h1></header><div class="markdown"><p>The following customizations will allow for more complex situations than described in the Docker Installation guide. Find the section(s) which apply to you.</p><p><em>Please first read the Docker Installation guide in detail. This guide will build on top of that.</em></p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="to-add-additional-sflow-or-netflow-collectors"></a>To Add Additional Sflow or Netflow Collectors<a class="hash-link" href="#to-add-additional-sflow-or-netflow-collectors" title="Direct link to heading">#</a></h2><p>Any number of sensors can be accomodated, although if there are more than a few being processed by the same pipeline, you may run into scaling issues. </p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="a-edit-environment-file"></a>a. Edit environment file<a class="hash-link" href="#a-edit-environment-file" title="Direct link to heading">#</a></h4><p>As an example, say we have three netflow sensors. In the .env file, first set <code>netflowSensors=3</code>. Then, in the next section, add the actual sensor names and ports for the additional sensors using variable names ending with _2 and _3. An example:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">netflowSensorName_1=The 1st Netflow Sensor Name</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">netflowPort_1=9000</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">netflowSensorName_2=The 2nd Netflow Sensor Name</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">netflowPort_2=9001</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">netflowSensorName_3=The 3rd Netflow Sensor Name</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">netflowPort_3=9002</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="b-rerun-setup-pmacct-composesh"></a>b. Rerun setup-pmacct-compose.sh<a class="hash-link" href="#b-rerun-setup-pmacct-composesh" title="Direct link to heading">#</a></h4><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">./setup-pmacct-compose.sh</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Check the new docker-compose.yml and files in conf-pmacct/ for consistency.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="d-start-new-containers"></a>d. Start new containers<a class="hash-link" href="#d-start-new-containers" title="Direct link to heading">#</a></h4><p>To be safe, bring everything down first, then back up.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">docker-compose down</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">docker-compose up -d</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="to-filter-flows-by-interface"></a>To Filter Flows by Interface<a class="hash-link" href="#to-filter-flows-by-interface" title="Direct link to heading">#</a></h2><p>If your sensors are exporting all flows, but only those using particular interfaces are relevant, use this option in the .env file. All incoming flows will be read in, but the logstash pipeline will drop those that do not have src_ifindex OR dst_inindex equal to one of those listed.  (Processing a large number of unecessary flows may overwhelm logstash, so if at all possible, try to limit the flows at the router level or using iptables.) </p><p>In the .env file, uncomment lines in the appropriate section and enter the information required. &quot;ALL&quot; can refer to all sensors or all interfaces of a sensor. If a sensor is not referenced at all, all of its flows will be kept. Be sure <code>ifindex_filter_flag=True</code> with &quot;True&quot; capitalized as shown, any sensor names are spelled exactly right, and list all the ifindex values of flows that should be kept and processed. Use semicolons to separate sensors. Some examples (use just one!):</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly sh"><div tabindex="0" class="prism-code language-sh codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">ifindex_filter_flag=True</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">## examples (include only 1 such line):</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">ifindex_filter_keep=ALL:123</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">ifindex_filter_keep=Sensor 1: 123</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">ifindex_filter_keep=Sensor 1: 456, 789</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">ifindex_filter_keep=Sensor 1: ALL; Sensor 2: 800, 900</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><ul><li>In the first example, all flows that have src_ifindex = 123 or dst_ifindex = 123 will be kept, regardless of sensor name. All other flows will be discarded.</li><li>In the 2nd case, if src or dst ifindex is 123 and the sensor name is &quot;Sensor 1&quot;, the flow will be kept. If there are flows from &quot;Sensor 2&quot;, all of them will be kept.</li><li>In the 3rd case, flows from Sensor 1 having ifindex 456 or 789 will be kept.</li><li>In the last example, all Sensor 1 flows will be kept, and those from Sensor 2 having ifindex 800 or 900 will be kept.  </li></ul><p>Spaces don&#x27;t matter except within the sensor names. Punctuation is required as shown.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="to-filter-flows-by-subnet"></a>To Filter Flows by Subnet<a class="hash-link" href="#to-filter-flows-by-subnet" title="Direct link to heading">#</a></h2><p>With this option, flows from specified sensors will be dropped unless src or dst is in the list of subnets to keep. It works similarly to the option to filter by interface.  &quot;ALL&quot; can refer to all sensors.
If a sensor is not referenced at all, all of its flows will be kept. </p><p>For example,</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">subnet_filter_flag=True</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">subnet_filter_keep=Sensor A Name: 123.45.6.0/16; Sensor B Name: 123.33.33.0/24, 456.66.66.0/24</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="to-change-a-sensor-name-depending-on-the-interface-used"></a>To Change a Sensor Name Depending on the Interface Used<a class="hash-link" href="#to-change-a-sensor-name-depending-on-the-interface-used" title="Direct link to heading">#</a></h2><p>In some cases, users want to keep all flows from a certain sensor but differentiate between those that enter or exit through a specific interface by using a different sensor name.</p><p>In the .env file, uncomment the appropriate section and enter the information required. Be sure &quot;True&quot; is capitalized as shown and all four fields are set properly! For example,</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly sh"><div tabindex="0" class="prism-code language-sh codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">ifindex_sensor_rename_flag=True</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">ifindex_sensor_rename_ifindex=10032</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">ifindex_sensor_rename_old_name=MyNet Sflow </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">ifindex_sensor_rename_new_name=MyNet Bloomington Sflow</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>In this case, any flows from the &quot;MyNet Sflow&quot; sensor that use interface 10032 (src_ifindex = 10032 OR dst_ifindex = 10032) will have the sensor name changed from &quot;MyNet Sflow&quot; to &quot;MyNet Bloomington Sflow&quot;. </p><p>Currently, only one such rename can be configured in Docker and only 1 ifindex is allowed.</p><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>Please notify the devs in advance, if you need to modify a sensor name, because the regexes used for determining sensor_group and sensor_type may have to be updated.</p></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="to-do-sampling-rate-corrections-in-logstash"></a>To Do Sampling Rate Corrections in Logstash<a class="hash-link" href="#to-do-sampling-rate-corrections-in-logstash" title="Direct link to heading">#</a></h2><p>When flow sampling is done, corrections have to be applied to the number of packets and bytes. For example, if you are sampling 1 out of 100 flows, for each flow measured, it is assumed that in reality there would be 100 flows of that size with that src and dst, so the number of bits (and the number of packets, bits/s and packets/s) is multiplied by 100. Usually the collector (nfacctd or sfacctd process) gets the sampling rate from the incoming data and applies the correction, but in some cases, the sensor may not send the sampling rate, or there may be a complex set-up that requires a manual correction. </p><p>In the .env file, uncomment the appropriate section and enter the information required. Be sure &quot;True&quot; is capitalized as shown and all 3 fields are set properly! The same correction can be applied to multiple sensors by using a semicolon-separated list. The same correction applies to all listed sensors. For example,</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly sh"><div tabindex="0" class="prism-code language-sh codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">sampling_correction_flag=True</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">sampling_correction_sensors=MyNet Bloomington Sflow; MyNet Indy Sflow</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">sampling_correction_factor=512</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>In this example, all flows from sensors &quot;MyNet Bloomington Sflow&quot; and &quot;MyNet Indy Sflow&quot; will have a correction factor of 512 applied by logstash. Any other sensors will not have a correction applied by logstash (presumably pmacct would apply the correction automatically).</p><p>Only one correction factor is allowed for, so you can&#x27;t, for example correct Sensor A with a factor of 512 and also Sensor B with a factor of 100.</p><blockquote><p>Note that if pmacct has made a sampling correction already, no additional manual correction will be applied, even if these options are set,
so this can be used <em>to be sure</em> a sampling correction is applied.</p></blockquote><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="to-not-deidentify-flows"></a>To NOT Deidentify Flows<a class="hash-link" href="#to-not-deidentify-flows" title="Direct link to heading">#</a></h2><p>Normally all flows are deidentified before being saved to elasticsearch by truncating the src and dst IP addresses. If you do NOT want to do this, set full_IPs_flag to True. (You will most likely want to request access control on the grafana portal, as well.)</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain"># To keep full IP addresses, set this parameter to True.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">full_IPs_flag=True</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="to-increase-memory-available-for-lostash"></a>To Increase Memory Available for Lostash<a class="hash-link" href="#to-increase-memory-available-for-lostash" title="Direct link to heading">#</a></h2><p>If cpu or memory usage seems to be a problem, try increasing the java JVM heap size for logstash from 4GB to 8GB.</p><p>To do this, edit LS_JAVA_OPTS in the .env file. E.g.,</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly yaml"><div tabindex="0" class="prism-code language-yaml codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">LS_JAVA_OPTS=</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">Xmx8g </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">Xms8g</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Here are some tips for adjusting the JVM heap size (see <a href="https://www.elastic.co/guide/en/logstash/current/jvm-settings.html" target="_blank" rel="noopener noreferrer">https://www.elastic.co/guide/en/logstash/current/jvm-settings.html</a>):</p><ul><li>Set the minimum (Xms) and maximum (Xmx) heap allocation size to the same value to prevent the heap from resizing at runtime, which is a very costly process.</li><li>CPU utilization can increase unnecessarily if the heap size is too low, resulting in the JVM constantly garbage collecting. You can check for this issue by doubling the heap size to see if performance improves.</li><li>Do not increase the heap size past the amount of physical memory. Some memory must be left to run the OS and other processes. As a general guideline for most installations, donâ€™t exceed 50-75% of physical memory. The more memory you have, the higher percentage you can use.</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="to-overwrite-organization-names-when-an-asn-is-shared"></a>To Overwrite Organization Names When an ASN is Shared<a class="hash-link" href="#to-overwrite-organization-names-when-an-asn-is-shared" title="Direct link to heading">#</a></h2><p>Source and destination organization names come from lookups by ASN or IP in databases provided by CAIDA or MaxMind. (The former is preferred, the latter acts as a backup.)
Sometimes an organization that owns an AS and a large block of IPs will allow members or subentities to use certain IP ranges within the same AS.
In this case, all flows to and from the members will have src or dst organization set to the parent organization&#x27;s name. If desired, the member organizations&#x27; names can be substituted. To do so requires the use of a &quot;member list&quot; which specifies the ASN(s) being shared and the IP ranges for each member. </p><p>See <strong>conf-logstash/support/networkA-members-list.rb.example</strong> for an example. </p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="to-tag-flows-with-science-discipline-information"></a>To Tag Flows with Science Discipline Information<a class="hash-link" href="#to-tag-flows-with-science-discipline-information" title="Direct link to heading">#</a></h2><p>At <a href="https://scienceregistry.netsage.global" target="_blank" rel="noopener noreferrer">https://scienceregistry.netsage.global</a>, you can see a hand-curated list of resources (IP blocks) which are linked to the organizations, sciences, and projects that use them. This information is used by the Netsage pipeline to tag science-related flows. If you would like to see your resources or projects included, please contact us to have them added to the Registry. </p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="to-use-iptables-to-block-some-incoming-traffic"></a>To Use IPtables to Block Some Incoming Traffic<a class="hash-link" href="#to-use-iptables-to-block-some-incoming-traffic" title="Direct link to heading">#</a></h2><p>In certain situations, you may want to use a firewall to block some of the traffic coming to your pipeline host so that it does not enter the docker containers. For example, if multiple routers must send to the same port on the host, but you only want to process flows from one of them, you can use iptables to block traffic from the those you don&#x27;t want. </p><p>With Docker, the INPUT chain in iptables is skipped and instead the FORWARDING chain is used. The first rule of the FORWARDING chain is to read the DOCKER-USER chain. This chain will contain docker rules that aren&#x27;t overridden by docker. Rules that Docker creates are added to theÂ DOCKERÂ chain; do not manipulate this chain manually. </p><p>To allow only a specific IP or network to access the containers, insert a negated rule at the top of theÂ DOCKER-USERÂ filter chain (or an accept then a drop all others). </p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="to-bring-up-kibana-and-elasticsearch-containers"></a>To Bring up Kibana and Elasticsearch Containers<a class="hash-link" href="#to-bring-up-kibana-and-elasticsearch-containers" title="Direct link to heading">#</a></h2><p>The file docker-compose.develop.yaml can be used in conjunction with docker-compose.yaml to bring up the optional Kibana and Elastic Search components.</p><p>This isn&#x27;t a production pattern but the tools can be useful at times. Please refer to the <a href="/netsage-pipeline/docs/next/devel/docker_dev_guide#optional-elasticsearch-and-kibana">Docker Dev Guide</a></p></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/netsage-project/netsage-pipeline/edit/master/website/docs/deploy/docker_install_advanced.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" role="img" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-label="Edit page"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/netsage-pipeline/docs/next/deploy/docker_install_simple"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Docker Installation Guide</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/netsage-pipeline/docs/next/deploy/docker_upgrade"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Upgrading Â»</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#to-add-additional-sflow-or-netflow-collectors" class="table-of-contents__link">To Add Additional Sflow or Netflow Collectors</a></li><li><a href="#to-filter-flows-by-interface" class="table-of-contents__link">To Filter Flows by Interface</a></li><li><a href="#to-filter-flows-by-subnet" class="table-of-contents__link">To Filter Flows by Subnet</a></li><li><a href="#to-change-a-sensor-name-depending-on-the-interface-used" class="table-of-contents__link">To Change a Sensor Name Depending on the Interface Used</a></li><li><a href="#to-do-sampling-rate-corrections-in-logstash" class="table-of-contents__link">To Do Sampling Rate Corrections in Logstash</a></li><li><a href="#to-not-deidentify-flows" class="table-of-contents__link">To NOT Deidentify Flows</a></li><li><a href="#to-increase-memory-available-for-lostash" class="table-of-contents__link">To Increase Memory Available for Lostash</a></li><li><a href="#to-overwrite-organization-names-when-an-asn-is-shared" class="table-of-contents__link">To Overwrite Organization Names When an ASN is Shared</a></li><li><a href="#to-tag-flows-with-science-discipline-information" class="table-of-contents__link">To Tag Flows with Science Discipline Information</a></li><li><a href="#to-use-iptables-to-block-some-incoming-traffic" class="table-of-contents__link">To Use IPtables to Block Some Incoming Traffic</a></li><li><a href="#to-bring-up-kibana-and-elasticsearch-containers" class="table-of-contents__link">To Bring up Kibana and Elasticsearch Containers</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2022 NetSage Built with Docusaurus.</div></div></div></footer></div>
<script src="/netsage-pipeline/assets/js/styles.518860af.js"></script>
<script src="/netsage-pipeline/assets/js/runtime~main.b2eafed5.js"></script>
<script src="/netsage-pipeline/assets/js/main.e8d621c4.js"></script>
<script src="/netsage-pipeline/assets/js/1.7a8b56c2.js"></script>
<script src="/netsage-pipeline/assets/js/2.97237792.js"></script>
<script src="/netsage-pipeline/assets/js/137.9a86e881.js"></script>
<script src="/netsage-pipeline/assets/js/138.d526b503.js"></script>
<script src="/netsage-pipeline/assets/js/935f2afb.aca71300.js"></script>
<script src="/netsage-pipeline/assets/js/17896441.5adc4e07.js"></script>
<script src="/netsage-pipeline/assets/js/cbd1c0d0.0373c1b1.js"></script>
</body>
</html>