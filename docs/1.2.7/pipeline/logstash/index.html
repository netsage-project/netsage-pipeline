<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.72">
<link rel="alternate" type="application/rss+xml" href="/netsage-pipeline/blog/rss.xml" title="Netsage Pipeline Documentation Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/netsage-pipeline/blog/atom.xml" title="Netsage Pipeline Documentation Blog Atom Feed"><title data-react-helmet="true">Logstash Pipeline | Netsage Pipeline Documentation</title><meta data-react-helmet="true" property="og:url" content="https://netsage-project.github.io/netsage-pipeline/docs/1.2.7/pipeline/logstash"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="1.2.7"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-1.2.7"><meta data-react-helmet="true" property="og:title" content="Logstash Pipeline | Netsage Pipeline Documentation"><meta data-react-helmet="true" name="description" content="The Logstash portion of the Netsage Pipeline reads in flows (normally from a RabbitMQ queue), performs various transformations and adds additional information to them, then sends them to a location specified in the output logstash config.  (In principle, Logstash can run more than one &quot;logstash pipeline&quot; at a time, but that will not be discussed here.)"><meta data-react-helmet="true" property="og:description" content="The Logstash portion of the Netsage Pipeline reads in flows (normally from a RabbitMQ queue), performs various transformations and adds additional information to them, then sends them to a location specified in the output logstash config.  (In principle, Logstash can run more than one &quot;logstash pipeline&quot; at a time, but that will not be discussed here.)"><link data-react-helmet="true" rel="shortcut icon" href="/netsage-pipeline/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://netsage-project.github.io/netsage-pipeline/docs/1.2.7/pipeline/logstash"><link data-react-helmet="true" rel="alternate" href="https://netsage-project.github.io/netsage-pipeline/docs/1.2.7/pipeline/logstash" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://netsage-project.github.io/netsage-pipeline/docs/1.2.7/pipeline/logstash" hreflang="x-default"><link rel="stylesheet" href="/netsage-pipeline/assets/css/styles.32d1f850.css">
<link rel="preload" href="/netsage-pipeline/assets/js/styles.957cc5e6.js" as="script">
<link rel="preload" href="/netsage-pipeline/assets/js/runtime~main.14b0212e.js" as="script">
<link rel="preload" href="/netsage-pipeline/assets/js/main.65b01934.js" as="script">
<link rel="preload" href="/netsage-pipeline/assets/js/1.d7dedcfb.js" as="script">
<link rel="preload" href="/netsage-pipeline/assets/js/2.1fde247e.js" as="script">
<link rel="preload" href="/netsage-pipeline/assets/js/141.1782d6b8.js" as="script">
<link rel="preload" href="/netsage-pipeline/assets/js/142.d881c78f.js" as="script">
<link rel="preload" href="/netsage-pipeline/assets/js/906738b8.8e531696.js" as="script">
<link rel="preload" href="/netsage-pipeline/assets/js/17896441.f3a73913.js" as="script">
<link rel="preload" href="/netsage-pipeline/assets/js/bb237b1e.a41a7e04.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#main" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle" type="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/netsage-pipeline/"><img src="/netsage-pipeline/img/logo.png" alt="NetSage Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/netsage-pipeline/img/logo.png" alt="NetSage Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">NetSage Documentation</strong></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/netsage-pipeline/docs/pipeline/intro">Pipeline Documentation</a><a href="https://netsage-project.github.io/netsage-grafana-configs/" target="_self" rel="noopener noreferrer" class="navbar__item navbar__link">Dashboard Documentation</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__item navbar__link" href="/netsage-pipeline/docs/1.2.7/pipeline/intro">1.2.7</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/netsage-pipeline/docs/next/pipeline/logstash">master (unreleased)</a></li><li><a class="dropdown__link" href="/netsage-pipeline/docs/pipeline/logstash">1.2.11</a></li><li><a class="dropdown__link" href="/netsage-pipeline/docs/1.2.10/pipeline/logstash">1.2.10</a></li><li><a class="dropdown__link" href="/netsage-pipeline/docs/1.2.9/pipeline/logstash">1.2.9</a></li><li><a class="dropdown__link" href="/netsage-pipeline/docs/1.2.8/pipeline/logstash">1.2.8</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/netsage-pipeline/docs/1.2.7/pipeline/logstash">1.2.7</a></li><li><a class="dropdown__link" href="/netsage-pipeline/docs/1.2.6/pipeline">1.2.6</a></li><li><a class="dropdown__link" href="/netsage-pipeline/docs/1.2.5/pipeline">1.2.5</a></li></ul></div><a href="https://github.com/netsage-project/netsage-pipeline/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_GrZ2"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_71bT">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/netsage-pipeline/"><img src="/netsage-pipeline/img/logo.png" alt="NetSage Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/netsage-pipeline/img/logo.png" alt="NetSage Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">NetSage Documentation</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/netsage-pipeline/docs/pipeline/intro">Pipeline Documentation</a></li><li class="menu__list-item"><a href="https://netsage-project.github.io/netsage-grafana-configs/" target="_self" rel="noopener noreferrer" class="menu__link">Dashboard Documentation</a></li><li class="menu__list-item"><a role="button" class="menu__link menu__link--sublist">Versions</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/netsage-pipeline/docs/next/pipeline/logstash">master (unreleased)</a></li><li class="menu__list-item"><a class="menu__link" href="/netsage-pipeline/docs/pipeline/logstash">1.2.11</a></li><li class="menu__list-item"><a class="menu__link" href="/netsage-pipeline/docs/1.2.10/pipeline/logstash">1.2.10</a></li><li class="menu__list-item"><a class="menu__link" href="/netsage-pipeline/docs/1.2.9/pipeline/logstash">1.2.9</a></li><li class="menu__list-item"><a class="menu__link" href="/netsage-pipeline/docs/1.2.8/pipeline/logstash">1.2.8</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active" href="/netsage-pipeline/docs/1.2.7/pipeline/logstash">1.2.7</a></li><li class="menu__list-item"><a class="menu__link" href="/netsage-pipeline/docs/1.2.6/pipeline">1.2.6</a></li><li class="menu__list-item"><a class="menu__link" href="/netsage-pipeline/docs/1.2.5/pipeline">1.2.5</a></li></ul></li><li class="menu__list-item"><a href="https://github.com/netsage-project/netsage-pipeline/" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper main-docs-wrapper"><div class="docPage_31aa"><div class="docSidebarContainer_3Kbt" role="complementary"><div class="sidebar_15mo"><div class="menu menu--responsive thin-scrollbar menu_Bmed"><button aria-label="Open menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_fgN0" width="24" height="24" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Pipeline</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/netsage-pipeline/docs/1.2.7/pipeline/intro">Intro</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/netsage-pipeline/docs/1.2.7/pipeline/tstat">Tstat</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/netsage-pipeline/docs/1.2.7/pipeline/nfdump">Nfdump</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/netsage-pipeline/docs/1.2.7/pipeline/importer">Importer</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/netsage-pipeline/docs/1.2.7/pipeline/logstash">Logstash</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/netsage-pipeline/docs/1.2.7/pipeline/elastic">Elasticsearch</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Deployment</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/netsage-pipeline/docs/1.2.7/deploy/choose_install">Choose Install</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/netsage-pipeline/docs/1.2.7/deploy/bare_metal_install">Server Installation Guide</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/netsage-pipeline/docs/1.2.7/deploy/docker_install_simple">Docker Simple</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/netsage-pipeline/docs/1.2.7/deploy/docker_install_advanced">Docker Advanced</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/netsage-pipeline/docs/1.2.7/deploy/docker_troubleshoot">Troubleshooting</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Deployment Guides</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/netsage-pipeline/docs/1.2.7/devel/dev_dataset">Replay Dataset</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/netsage-pipeline/docs/1.2.7/devel/docker_dev_guide">Docker Dev Guide</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Documentation</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/netsage-pipeline/docs/1.2.7/docusaurus">Documentation Guide</a></li></ul></li></ul></div></div></div><main class="docMainContainer_3ufF"><div class="container padding-vert--lg docItemWrapper_3FMP"><div class="row"><div class="col docItemCol_3FnS"><div class="alert alert--warning margin-bottom--md" role="alert"><div>This is documentation for Netsage Pipeline Documentation <strong>1.2.7</strong>, which is no longer actively maintained.</div><div class="margin-top--md">For up-to-date documentation, see the <strong><a href="/netsage-pipeline/docs/pipeline/logstash">latest version</a></strong> (1.2.11).</div></div><div class="docItemContainer_33ec"><article><div><span class="badge badge--secondary">Version: 1.2.7</span></div><header><h1 class="docTitle_3a4h">Logstash Pipeline</h1></header><div class="markdown"><p>The Logstash portion of the Netsage Pipeline reads in flows (normally from a RabbitMQ queue), performs various transformations and adds additional information to them, then sends them to a location specified in the output logstash config.  (In principle, Logstash can run more than one &quot;logstash pipeline&quot; at a time, but that will not be discussed here.) </p><p>Logstash config files invoke various logstash &quot;filters&quot;. These conf files are located in /etc/logstash/conf.d/. See below for a brief description of what each does and check the files for comments.</p><p>Notes: </p><ul><li>All *.conf files in conf.d/ are executed in alphabetical order, as if they were one huge file. Those ending in .disabled will not be executed (assuming &#x27;path.config: &quot;/etc/logstash/conf.d/*.conf&quot;&#x27; in /etc/logstash/pipelines.yml).</li><li>If actions in a .conf file are not needed in your particular case, it can be removed or disabled, but check carefully for effects on downstream configs.</li><li>MaxMind, CAIDA, and Science Registry Database files required by the geoip and aggregate filters are downloaded from scienceregistry.netsage.global via cron jobs weekly or daily. (MaxMind data can change weekly, CAIDA quarterly, Science Registry information randomly.) <strong>NOTE that new versions won&#x27;t be used in the pipeline until logstash is restarted.</strong> There is a cron file to do this also, though it&#x27;s not running in Docker deployments. Similarly for other support files, eg, those used in 90-additional-fields.conf.</li><li>Lookup tables for 55-member-orgs.conf are not saved in github. You will need to provide these yourself or ask us for any we may have compliled. </li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="logstash-sequence"></a>Logstash Sequence<a class="hash-link" href="#logstash-sequence" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="01-input-rabbitconf"></a>01-input-rabbit.conf<a class="hash-link" href="#01-input-rabbitconf" title="Direct link to heading">#</a></h3><p>Reads flows from a rabbitmq queue. (The &quot;.disabled&quot; extenstion can be removed from other 01-input configs available in conf.d/ to get flows from other sources.)</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="10-preliminariesconf"></a>10-preliminaries.conf<a class="hash-link" href="#10-preliminariesconf" title="Direct link to heading">#</a></h3><p>Drops flows to or from private IP addresses;
converts any timestamps in milliseconds to seconds;
drops events with timestamps more than a year in the past or (10 sec) in the future;
does some data type conversions;
adds @ingest_time (this is mainly for developers).</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="20-add_idconf"></a>20-add_id.conf<a class="hash-link" href="#20-add_idconf" title="Direct link to heading">#</a></h3><p>Adds a unique id (evenutally called meta.id) which is a hash of the 5-tuple of the flow (src and dst ips and ports, and protocol) plus the sensor name. This id is used for aggregating (stitching) in the next step. </p><p>Also adds a unique id (es_doc_id) based on meta.id plus the start time of the flow. If this id is used as the document id in elasticsearch, flows that are mistakenly input more than once will update existing documents rather than be added as duplicates.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="40-aggregationconf"></a>40-aggregation.conf<a class="hash-link" href="#40-aggregationconf" title="Direct link to heading">#</a></h3><p>Stitches together flows from different nfcapd files into longer flows, matching them up by meta.id and using a specified inactivity_timeout to decide when to start a new flow.</p><p>Notes: </p><ul><li>By default, 5-minute nfcapd files are assumed and the inactivity_timeout is set to 10.5 minutes. If more than 10.5 min have passed between the start of the current flow and the start of the last matching one, do not stitch them together.</li><li>If your nfcapd files are written every 15 minutes, change the inactivity_timeout to at least 16 minutes.</li><li>There is another &quot;timeout&quot; setting which is basically the maximum duration of a stitched flow (default: 24 hr).</li><li>When logstash shuts down, any flows &quot;in the aggregator&quot; will be written out to aggregate_maps_path (default: /tmp/logstash-aggregation-maps). The file is then read back in when logstash is restarted so aggregation can continue. </li><li>Your logstash pipeline can have only 1 worker or aggregation is not going to work! This is set in the logstash config file.</li><li>Tstat flows come in already complete, so no aggregation is done on those flows.</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="45-geoip-taggingconf"></a>45-geoip-tagging.conf<a class="hash-link" href="#45-geoip-taggingconf" title="Direct link to heading">#</a></h3><p>Queries the MaxMind GeoLite2-City database by IP to get src and dst Countries, Continents, Latitudes, and Longitudes;
if the destination IP is in the multicast range, sets the destination Organization, Country, and Continent to &quot;Multicast&quot;.</p><p><em>This product includes GeoLite2 data created by MaxMind, available from <a href="http://www.maxmind.com" target="_blank" rel="noopener noreferrer">www.maxmind.com</a>.</em></p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="50-asnconf"></a>50-asn.conf<a class="hash-link" href="#50-asnconf" title="Direct link to heading">#</a></h3><p>Normally with sflow and netflow, flows come in with source and destination ASNs.  If there is no ASN in the input event; or the input ASN is 0, 4294967295, or 23456, or it is a private ASN, tries to get an ASN by IP from the MaxMind ASN database.
Sets ASN to -1 if it is unavailable for any reason.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="53-caida-orgconf"></a>53-caida-org.conf<a class="hash-link" href="#53-caida-orgconf" title="Direct link to heading">#</a></h3><p>Uses the current source and destination ASNs to get organization names from the prepared CAIDA ASN-to-Organization lookup file.</p><p><em>This product uses a lookup table constructed from the CAIDA AS Organizations Dataset <a href="http://www.caida.org/data/as-organizations" target="_blank" rel="noopener noreferrer">www.caida.org</a>.</em> </p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="55-member-orgsconf"></a>55-member-orgs.conf<a class="hash-link" href="#55-member-orgsconf" title="Direct link to heading">#</a></h3><p>Searches any provided lookup tables by IP to obtain member or customer organization names and overwrite the Organization determined previously.
This allows entities which don&#x27;t own their own ASs to be listed as the src or dst Organization.</p><p>Note: These lookup tables are not stored in github, but an example is provided to show the layout.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="60-scireg-tagging-fakegeoipconf"></a>60-scireg-tagging-fakegeoip.conf<a class="hash-link" href="#60-scireg-tagging-fakegeoipconf" title="Direct link to heading">#</a></h3><p>Uses a fake geoip database containing <a href="http://scienceregistry.grnoc.iu.edu" target="_blank" rel="noopener noreferrer">Science Registry</a> information to tag the flows with source and destination science disciplines and roles, organizations and locations, etc;
removes Registry fields we don&#x27;t need to save to elasticsearch.</p><p>Notes: </p><ul><li>The <a href="https://scienceregistry.netsage.global/rdb/" target="_blank" rel="noopener noreferrer">Science Registry</a> stores human-curated information about various &quot;resources&quot;. Resources are sources and destinations of flows.</li><li>The Science Registry &quot;fake geoip database&quot; is updated weekly and can be downloaded via wget in a cron job (provided in the installation).</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="70-deidentifyconf"></a>70-deidentify.conf<a class="hash-link" href="#70-deidentifyconf" title="Direct link to heading">#</a></h3><p>Replaces the last octet of IPv4 addresses and the last 4 hextets of IPv6 addresses with x&#x27;s in order to deidentify them.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="80-privatizeorgconf"></a>80-privatize.org.conf<a class="hash-link" href="#80-privatizeorgconf" title="Direct link to heading">#</a></h3><p>Removes information about Australian organizations (or, with modification, any country that has privacy rules that require us not to identify organizations).
If the ASN is one of those listed, completely replaces the IP with x&#x27;s, sets the location to central Autralia, sets all organizations to &quot;AARNet&quot;, removes all Projects.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="88-preferred-location-orgconf"></a>88-preferred-location-org.conf<a class="hash-link" href="#88-preferred-location-orgconf" title="Direct link to heading">#</a></h3><p>Copies Science Registry organization and location values, if they exist, to the meta.preferred_organization and meta.preferred_location fields. If there are no Science Registry values, the organizations and locations from the CAIDA and MaxMind lookups, respectively, are saved to those fields.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="90-additional-fieldsconf"></a>90-additional-fields.conf<a class="hash-link" href="#90-additional-fieldsconf" title="Direct link to heading">#</a></h3><p>Sets additional quick and easy fields.  Supporting mapping or ruby files are used - see support/ and ruby/ in conf.d/. Currently we have (for Netsage&#x27;s use):</p><ul><li>sensor_group  = TACC, AMPATH, etc.  (based on matching sensor names to regexes)</li><li>sensor_type   = Circuit, Archive, Exchange Point, or Regional Network  (based on matching sensor names to regexes)</li><li>country_scope = Domestic, International, or Mixed  (based on src and dst countries, where Domestic = US, Puerto Rico, or Guam)</li><li>is_network_testing = yes, no  (yes if discipline from the science registry is &#x27;CS.Network Testing and Monitoring&#x27; or port = 5001, 5101, or 5201)</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="95-cleanupconf"></a>95-cleanup.conf<a class="hash-link" href="#95-cleanupconf" title="Direct link to heading">#</a></h3><p>Does small misc. tasks at the end like rename, remove, or convert fields</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="98-post-processconf"></a>98-post-process.conf<a class="hash-link" href="#98-post-processconf" title="Direct link to heading">#</a></h3><p>Adds @exit_time and @processing_time (these are mainly for developers)</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="99-output-rabbitconf"></a>99-output-rabbit.conf<a class="hash-link" href="#99-output-rabbitconf" title="Direct link to heading">#</a></h3><p>Sends results to a final RabbitMQ queue. (&quot;.disabled&quot; can be removed from other output configs to send flows to other places)</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="final-stage"></a>Final Stage<a class="hash-link" href="#final-stage" title="Direct link to heading">#</a></h3><p>In GlobalNOC/Netsage Project&#x27;s case, the output filter writes the flows to a RabbitMQ queue on another host and the last stage is a separate logstash pipeline on that host. The latter reads flows from the queue and sends it into elasticsearch. </p><p>This can be easily replicated with the following configuration, for example, though you&#x27;ll need one for each Rabbit queue/sensor/index. A mapping template can be specified here.</p><p>Naturally the hosts for rabbit and elastic will need to be updated accordingly.</p><p>Note: This should be updated to use a mapping template, for setting field types, and possibly using es_doc_id as the elasticsearch document id. As of Nov 2020, we are moving toward saving all fields as type &quot;keyword&quot;, &quot;float&quot;, or &quot;long&quot; only. </p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">input {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  rabbitmq {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    host =&gt; &#x27;localhost&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    user =&gt; &#x27;guest&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    password =&gt; &quot;${rabbitmq_pass}&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    exchange =&gt; &#x27;netsage.direct&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    key =&gt;   XXXXXXX&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    queue =&gt; &#x27;netsage&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    durable =&gt; true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    subscription_retry_interval_seconds =&gt; 5</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    connection_timeout =&gt; 10000</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">filter {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  if [@metadata][rabbitmq_properties][timestamp] {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    date {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      match =&gt; [&quot;[@metadata][rabbitmq_properties][timestamp]&quot;, &quot;UNIX&quot;]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">output {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    elasticsearch {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      hosts =&gt; [</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;https://CHANGEME1&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;https://CHANGEME2&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      ]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      user =&gt; &quot;logstash&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      password =&gt; &quot;${logstash_elasticsearch_password}&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      cacert =&gt; &quot;/etc/logstash/ca.crt&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      index =&gt; &quot;om-ns-netsage&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      template_overwrite =&gt; true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      failure_type_logging_whitelist =&gt; []</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      action =&gt; index</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      #ssl_certificate_verification =&gt; false</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="field-names"></a>Field names<a class="hash-link" href="#field-names" title="Direct link to heading">#</a></h2><p>The fields used/created in Logstash (and saved to Elasticsearch) are listed in the <a href="/netsage-pipeline/docs/1.2.7/pipeline/elastic">Elasticsearch doc</a>.</p></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/netsage-project/netsage-pipeline/edit/master/website/versioned_docs/version-1.2.7/pipeline/logstash.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" role="img" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-label="Edit page"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/netsage-pipeline/docs/1.2.7/pipeline/importer"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Importer</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/netsage-pipeline/docs/1.2.7/pipeline/elastic"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Elasticsearch Â»</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#logstash-sequence" class="table-of-contents__link">Logstash Sequence</a><ul><li><a href="#01-input-rabbitconf" class="table-of-contents__link">01-input-rabbit.conf</a></li><li><a href="#10-preliminariesconf" class="table-of-contents__link">10-preliminaries.conf</a></li><li><a href="#20-add_idconf" class="table-of-contents__link">20-add_id.conf</a></li><li><a href="#40-aggregationconf" class="table-of-contents__link">40-aggregation.conf</a></li><li><a href="#45-geoip-taggingconf" class="table-of-contents__link">45-geoip-tagging.conf</a></li><li><a href="#50-asnconf" class="table-of-contents__link">50-asn.conf</a></li><li><a href="#53-caida-orgconf" class="table-of-contents__link">53-caida-org.conf</a></li><li><a href="#55-member-orgsconf" class="table-of-contents__link">55-member-orgs.conf</a></li><li><a href="#60-scireg-tagging-fakegeoipconf" class="table-of-contents__link">60-scireg-tagging-fakegeoip.conf</a></li><li><a href="#70-deidentifyconf" class="table-of-contents__link">70-deidentify.conf</a></li><li><a href="#80-privatizeorgconf" class="table-of-contents__link">80-privatize.org.conf</a></li><li><a href="#88-preferred-location-orgconf" class="table-of-contents__link">88-preferred-location-org.conf</a></li><li><a href="#90-additional-fieldsconf" class="table-of-contents__link">90-additional-fields.conf</a></li><li><a href="#95-cleanupconf" class="table-of-contents__link">95-cleanup.conf</a></li><li><a href="#98-post-processconf" class="table-of-contents__link">98-post-process.conf</a></li><li><a href="#99-output-rabbitconf" class="table-of-contents__link">99-output-rabbit.conf</a></li><li><a href="#final-stage" class="table-of-contents__link">Final Stage</a></li></ul></li><li><a href="#field-names" class="table-of-contents__link">Field names</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2021 NetSage Built with Docusaurus.</div></div></div></footer></div>
<script src="/netsage-pipeline/assets/js/styles.957cc5e6.js"></script>
<script src="/netsage-pipeline/assets/js/runtime~main.14b0212e.js"></script>
<script src="/netsage-pipeline/assets/js/main.65b01934.js"></script>
<script src="/netsage-pipeline/assets/js/1.d7dedcfb.js"></script>
<script src="/netsage-pipeline/assets/js/2.1fde247e.js"></script>
<script src="/netsage-pipeline/assets/js/141.1782d6b8.js"></script>
<script src="/netsage-pipeline/assets/js/142.d881c78f.js"></script>
<script src="/netsage-pipeline/assets/js/906738b8.8e531696.js"></script>
<script src="/netsage-pipeline/assets/js/17896441.f3a73913.js"></script>
<script src="/netsage-pipeline/assets/js/bb237b1e.a41a7e04.js"></script>
</body>
</html>