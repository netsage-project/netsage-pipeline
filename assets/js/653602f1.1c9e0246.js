(window.webpackJsonp=window.webpackJsonp||[]).push([[55],{125:function(e,t,o){"use strict";o.r(t),o.d(t,"frontMatter",(function(){return i})),o.d(t,"metadata",(function(){return s})),o.d(t,"toc",(function(){return l})),o.d(t,"default",(function(){return p}));var n=o(3),r=o(7),a=(o(0),o(212)),i={id:"docker_troubleshoot",title:"Docker Troubleshooting",sidebar_label:"Troubleshooting"},s={unversionedId:"deploy/docker_troubleshoot",id:"deploy/docker_troubleshoot",isDocsHomePage:!1,title:"Docker Troubleshooting",description:"If you are not seeing flows after installation",source:"@site/docs/deploy/docker_troubleshooting.md",slug:"/deploy/docker_troubleshoot",permalink:"/netsage-pipeline/docs/next/deploy/docker_troubleshoot",editUrl:"https://github.com/netsage-project/netsage-pipeline/edit/master/website/docs/deploy/docker_troubleshooting.md",version:"current",sidebar_label:"Troubleshooting",sidebar:"Pipeline",previous:{title:"Upgrading",permalink:"/netsage-pipeline/docs/next/deploy/docker_upgrade"},next:{title:"Pipeline Replay Dataset",permalink:"/netsage-pipeline/docs/next/devel/dev_dataset"}},l=[{value:"If you are not seeing flows after installation",id:"if-you-are-not-seeing-flows-after-installation",children:[]},{value:"If there are too few flows and flow sizes and rates are too low",id:"if-there-are-too-few-flows-and-flow-sizes-and-rates-are-too-low",children:[]},{value:"If flow collection stops",id:"if-flow-collection-stops",children:[]}],c={toc:l};function p(e){var t=e.components,o=Object(r.a)(e,["components"]);return Object(a.b)("wrapper",Object(n.a)({},c,o,{components:t,mdxType:"MDXLayout"}),Object(a.b)("h3",{id:"if-you-are-not-seeing-flows-after-installation"},"If you are not seeing flows after installation"),Object(a.b)("p",null,Object(a.b)("strong",{parentName:"p"},"Troubleshooting checklist:")),Object(a.b)("ul",null,Object(a.b)("li",{parentName:"ul"},"Use ",Object(a.b)("inlineCode",{parentName:"li"},"docker-compose ps"),' to be sure the all the containers are (still) running.\n(If there are no sflow/netflow sensors, the command should be "echo No Sflow/Netflow sensor" and the container state should be Exit 0.)'),Object(a.b)("li",{parentName:"ul"},"Check the logs of the various containers to see if anything jumps out as being invalid.\xa0 "),Object(a.b)("li",{parentName:"ul"},"Make sure you configured your routers to point to the correct host and port."),Object(a.b)("li",{parentName:"ul"},"Check iptables on your pipeline host to be sure incoming traffic from the routers is allowed."),Object(a.b)("li",{parentName:"ul"},"Use tcpdump to be sure there are flows coming into the expected port."),Object(a.b)("li",{parentName:"ul"},"If the final rabbit queue is on an external host, check the credentials you are using and whether iptables on that host allows incoming traffic from your pipeline host."),Object(a.b)("li",{parentName:"ul"},"Did you create and edit .env? ",Object(a.b)("ul",{parentName:"li"},Object(a.b)("li",{parentName:"ul"},"Are the numbers of sensors, sensor names, and port numbers correct? "),Object(a.b)("li",{parentName:"ul"},"Make sure you don't have sflows going to a nfacctd process or vise versa."),Object(a.b)("li",{parentName:"ul"},"Are there names and port numbers for each sensor? "),Object(a.b)("li",{parentName:"ul"},"Are the environment variable names for sensors like ",Object(a.b)("em",{parentName:"li"},"_1, "),"_2, *_3, etc. with one sequence for sflow and one for netflow?"))),Object(a.b)("li",{parentName:"ul"},"Did you run setup-pmacct.sh?"),Object(a.b)("li",{parentName:"ul"},"In docker-compose.override.yml, make sure the ports are set correctly. You will see ",Object(a.b)("em",{parentName:"li"},"port on host : port in container"),". (Docker uses its own port numbers internally.) ",Object(a.b)("em",{parentName:"li"},"Port on host")," should match what is in .env (the port the router is sending to on the pipeline host). ",Object(a.b)("em",{parentName:"li"},"Port in container")," should match what is in the corresponding pmacct config.  "),Object(a.b)("li",{parentName:"ul"},"In pmacct config files, make sure amqp_host is set to rabbit (for docker installs) or localhost (for bare metal)"),Object(a.b)("li",{parentName:"ul"},"In 'docker-compose ps' output, be sure the command for the sfacctd_1 container is /usr/local/sbin/sfacctd, similarly for nfacctd."),Object(a.b)("li",{parentName:"ul"},'In docker-compose.yml and docker-compose.override.yml, make sure "command:"s specify config files with the right _n\'s (these are actually just the parameters for the commands).')),Object(a.b)("h3",{id:"if-there-are-too-few-flows-and-flow-sizes-and-rates-are-too-low"},"If there are too few flows and flow sizes and rates are too low"),Object(a.b)("p",null,"The router may not be sending the sampling rate. This should show up as @sampling_corrected = no.\nYou may need to apply sampling corrections using an advanced logstash option."),Object(a.b)("h3",{id:"if-flow-collection-stops"},"If flow collection stops"),Object(a.b)("p",null,Object(a.b)("strong",{parentName:"p"},"Errors:")),Object(a.b)("ul",null,Object(a.b)("li",{parentName:"ul"},"See if any of the containers has died using  ",Object(a.b)("inlineCode",{parentName:"li"},"docker ps")),Object(a.b)("li",{parentName:"ul"},"Check the logs of the various containers to see if anything jumps out as being invalid.\xa0Eg, ",Object(a.b)("inlineCode",{parentName:"li"},"docker-compose logs logstash"),"."),Object(a.b)("li",{parentName:"ul"},"If logstash logs say things like ",Object(a.b)("em",{parentName:"li"},"OutOfMemoryError: Java heap space"),"\xa0or ",Object(a.b)("em",{parentName:"li"},"An unexpected connection driver error occured (Exception message: Connection reset)"),"  and the rabbit container is also down...  We've seen this before, but are not sure why it occurs. Try stopped everything, restarting docker for good measure, and starting everything up again. (If problems are continuing, it might be a memory issue.)",Object(a.b)("pre",{parentName:"li"},Object(a.b)("code",{parentName:"pre"},"docker-compose down\nsudo systemctl restart docker\ndocker-compose up -d\n"))),Object(a.b)("li",{parentName:"ul"},"If logstash dies with an error about not finding ","*",".conf files, make sure conf-logstash/, and directories and files within, are readable by everyone (and directories are executable by everyone). "),Object(a.b)("li",{parentName:"ul"},"logstash-downlaods/ and conf-pmacct/ files need to be readable."),Object(a.b)("li",{parentName:"ul"},"logstash-temp/ needs to be owned (readable and writable) by the logstash user (uid 1000, regardless of whether there is different username associated with uid 1000 on the host). ")),Object(a.b)("p",null,Object(a.b)("strong",{parentName:"p"},"Memory:")),Object(a.b)("ul",null,Object(a.b)("li",{parentName:"ul"},"If you are running a lot of data, sometimes docker may need to be allocated more memory. The most likely culprit is logstash (java) which is only allocated 4GB of RAM by default. Please see the Docker Advanced guide for how to change.")),Object(a.b)("p",null,Object(a.b)("strong",{parentName:"p"},"Disk space:")),Object(a.b)("ul",null,Object(a.b)("li",{parentName:"ul"},"If the pipeline suddenly fails, check to see if the disk is full. If it is, first try getting rid of old docker images and containers to free up space: ",Object(a.b)("inlineCode",{parentName:"li"},"docker image prune -a")," and ",Object(a.b)("inlineCode",{parentName:"li"},"docker container prune"),".")))}p.isMDXComponent=!0},212:function(e,t,o){"use strict";o.d(t,"a",(function(){return u})),o.d(t,"b",(function(){return f}));var n=o(0),r=o.n(n);function a(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function i(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function s(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?i(Object(o),!0).forEach((function(t){a(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):i(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}function l(e,t){if(null==e)return{};var o,n,r=function(e,t){if(null==e)return{};var o,n,r={},a=Object.keys(e);for(n=0;n<a.length;n++)o=a[n],t.indexOf(o)>=0||(r[o]=e[o]);return r}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;n<a.length;n++)o=a[n],t.indexOf(o)>=0||Object.prototype.propertyIsEnumerable.call(e,o)&&(r[o]=e[o])}return r}var c=r.a.createContext({}),p=function(e){var t=r.a.useContext(c),o=t;return e&&(o="function"==typeof e?e(t):s(s({},t),e)),o},u=function(e){var t=p(e.components);return r.a.createElement(c.Provider,{value:t},e.children)},b={inlineCode:"code",wrapper:function(e){var t=e.children;return r.a.createElement(r.a.Fragment,{},t)}},d=r.a.forwardRef((function(e,t){var o=e.components,n=e.mdxType,a=e.originalType,i=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),u=p(o),d=n,f=u["".concat(i,".").concat(d)]||u[d]||b[d]||a;return o?r.a.createElement(f,s(s({ref:t},c),{},{components:o})):r.a.createElement(f,s({ref:t},c))}));function f(e,t){var o=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var a=o.length,i=new Array(a);i[0]=d;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:n,i[1]=s;for(var c=2;c<a;c++)i[c]=o[c];return r.a.createElement.apply(null,i)}return r.a.createElement.apply(null,o)}d.displayName="MDXCreateElement"}}]);