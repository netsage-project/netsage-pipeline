(window.webpackJsonp=window.webpackJsonp||[]).push([[104],{175:function(e,t,o){"use strict";o.r(t),o.d(t,"frontMatter",(function(){return i})),o.d(t,"metadata",(function(){return l})),o.d(t,"toc",(function(){return s})),o.d(t,"default",(function(){return u}));var n=o(3),r=o(7),a=(o(0),o(208)),i={id:"docker_troubleshoot",title:"Docker Troubleshooting",sidebar_label:"Troubleshooting"},l={unversionedId:"deploy/docker_troubleshoot",id:"version-1.2.10/deploy/docker_troubleshoot",isDocsHomePage:!1,title:"Docker Troubleshooting",description:"Troubleshooting",source:"@site/versioned_docs/version-1.2.10/deploy/docker_troubleshooting.md",slug:"/deploy/docker_troubleshoot",permalink:"/netsage-pipeline/docs/1.2.10/deploy/docker_troubleshoot",editUrl:"https://github.com/netsage-project/netsage-pipeline/edit/master/website/versioned_docs/version-1.2.10/deploy/docker_troubleshooting.md",version:"1.2.10",sidebar_label:"Troubleshooting",sidebar:"version-1.2.10/Pipeline",previous:{title:"Upgrading",permalink:"/netsage-pipeline/docs/1.2.10/deploy/docker_upgrade"},next:{title:"Pipeline Replay Dataset",permalink:"/netsage-pipeline/docs/1.2.10/devel/dev_dataset"}},s=[{value:"Troubleshooting",id:"troubleshooting",children:[{value:"If you are not seeing flows after installation",id:"if-you-are-not-seeing-flows-after-installation",children:[]},{value:"If flow collection stops",id:"if-flow-collection-stops",children:[]}]}],c={toc:s};function u(e){var t=e.components,o=Object(r.a)(e,["components"]);return Object(a.b)("wrapper",Object(n.a)({},c,o,{components:t,mdxType:"MDXLayout"}),Object(a.b)("h2",{id:"troubleshooting"},"Troubleshooting"),Object(a.b)("h3",{id:"if-you-are-not-seeing-flows-after-installation"},"If you are not seeing flows after installation"),Object(a.b)("p",null,Object(a.b)("strong",{parentName:"p"},"Troubleshooting checklist:")),Object(a.b)("ul",null,Object(a.b)("li",{parentName:"ul"},"Make sure you configured your routers to point to the correct address/port where the collector is running.\xa0 "),Object(a.b)("li",{parentName:"ul"},"Check iptables on your pipeline host to be sure incoming traffic from the routers is allowed."),Object(a.b)("li",{parentName:"ul"},"Use ",Object(a.b)("inlineCode",{parentName:"li"},"docker-compose ps")," to be sure the collectors (and other containers) are running."),Object(a.b)("li",{parentName:"ul"},'Check to see if nfcapd files are being written. There should be a directory for the year, month, day and files should be larger than a few hundred bytes. If the files exist but are too small, the collector is running but there are no incoming flows.  "nfdump -r filename" will show the flows in a file.'),Object(a.b)("li",{parentName:"ul"},"Make sure you created .env and docker-compose.override.yml files and updated the settings accordingly,  sensorName especially since that identifies the source of the data."),Object(a.b)("li",{parentName:"ul"},"Check the logs of the various containers to see if anything jumps out as being invalid.\xa0 ",Object(a.b)("inlineCode",{parentName:"li"},"docker-compose logs -f $service_label")),Object(a.b)("li",{parentName:"ul"},"Check the logs to see if logstash is starting successfully. "),Object(a.b)("li",{parentName:"ul"},"If the final rabbit queue is on an external host, check iptables on that host to be sure incoming traffic from your pipeline host is allowed.")),Object(a.b)("p",null,"To see if flows are getting into and being read from the rabbit queue on the pipeline host, you can go to  ",Object(a.b)("inlineCode",{parentName:"p"},"http://localhost:15672")," in your favorite web browser. Login as guest with password guest. Look for accumulating messages and/or messages being acknowledged and published."),Object(a.b)("h3",{id:"if-flow-collection-stops"},"If flow collection stops"),Object(a.b)("p",null,Object(a.b)("strong",{parentName:"p"},"Logstash or Importer errors:")),Object(a.b)("ul",null,Object(a.b)("li",{parentName:"ul"},"Make sure all containers are running.  ",Object(a.b)("inlineCode",{parentName:"li"},"docker ps")),Object(a.b)("li",{parentName:"ul"},"Check the logs of the various containers to see if anything jumps out as being invalid.\xa0 ",Object(a.b)("inlineCode",{parentName:"li"},"docker-compose logs -f $service_label")),Object(a.b)("li",{parentName:"ul"},"Check the logs to see if logstash is starting successfully.")),Object(a.b)("p",null,Object(a.b)("strong",{parentName:"p"},"Disk space:")),Object(a.b)("ul",null,Object(a.b)("li",{parentName:"ul"},"If the pipeline suddenly fails, check to see if the disk is full. If it is, first try getting rid of old docker images and containers to free up space: ",Object(a.b)("inlineCode",{parentName:"li"},"docker image prune -a")," and ",Object(a.b)("inlineCode",{parentName:"li"},"docker container prune"),"."),Object(a.b)("li",{parentName:"ul"},"Also check to see how much space the nfcapd files are comsuming. You need to add more disk space. You could try saving fewer days of nfcapd files (see Docker Advanced). ")),Object(a.b)("p",null,Object(a.b)("strong",{parentName:"p"},"Memory:")),Object(a.b)("ul",null,Object(a.b)("li",{parentName:"ul"},"If you are running a lot of data, sometimes docker may need to be allocated more memory. The most\nlikely culprit is logstash which is usually only allocated 2GB of RAM. You'll need to update the jvm.options file to grant it more memory. ")),Object(a.b)("p",null,"Please see the ",Object(a.b)("a",{parentName:"p",href:"/netsage-pipeline/docs/1.2.10/deploy/docker_install_advanced#customize-logstash-settings"},"Docker Advanced guide")," for details on how to customize logstash."),Object(a.b)("p",null,"Applying this snippet to logstash may help. For example, to give logstash (java) 3GB,"),Object(a.b)("pre",null,Object(a.b)("code",{parentName:"pre",className:"language-yaml"},"environment: + LS_JAVA_OPTS=-Xmx3g\n")),Object(a.b)("p",null,"Alternatively you may also try doing this:"),Object(a.b)("pre",null,Object(a.b)("code",{parentName:"pre",className:"language-yaml"},'deploy:\n  resources:\n    limits:\n      cpus: "0.50"\n      memory: 50M\n    reservations:\n      cpus: "0.25"\n      memory: 20M\n')),Object(a.b)("p",null,"Reference: ",Object(a.b)("a",{parentName:"p",href:"https://docs.docker.com/compose/compose-file/#resources"},"https://docs.docker.com/compose/compose-file/#resources")))}u.isMDXComponent=!0},208:function(e,t,o){"use strict";o.d(t,"a",(function(){return p})),o.d(t,"b",(function(){return f}));var n=o(0),r=o.n(n);function a(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function i(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function l(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?i(Object(o),!0).forEach((function(t){a(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):i(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}function s(e,t){if(null==e)return{};var o,n,r=function(e,t){if(null==e)return{};var o,n,r={},a=Object.keys(e);for(n=0;n<a.length;n++)o=a[n],t.indexOf(o)>=0||(r[o]=e[o]);return r}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;n<a.length;n++)o=a[n],t.indexOf(o)>=0||Object.prototype.propertyIsEnumerable.call(e,o)&&(r[o]=e[o])}return r}var c=r.a.createContext({}),u=function(e){var t=r.a.useContext(c),o=t;return e&&(o="function"==typeof e?e(t):l(l({},t),e)),o},p=function(e){var t=u(e.components);return r.a.createElement(c.Provider,{value:t},e.children)},b={inlineCode:"code",wrapper:function(e){var t=e.children;return r.a.createElement(r.a.Fragment,{},t)}},d=r.a.forwardRef((function(e,t){var o=e.components,n=e.mdxType,a=e.originalType,i=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),p=u(o),d=n,f=p["".concat(i,".").concat(d)]||p[d]||b[d]||a;return o?r.a.createElement(f,l(l({ref:t},c),{},{components:o})):r.a.createElement(f,l({ref:t},c))}));function f(e,t){var o=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var a=o.length,i=new Array(a);i[0]=d;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:n,i[1]=l;for(var c=2;c<a;c++)i[c]=o[c];return r.a.createElement.apply(null,i)}return r.a.createElement.apply(null,o)}d.displayName="MDXCreateElement"}}]);